import $ from 'jquery'
import StarWebRTC from './star_rtc_video.min'
var StarRtc=window.NameSpace||{};if(void 0===APP_PRODUCT_ID)var i=0,APP_PRODUCT_ID={R:i++,t:i++,O:i++,_:i++,s:i++,S:i++,i:i++,I:i++,o:i++,A:i++,N:i++};if(void 0===ACTION_GROUP_ID){i=0;var ACTION_GROUP_ID={M:i++,V:i++,C:i++,T:i++,P:i++,u:i++}}if(void 0===MSG_TYPE){i=0;var MSG_TYPE={L:i++,G:i++,l:i++,p:i++,D:i++}}if(void 0===MSG_DATA_TYPE){i=0;var MSG_DATA_TYPE={U:i++,v:i++,H:i++,k:i++}}if(void 0===ENCRYPT_TYPE){i=0;var ENCRYPT_TYPE={g:i++,m:i++}}if(void 0===AG_MSG_VOIP_CTRL)var AG_MSG_VOIP_CTRL={h:1e3,Y:1100,F:1001,K:1002,W:1003,B:1004};if(void 0===CHATROOM_LIST_TYPE){i=0;var CHATROOM_LIST_TYPE={q:i++,J:i++,j:i++,X:i++,$:i++,Z:i++,ee:i++}}if(void 0===AG_MSG){i=0;var AG_MSG={Re:i++,te:i++,Oe:i++,ae:i++,Ee:i++,_e:i++,re:i++,se:i++,ne:i++,ce:i++,Se:i++,ie:i++,Ie:i++,oe:i++,Ae:i++,Ne:i++,Me:i++,Ve:i++,Ce:i++,Te:i++,Pe:i++,ue:i++,Le:i++,Ge:i++,le:i++,pe:i++,De:i++,fe:i++,Ue:i++,de:i++,ve:i++,be:i++,He:i++,ke:i++,ge:i++,me:i++,ye:i++,we:i++,xe:i++,he:i++,Ye:i++,Fe:i++,Ke:i++,We:i++,Be:i++}}if(void 0===CHAT_ROOM_TYPE){i=1;var CHAT_ROOM_TYPE={qe:i++,Je:i++}}if(void 0===AG_CHATROOMMOONSERVER){i=0;var AG_CHATROOMMOONSERVER={Qe:i++,je:i++,Xe:i++,$e:i++,ze:i++,Ze:i++,eR:i++,RR:i++,tR:i++,OR:i++,aR:i++,ER:i++,_R:i++,rR:i++,sR:i++,nR:i++,cR:i++,SR:i++,iR:i++,IR:i++,oR:i++,AR:i++,NR:i++,MR:i++,VR:i++,CR:i++,TR:i++,PR:i++,uR:i++,LR:i++,GR:i++,lR:i++,pR:i++,DR:i++,fR:i++,UR:i++,dR:i++,vR:i++,bR:i++,HR:i++,kR:i++,gR:i++,mR:i++,yR:i++,wR:i++}}if(void 0===AG_VOIPMOONSERVER){i=0;var AG_VOIPMOONSERVER={xR:i++,hR:i++,YR:i++,FR:i++,KR:i++,WR:i++,BR:i++,qR:i++,JR:i++,QR:i++,jR:i++,XR:i++,$R:i++,zR:i++,ZR:i++,et:i++,Rt:i++,tt:i++,Ot:i++,at:i++,Et:i++,_t:i++,rt:i++,st:i++,nt:i++,ct:i++,St:i++,it:i++,It:i++,ot:i++,At:i++,Nt:i++,Mt:i++,Vt:i++,Ct:i++,Tt:i++,Pt:i++,ut:i++,Lt:i++}}if(void 0===AG_LIVESRCMOONSERVER){i=0;var AG_LIVESRCMOONSERVER={Gt:i++,lt:i++,pt:i++,Dt:i++,ft:i++,Ut:i++,dt:i++,vt:i++,bt:i++,Ht:i++,kt:i++,gt:i++,yt:i++,wt:i++,xt:i++,ht:i++,Yt:i++,Ft:i++,Kt:i++,Wt:i++,Bt:i++,qt:i++,Jt:i++,Qt:i++,jt:i++,Xt:i++,$t:i++,zt:i++,Zt:i++,eO:i++,RO:i++,tO:i++,OO:i++,aO:i++,EO:i++,_O:i++,rO:i++,sO:i++,nO:i++,cO:i++,SO:i++,iO:i++,IO:i++,oO:i++,AO:i++,NO:i++,MO:i++,VO:i++,CO:i++,TO:i++,PO:i++,uO:i++,LO:i++,GO:i++,lO:i++,pO:i++,DO:i++,fO:i++,UO:i++,dO:i++,vO:i++,bO:i++,HO:i++,kO:i++,gO:i++,mO:i++,yO:i++,wO:i++,xO:i++,hO:i++,YO:i++,FO:i++,KO:i++,WO:i++,BO:i++,qO:i++,JO:i++,QO:i++}}if(void 0===AG_LIVEVDNMOONSERVER){i=0;var AG_LIVEVDNMOONSERVER={jO:i++,XO:i++,$O:i++,zO:i++,ZO:i++,ea:i++,Ra:i++,ta:i++,Oa:i++,aa:i++,Ea:i++,_a:i++,ra:i++,sa:i++,na:i++,ca:i++,Sa:i++,ia:i++,Ia:i++,oa:i++,Aa:i++,Na:i++,Ma:i++,Va:i++}}function clone(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return(R=new Date).setTime(e.getTime()),R;if(e instanceof Array){for(var R=[],t=e.length,O=0;O<t;++O)R[O]=clone(e[O]);return R}if(e instanceof Object){R={};for(var a in e)e.hasOwnProperty(a)&&(R[a]=clone(e[a]));return R}throw new Error("Unable to copy obj! Its type isn't supported.")}StarRtc.AUtils=new function(){var b,H=this,k="",h="",Y="",F="";function C(e,R){for(var t=B(e),O=q(m(t.length.toString(16))),a=B(R),E=q(m(a.length.toString(16))),_=new Uint8Array(t.length+a.length+8),r=0,s=O.length,n=r;n<s;n++)_[n]=O[n-r];s=(r=s)+t.length;for(n=r;n<s;n++)_[n]=t[n-r];s=(r=s)+E.length;for(n=r;n<s;n++)_[n]=E[n-r];s=(r=s)+a.length;for(n=r;n<s;n++)_[n]=a[n-r];return _}function g(e){var R=new Uint8Array(e),t=0,O=parseInt("0x"+w(R.slice(t,t+4)));t+=4;var a=y(R.slice(t,t+O));t+=O;var E=parseInt("0x"+w(R.slice(t,t+4)));return t+=4,{digest:a,content:y(R.slice(t,t+E))}}function m(e){var R=8-e.length;return"00000000".substr(0,R)+e}function K(e){var R=4-e.length;return"0000".substr(0,R)+e}function W(e,R){var t=new Array(e+1).join("0"),O=e-R.length;return t.substr(0,O)+R}function B(e){var R,t,O=new Array;R=e.length;for(var a=0;a<R;a++)65536<=(t=e.charCodeAt(a))&&t<=1114111?(O.push(t>>18&7|240),O.push(t>>12&63|128),O.push(t>>6&63|128),O.push(63&t|128)):2048<=t&&t<=65535?(O.push(t>>12&15|224),O.push(t>>6&63|128),O.push(63&t|128)):128<=t&&t<=2047?(O.push(t>>6&31|192),O.push(63&t|128)):O.push(255&t);return O}function y(e){if("string"==typeof e)return e;for(var R="",t=e,O=0;O<t.length;O++){var a=t[O].toString(2),E=a.match(/^1+?(?=0)/);if(E&&8==a.length){for(var _=E[0].length,r=t[O].toString(2).slice(7-_),s=1;s<_;s++)r+=t[s+O].toString(2).slice(2);R+=String.fromCharCode(parseInt(r,2)),O+=_-1}else R+=String.fromCharCode(t[O])}return R}function q(e){var R=0,t=e.length;if(t%2!=0)return null;t/=2;for(var O=new Array,a=0;a<t;a++){var E=e.substr(R,2),_=parseInt("0x"+E);O.push(_),R+=2}return O}function w(e){for(var R="",t=0;t<e.length;t++){var O=e[t].toString(16);1==O.length&&(O="0"+O),R+=O}return R}function J(e,R,t){var O=R;for(var a in t)for(var E=t[a],_=0;_<E.length;_++,O++)e[O]=E[_]}H.msgMaxLen=0,H.setUserInfo=function(e,R,t){Y=(k=e)+"_"+(h=R),F=t},H.clear=function(){F=Y=h=k="",H.msgMaxLen=0,clearInterval(b)},H.parseProtocol=function(e,c){var R=new Blob([e],{type:"text/plain"}),S=new FileReader;S.readAsArrayBuffer(R),S.onload=function(e){var R=new Uint8Array(S.result);console.info("parseProtocol:",R);var t=R[0],O=R.slice(1,5),a=R[5],E=R.slice(6,8),_=R.slice(8,10),r=R[10],s=R.slice(11,R.byteLength-2);console.info("parseProtocol: msgArr = ",s);var n=R.slice(R.byteLength-2,R.byteLength);c({appid:t,plength:O,appver:a,rese1:E,rese2:_,actionid:r,msgArr:s,end:n})}},H.packageProtocol=function(e,R,t){var O=e,a=new Array(255,255),E=new Array(255,255),_=R,r=(new Array(18,52),t),s=new Uint8Array(r),n=q(m((r.byteLength+12).toString(16))),c=new ArrayBuffer(r.byteLength+13),S=new Uint8Array(c);S[0]=O;for(var i=1;i<5;i++)S[i]=n[i-1];S[5]=1,S[6]=a[0],S[7]=a[1],S[8]=E[0],S[9]=E[1],S[10]=_;for(i=11;i<11+s.byteLength;i++)S[i]=s[i-11];return S[11+s.byteLength]=18,S[12+s.byteLength]=52,console.log("packageProtocol",S),S},H.constructAuthMsg=function(){for(var e=q(K(AG_MSG.Re.toString(16))),R=B(Y),t=q(K(R.length.toString(16))),O=B(F),a=new Uint8Array(R.length+36),E=0,_=e.length,r=E;r<_;r++)a[r]=e[r];_=(E=_)+t.length;for(r=E;r<_;r++)a[r]=t[r-E];_=(E=_)+R.length;for(r=E;r<_;r++)a[r]=R[r-E];_=(E=_)+O.length;for(r=E;r<_;r++)a[r]=O[r-E];E=0;var s=[];return s.push(e),s.push(t),s.push(R),s.push(O),J(a,E,s),a},H.constructMsgProtocol=function(e,R){var t,O=[],a=q(K(e.toString(16))),E=B(Y),_=q(K(E.length.toString(16)));q(K(B(F).length.toString(16)));switch(e){case AG_MSG.re:var r=q(m(R.reqIndex.toString(16))),s=q(m((S=B(R.addUsers)).length.toString(16))),n=q(m((i=B(R.userDefineData)).length.toString(16)));t=new Uint8Array(6+(2+E.length)+(4+S.length)+(4+i.length)),O.push(a),O.push(r),O.push(_),O.push(E),O.push(s),O.push(S),O.push(n),O.push(i);break;case AG_MSG.se:r=q(m(R.reqIndex.toString(16)));var c=q(m((A=B(R.groupId)).length.toString(16)));t=new Uint8Array(6+(2+A.length)+(2+E.length)),O.push(a),O.push(r),O.push(c),O.push(A),O.push(_),O.push(E);break;case AG_MSG.ne:var S;r=q(m(R.reqIndex.toString(16))),c=q(m((A=B(R.groupId)).length.toString(16))),s=q(m((S=B(R.addUsers)).length.toString(16))),n=q(m((i=B(R.userDefineData)).length.toString(16)));t=new Uint8Array(6+(2+A.length)+(2+E.length)+(4+S.length)+(4+i.length)),O.push(a),O.push(r),O.push(c),O.push(A),O.push(_),O.push(E),O.push(s),O.push(S),O.push(n),O.push(i);break;case AG_MSG.ce:r=q(m(R.reqIndex.toString(16))),c=q(m((A=B(R.groupId)).length.toString(16)));var i,I=B(R.removeUsers),o=q(m(I.length.toString(16)));n=q(m((i=B(R.userDefineData)).length.toString(16)));t=new Uint8Array(6+(2+A.length)+(2+E.length)+(4+I.length)),O.push(a),O.push(r),O.push(c),O.push(A),O.push(_),O.push(E),O.push(o),O.push(I);break;case AG_MSG.Se:case AG_MSG.ie:r=q(m(R.reqIndex.toString(16))),c=q(m((A=B(R.groupId)).length.toString(16)));t=new Uint8Array(6+(2+A.length)+(2+E.length)),O.push(a),O.push(r),O.push(c),O.push(A),O.push(_),O.push(E);break;case AG_MSG.Ie:case AG_MSG.oe:break;case AG_MSG.ye:r=q(m(R.reqIndex.toString(16)));t=new Uint8Array(6+(2+E.length)),O.push(a),O.push(r),O.push(_),O.push(E);break;case AG_MSG.xe:var A;r=q(m(R.reqIndex.toString(16))),c=q(K((A=B(R.groupId)).length.toString(16)));t=new Uint8Array(6+(2+E.length)+(2+A.length)),O.push(a),O.push(r),O.push(_),O.push(E),O.push(c),O.push(A);break;case AG_MSG.Ye:t=new Uint8Array(2),O.push(a);break;case AG_MSG.Ke:t=new Uint8Array(4);var N=q(K(R.reqPageNum.toString(16)));O.push(a),O.push(N)}return J(t,0,O),t},H.constructSingleMsg=function(e,R,t,O,a){var E=q(K(AG_MSG._e.toString(16))),_=B(Y),r=q(K(_.length.toString(16))),s=B(k+"_"+e),n=q(K(s.length.toString(16))),c=q(m(R.toString(16))),S=ENCRYPT_TYPE.g,i=MSG_DATA_TYPE.v;null!=a&&(i=a);var I={fromId:h,targetId:e,time:"0",msgIndex:R,type:1,code:0,contentData:O},o=C(t,JSON.stringify(I)),A=q(m(o.length.toString(16))),N=new Uint8Array(_.length+s.length+o.length+16),M=[];return M.push(E),M.push(r),M.push(_),M.push(n),M.push(s),M.push(c),M.push([S]),M.push([i]),M.push(A),M.push(o),J(N,0,M),N},H.constructGroupMsg=function(e,R,t,O){var a=q(K(AG_MSG.Ae.toString(16))),E=B(""),_=q(K(E.length.toString(16))),r=q(m(R.toString(16))),s=B(k+"_"+e),n=q(K(s.length.toString(16))),c=B(Y),S=q(K(c.length.toString(16))),i=ENCRYPT_TYPE.g,I=MSG_DATA_TYPE.v,o={fromId:h,targetId:e,time:"0",msgIndex:R,type:1,code:0,contentData:O},A=C(t,JSON.stringify(o)),N=q(m(A.length.toString(16))),M=new Uint8Array(E.length+s.length+c.length+A.length+18),V=[];return V.push(a),V.push(_),V.push(E),V.push(r),V.push(n),V.push(s),V.push(S),V.push(c),V.push([i]),V.push([I]),V.push(N),V.push(A),J(M,0,V),M},H.constructReceivedMsg=function(e){var R=q(K(AG_MSG.De.toString(16))),t=B(Y),O=q(K(t.length.toString(16))),a=new Uint8Array(e),E=new Uint8Array(t.length+12),_=[];return _.push(R),_.push(O),_.push(t),_.push(a),J(E,0,_),E},H.constructSingleCtrlMsg=function(e,R,t,O,a){var E=q(K(AG_MSG._e.toString(16))),_=B(Y),r=q(K(_.length.toString(16))),s=B(k+"_"+e),n=q(K(s.length.toString(16))),c=q(m(R.toString(16))),S=ENCRYPT_TYPE.g,i=MSG_DATA_TYPE.U,I={fromId:h,targetId:e,time:"0",msgIndex:R,type:0,code:parseInt(a),contentData:O},o=C(t,JSON.stringify(I)),A=q(m(o.length.toString(16))),N=new Uint8Array(_.length+s.length+o.length+16),M=[];return M.push(E),M.push(r),M.push(_),M.push(n),M.push(s),M.push(c),M.push([S]),M.push([i]),M.push(A),M.push(o),J(N,0,M),N},H.constructVOIPProtocol=function(e,R){var t,O=[],a=q(K(e.toString(16))),E=B(Y),_=q(K(E.length.toString(16))),r=B(F),s=q(K(r.length.toString(16)));switch(e){case AG_VOIPMOONSERVER.FR:case AG_VOIPMOONSERVER.WR:var n=B(k+"_"+R.targetId),c=q(K(n.length.toString(16))),S=q(W(8,parseInt(R.audioSSRC).toString(16))),i=q(W(8,parseInt(R.videoSSRC).toString(16))),I=q(W(2,parseInt(R.videoCodec).toString(16))),o=q(W(2,parseInt(R.audioCodec).toString(16)));t=new Uint8Array(2+(2+E.length)+(2+r.length)+(2+n.length)+4+4+1+1),O.push(a),O.push(_),O.push(E),O.push(s),O.push(r),O.push(c),O.push(n),O.push(S),O.push(i),O.push(I),O.push(o);break;case AG_VOIPMOONSERVER.JR:var A=R.isActive;t=new Uint8Array(3),O.push(a),O.push([A])}return J(t,0,O),t},H.constructSrcProtocol=function(e,R){var t=[],O=q(K(e.toString(16))),a=q(K((I=B(Y)).length.toString(16))),E=q(K((D=B(F)).length.toString(16)));switch(e){case AG_LIVESRCMOONSERVER.Ft:case AG_LIVESRCMOONSERVER.Kt:var _=q(K(R.conCurrentNum.toString(16))),r=q(K((0).toString(16))),s=q(K((S=B(R.roomId)).length.toString(16))),n=R.liveType,c=q(K((N=B(R.extra)).length.toString(16)));y=new Uint8Array(2+(2+I.length)+(2+D.length)+2+2+(2+S.length)+1+(2+N.length)),t.push(O),t.push(a),t.push(I),t.push(E),t.push(D),t.push(_),t.push(r),t.push(s),t.push(S),t.push([n]),t.push(c),t.push(N);break;case AG_LIVESRCMOONSERVER.Wt:_=q(K(R.conCurrentNum.toString(16))),r=q(K(R.validTime.toString(16))),s=q(K((S=B(R.roomId)).length.toString(16))),c=q(K((N=B(R.extra)).length.toString(16)));var S,i=q(K((M=B(R.spec)).length.toString(16)));t.push(O),t.push(a),t.push(I),t.push(E),t.push(D),t.push(_),t.push(r),t.push(s),t.push(S),t.push(c),t.push(N),t.push(i),t.push(M);break;case AG_LIVESRCMOONSERVER.Bt:a=q(K((I=B(h)).length.toString(16))),E=q(K((D=B(F)).length.toString(16))),r=q(K((0).toString(16)));var I,o=q(K((A=B(R.groupId)).length.toString(16)));c=q(K((N=B(R.extra)).length.toString(16)));t.push(O),t.push(a),t.push(I),t.push(E),t.push(D),t.push(r),t.push(o),t.push(A),t.push(c),t.push(N);break;case AG_LIVESRCMOONSERVER.qt:var A,N,M;r=q(K((0).toString(16))),o=q(K((A=B(R.groupId)).length.toString(16))),c=q(K((N=B(R.extra)).length.toString(16))),i=q(K((M=B(R.spec)).length.toString(16)));t.push(O),t.push(a),t.push(I),t.push(E),t.push(D),t.push(r),t.push(o),t.push(A),t.push(c),t.push(N),t.push(i),t.push(M);break;case AG_LIVESRCMOONSERVER.Jt:var V=B(R.channelId),C=B(R.avParam),T=q(K(C.length.toString(16)));t.push(O),t.push(a),t.push(I),t.push(E),t.push(D),t.push(V),t.push(T),t.push(C);break;case AG_LIVESRCMOONSERVER.jt:V=B(R.channelId);var P=q(K((u=B(R.upUserId)).length.toString(16)));t.push(O),t.push(a),t.push(I),t.push(E),t.push(D),t.push(V),t.push(P),t.push(u);break;case AG_LIVESRCMOONSERVER.Xt:case AG_LIVESRCMOONSERVER.$t:case AG_LIVESRCMOONSERVER.zt:var u;V=B(R.channelId),P=q(K((u=B(R.upUserId)).length.toString(16)));t.push(O),t.push(a),t.push(I),t.push(E),t.push(D),t.push(V),t.push(P),t.push(u);break;case AG_LIVESRCMOONSERVER.Zt:case AG_LIVESRCMOONSERVER.eO:V=B(R.channelId);y=new Uint8Array(2+(2+I.length)+(2+D.length)+16),t.push(O),t.push(a),t.push(I),t.push(E),t.push(D),t.push(V);break;case AG_LIVESRCMOONSERVER.RO:for(var L=R.streamConfig,G=new Uint8Array(16),l=0;l<16;l++)null!=L[l]?G[l]=L[l]:G[l]=0;y=new Uint8Array(18),t.push(O),t.push(G);break;case AG_LIVESRCMOONSERVER.tO:V=B(R.channelId);t.push(O),t.push(V);break;case AG_LIVESRCMOONSERVER.aO:t.push(O);break;case AG_LIVESRCMOONSERVER.OO:var p=B(R.streamData);y=new Uint8Array(3+p.length),t.push(O),t.push([R.streamDataType]),t.push(p);break;case AG_LIVESRCMOONSERVER.Qt:var D,f=B(Y),U=q(K(f.length.toString(16))),d=(E=q(K((D=B(F)).length.toString(16))),V=B(R.channelId),q(W(8,parseInt(R.audioSSRC).toString(16)))),v=q(W(8,parseInt(R.smallVideoSSRC).toString(16))),b=q(W(8,parseInt(R.bigVideoSSRC).toString(16))),H=q(W(2,parseInt(R.videoCodec).toString(16))),k=q(W(2,parseInt(R.audioCodec).toString(16))),g=q(K((w=B(R.iceUfrag)).length.toString(16))),m=q(K((x=B(R.icePwd)).length.toString(16))),y=new Uint8Array(f.length+D.length+34+1+1+2+w.length+2+x.length);t.push(O),t.push(U),t.push(f),t.push(E),t.push(D),t.push(V),t.push(d),t.push(v),t.push(b),t.push(H),t.push(k),t.push(w),t.push(x);break;case AG_LIVESRCMOONSERVER.qO:var w,x;g=q(K((w=B(R.iceUfrag)).length.toString(16))),m=q(K((x=B(R.icePwd)).length.toString(16)));y=new Uint8Array(4+w.length+2+x.length),t.push(O),t.push(g),t.push(w),t.push(m),t.push(x)}return J(y,0,t),y},H.constructVdnProtocol=function(e,R){var t,O=[],a=q(K(e.toString(16))),E=B(Y),_=q(K(E.length.toString(16))),r=B(F),s=q(K(r.length.toString(16)));switch(e){case AG_LIVEVDNMOONSERVER.$O:var n=B(R.iceUfrag),c=q(K(n.length.toString(16))),S=B(R.icePwd),i=q(K(S.length.toString(16)));t=new Uint8Array(4+n.length+2+S.length),O.push(a),O.push(c),O.push(n),O.push(i),O.push(S);break;case AG_LIVEVDNMOONSERVER.zO:var I=B(R.channelId);t=new Uint8Array(18+(2+E.length)+(2+r.length)),O.push(a),O.push(I),O.push(_),O.push(E),O.push(s),O.push(r);break;case AG_LIVEVDNMOONSERVER.ZO:case AG_LIVEVDNMOONSERVER.ea:t=new Uint8Array(2),O.push(a);break;case AG_LIVEVDNMOONSERVER.Oa:case AG_LIVEVDNMOONSERVER.Ra:I=B(R.channelId);t=new Uint8Array(18),O.push(a),O.push(I);break;case AG_LIVEVDNMOONSERVER.ta:for(var o=R.streamConfig,A=new Uint8Array(16),N=0;N<16;N++)null!=o[N]?A[N]=o[N]:A[N]=0;t=new Uint8Array(18),O.push(a),O.push(A)}return J(t,0,O),t},H.constructChatProtocol=function(e,R){var t,O=[],a=q(K(e.toString(16))),E=B(Y),_=q(K(E.length.toString(16))),r=B(F),s=q(K(r.length.toString(16)));if(e==AG_CHATROOMMOONSERVER.Qe){var n=R.roomType,c=q(K(R.conCurrentNum.toString(16))),S=q(m((l=B(R.userDefineData)).length.toString(16)));t=new Uint8Array(2+(2+E.length)+(2+r.length)+1+2+(4+l.length)),O.push(a),O.push(_),O.push(E),O.push(s),O.push(r),O.push([n]),O.push(c),O.push(S),O.push(l)}else if(e==AG_CHATROOMMOONSERVER.je)t=new Uint8Array(2),O.push(a);else if(e==AG_CHATROOMMOONSERVER.Xe){var i=B(k+"_"+R.banUserId),I=q(K(i.length.toString(16))),o=q(K(R.banTime.toString(16)));t=new Uint8Array(2+(2+i.length)+2),O.push(a),O.push(I),O.push(i),O.push(o)}else if(e==AG_CHATROOMMOONSERVER.$e){var A=B(k+"_"+R.kickOutUserId),N=q(K(A.length.toString(16)));t=new Uint8Array(2+(2+A.length)),O.push(a),O.push(N),O.push(A)}else if(e==AG_CHATROOMMOONSERVER.ze)t=new Uint8Array(2),O.push(a);else if(e==AG_CHATROOMMOONSERVER.Ze){var M=B(R.roomId);t=new Uint8Array(2+(2+E.length)+(2+r.length)+16),O.push(a),O.push(_),O.push(E),O.push(s),O.push(r),O.push(M)}else if(e==AG_CHATROOMMOONSERVER.eR);else if(e==AG_CHATROOMMOONSERVER.RR)t=new Uint8Array(2),O.push(a);else if(e==AG_CHATROOMMOONSERVER.tR){var V={fromId:h,targetId:R.roomId,time:"0",msgIndex:R.msgIndex,type:1,code:0,contentData:R.msg},C=B(JSON.stringify(V)),T=q(m(C.length.toString(16)));t=new Uint8Array(2+(4+C.length)),O.push(a),O.push(T),O.push(C)}else if(e==AG_CHATROOMMOONSERVER.OR){V={fromId:h,targetId:R.roomId,time:"0",msgIndex:R.msgIndex,type:parseInt(R.type),code:parseInt(R.code),contentData:R.msg};var P=B(JSON.stringify(V)),u=q(m(P.length.toString(16))),L=B(k+"_"+R.toUserId),G=q(K(L.length.toString(16)));t=new Uint8Array(2+(2+L.length)+(4+P.length)),O.push(a),O.push(G),O.push(L),O.push(u),O.push(P)}else if(e==AG_CHATROOMMOONSERVER.aR){M=B(R.roomId);t=new Uint8Array(18),O.push(a),O.push(M)}else if(e==AG_CHATROOMMOONSERVER.vR){var l,p=q(K((f=B(h)).length.toString(16))),D=q(K(R.listType.toString(16)));S=q(m((l=B(R.userDefineData)).length.toString(16))),M=B(R.roomId);t=new Uint8Array(4+(2+f.length)+16+(4+l.length)),O.push(a),O.push(D),O.push(p),O.push(f),O.push(M),O.push(S),O.push(l)}else if(e==AG_CHATROOMMOONSERVER.kR){D=q(K(R.listType.toString(16))),M=B(R.roomId),p=q(K((f=B(h)).length.toString(16)));t=new Uint8Array(4+(2+f.length)+16),O.push(a),O.push(D),O.push(p),O.push(f),O.push(M)}else if(e==AG_CHATROOMMOONSERVER.yR){var f,U=B(R.listTypes),d=q(K(U.length.toString(16))),v=q(K((f=B(R.userId)).length.toString(16)));t=new Uint8Array(2+(2+U.length)+(2+f.length)),O.push(a),O.push(d),O.push(U),O.push(v),O.push(f)}return J(t,0,O),t},H.parseMessage=function(e,R){var t,O=new Uint8Array(e);switch(parseInt("0x"+w(O.slice(0,2)))){case AG_MSG.te:O=new Uint8Array(e);StarRtc.AUtils.msgMaxLen=parseInt("0x"+w(O.slice(2,4))),console.log("登录成功，最大消息长度：",StarRtc.AUtils.msgMaxLen),StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,H.constructHeartBeatMsg(AG_MSG.ae))),b=setInterval(function(){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,H.constructHeartBeatMsg(AG_MSG.ae)))},15e3),R({status:"success"},"onLoginMessage");break;case AG_MSG.Oe:console.log("登录失败"),R({status:"failed"},"onLoginMessage");break;case AG_MSG.Ee:console.log("心跳反馈");break;case AG_MSG.le:console.log("服务器收到消息");break;case AG_MSG.pe:console.log("收到消息");parseInt("0x"+w(O.slice(10,14)));var a=15;switch(O[14]){case MSG_TYPE.L:console.log("单聊消息");var E=parseInt("0x"+w(O.slice(a,a+2)));a+=2;var _=y(O.slice(a,a+E)),r=O[a+=E];switch(a+=1,r){case ENCRYPT_TYPE.g:var s=parseInt("0x"+w(O.slice(a,a+4)));a+=4;var n=g(O.slice(a,a+s));console.log(_,n.digest,n.content),2==(i=_.split("_")).length&&(_=i[1]),R(e={fromId:_,digest:n.digest,msg:n.content},"onSingleMessage");break;case ENCRYPT_TYPE.m:}break;case MSG_TYPE.G:console.log("群消息");var c=parseInt("0x"+w(O.slice(a,a+2)));a+=2;var S=y(O.slice(a,a+c));a+=c;E=parseInt("0x"+w(O.slice(a,a+2)));a+=2;_=y(O.slice(a,a+E)),r=O[a+=E];switch(a+=1,r){case ENCRYPT_TYPE.g:s=parseInt("0x"+w(O.slice(a,a+4)));a+=4;n=g(O.slice(a,a+s));console.log(S,_,n.digest,n.content),2==(i=_.split("_")).length&&(_=i[1]),2==(I=S.split("_")).length&&(S=I[1]),R(e={groupId:S,fromId:_,digest:n.digest,msg:n.content},"onGroupMessage");break;case ENCRYPT_TYPE.m:}break;case MSG_TYPE.l:console.log("群私信消息");c=parseInt("0x"+w(O.slice(a,a+2)));a+=2;S=y(O.slice(a,a+c));a+=c;E=parseInt("0x"+w(O.slice(a,a+2)));a+=2;_=y(O.slice(a,a+E)),r=O[a+=E];switch(a+=1,r){case ENCRYPT_TYPE.g:s=parseInt("0x"+w(O.slice(a,a+4)));a+=4;var i;n=g(O.slice(a,a+s));console.log(S,_,n.digest,n.content),2==(i=_.split("_")).length&&(_=i[1]),2==(I=S.split("_")).length&&(S=I[1]),R(e={groupId:S,fromId:_,digest:n.digest,msg:n.content},"onGroupPrivateMessage");break;case ENCRYPT_TYPE.m:}break;case MSG_TYPE.p:console.log("推送群信息");c=parseInt("0x"+w(O.slice(a,a+2)));a+=2;S=y(O.slice(a,a+c));a+=c;s=parseInt("0x"+w(O.slice(a,a+4)));a+=4;var I;n=g(O.slice(a,a+s));console.log(S,n.digest,n.content),2==(I=S.split("_")).length&&(S=I[1]),R(e={groupId:S,digest:n.digest,msg:n.content},"onGroupPushMessage");break;case MSG_TYPE.D:console.log("推送系统信息");s=parseInt("0x"+w(O.slice(a,a+4)));a+=4;n=g(O.slice(a,a+s));console.log(n.digest,n.content),R(e={digest:n.digest,msg:n.content},"onSystemPushMessage")}t=O.slice(2,10),console.log("发送消息回执"),StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructReceivedMsg(t)));break;case AG_MSG.fe:var o=parseInt("0x"+w(O.slice(2,4))),A=y(O.slice(6,O.byteLength));console.log("报错:",o,A),R(e={errId:o,errStr:A},"onErrorMessage");break;case AG_MSG.Ne:var N=parseInt("0x"+w(O.slice(2,4))),M=y(O.slice(4,4+N)),V=parseInt("0x"+w(O.slice(4+N,4+N+4)));c=parseInt("0x"+w(O.slice(4+N+4,4+N+4+2)));R({status:"success",statusStr:M,groupMsgIndex:V,groupId:S=y(O.slice(4+N+4+2,4+N+4+2+c)),serverTimestamp:parseInt("0x"+w(O.slice(4+N+4+2+c,4+N+4+2+c+4)))},"onSendGroupMsgFin");break;case AG_MSG.Me:N=parseInt("0x"+w(O.slice(2,4))),M=y(O.slice(4,4+N));var C=parseInt("0x"+w(O.slice(4+N,4+N+4)));c=parseInt("0x"+w(O.slice(4+N+4,4+N+4+2)));R({status:"success",statusStr:M,reqIndex:C,groupId:S=y(O.slice(4+N+4+2,4+N+4+2+c))},"onCreateGroupFin");break;case AG_MSG.Ve:N=parseInt("0x"+w(O.slice(2,4))),M=y(O.slice(4,4+N)),C=parseInt("0x"+w(O.slice(4+N,4+N+4))),c=parseInt("0x"+w(O.slice(4+N+4,4+N+4+2)));R({status:"success",statusStr:M,reqIndex:C,groupId:S=y(O.slice(4+N+4+2,4+N+4+2+c))},"onDelGroupFin");break;case AG_MSG.Ce:N=parseInt("0x"+w(O.slice(2,4))),M=y(O.slice(4,4+N)),C=parseInt("0x"+w(O.slice(4+N,4+N+4))),c=parseInt("0x"+w(O.slice(4+N+4,4+N+4+2)));R({status:"success",statusStr:M,reqIndex:C,groupId:S=y(O.slice(4+N+4+2,4+N+4+2+c))},"onAddGroupUserFin");break;case AG_MSG.Te:N=parseInt("0x"+w(O.slice(2,4))),M=y(O.slice(4,4+N)),C=parseInt("0x"+w(O.slice(4+N,4+N+4))),c=parseInt("0x"+w(O.slice(4+N+4,4+N+4+2)));R({status:"success",statusStr:M,reqIndex:C,groupId:S=y(O.slice(4+N+4+2,4+N+4+2+c))},"onRemoveGroupUserFin");break;case AG_MSG.Pe:N=parseInt("0x"+w(O.slice(2,4))),M=y(O.slice(4,4+N)),C=parseInt("0x"+w(O.slice(4+N,4+N+4))),c=parseInt("0x"+w(O.slice(4+N+4,4+N+4+2)));R({status:"success",statusStr:M,reqIndex:C,groupId:S=y(O.slice(4+N+4+2,4+N+4+2+c))},"onSetGroupMsgIgnoreFin");break;case AG_MSG.ue:N=parseInt("0x"+w(O.slice(2,4))),M=y(O.slice(4,4+N)),C=parseInt("0x"+w(O.slice(4+N,4+N+4))),c=parseInt("0x"+w(O.slice(4+N+4,4+N+4+2)));R({status:"success",statusStr:M,reqIndex:C,groupId:S=y(O.slice(4+N+4+2,4+N+4+2+c))},"onUnsetGroupMsgIgnoreFin");break;case AG_MSG.Le:N=parseInt("0x"+w(O.slice(2,4)));R({status:"success",statusStr:M=y(O.slice(4,4+N)),reqIndex:C=parseInt("0x"+w(O.slice(4+N,4+N+4)))},"onPushSystemMsgFin");break;case AG_MSG.Ge:N=parseInt("0x"+w(O.slice(2,4))),M=y(O.slice(4,4+N)),C=parseInt("0x"+w(O.slice(4+N,4+N+4))),c=parseInt("0x"+w(O.slice(4+N+4,4+N+4+2)));R({status:"success",statusStr:M,reqIndex:C,groupId:S=y(O.slice(4+N+4+2,4+N+4+2+c))},"onPushGroupSystemMsgFin");break;case AG_MSG.we:N=parseInt("0x"+w(O.slice(2,4))),M=y(O.slice(4,4+N)),C=parseInt("0x"+w(O.slice(4+N,4+N+4)));var T=parseInt("0x"+w(O.slice(4+N+4,4+N+4+4))),P=y(O.slice(4+N+4+4,4+N+4+4+T)).split(",");0==T&&(P=[]);for(var u=parseInt("0x"+w(O.slice(4+N+4+4+T,4+N+4+4+T+4))),L=y(O.slice(4+N+4+4+T+4,4+N+4+4+T+4+u)).split(","),G=parseInt("0x"+w(O.slice(4+N+4+4+T+4+u,4+N+4+4+T+4+u+4))),l=y(O.slice(4+N+4+4+T+4+u+4,4+N+4+4+T+4+u+4+G)).split(","),p=[],D=0;D<P.length;D++){var f={groupId:P[D],groupName:L[D],creator:l[D]};p.push(f)}R({status:"success",statusStr:M,reqIndex:C,groupsInfo:p},"onGetGroupList");break;case AG_MSG.he:N=parseInt("0x"+w(O.slice(2,4))),M=y(O.slice(4,4+N)),C=parseInt("0x"+w(O.slice(4+N,4+N+4)));var U=parseInt("0x"+w(O.slice(4+N+4,4+N+4+4)));R({status:"success",statusStr:M,reqIndex:C,userIdList:y(O.slice(4+N+4+4,4+N+4+4+U)).split(",")},"onGetGroupUserList");break;case AG_MSG.Fe:R({status:"success",count:parseInt("0x"+w(O.slice(2,6))),totalPageNum:d=parseInt("0x"+w(O.slice(6,8)))},"onGetOnlineNumber");break;case AG_MSG.We:var d=parseInt("0x"+w(O.slice(2,4))),v=parseInt("0x"+w(O.slice(4,6)));U=parseInt("0x"+w(O.slice(6,10)));R({status:"success",totalPageNum:d,reqPageNum:v,userIdList:y(O.slice(10,10+U)).split(",")},"onGetAllUserList");break;case AG_MSG.Be:R({status:"failed",totalPageNum:d=parseInt("0x"+w(O.slice(2,4))),reqPageNum:v=parseInt("0x"+w(O.slice(4,6)))},"onGetAllUserList")}},H.parseSrcMoonServerMessage=function(e,R){var t=new Uint8Array(e);switch(parseInt("0x"+w(t.slice(0,2)))){case AG_LIVESRCMOONSERVER.sO:w(t.slice(18,20));var O=parseInt("0x"+w(t.slice(18,20)));R({type:"srcApplyUpload",status:"success",fingerprint:y(t.slice(20,20+O))});break;case AG_LIVESRCMOONSERVER.nO:var a=parseInt("0x"+w(t.slice(2,4)));R({type:"srcApplyUpload",status:"failed",msg:i=y(t.slice(4,4+a))});break;case AG_LIVESRCMOONSERVER.UO:console.log("webrtc心跳反馈");break;case AG_LIVESRCMOONSERVER.dO:for(var E=parseInt("0x"+w(t.slice(2,3))),_=3,r=t.length,s={siv:E,uperInfos:{}};_<r;){var n=parseInt("0x"+w(t.slice(_,_+1)));_+=1;var c=parseInt("0x"+w(t.slice(_,_+2)));_+=2;var S=y(t.slice(_,_+c));_+=c,s.uperInfos[n]={upId:n,userId:S}}R({type:"uperStreamInfoUpdate",status:"success",msg:s});break;case AG_LIVESRCMOONSERVER.fO:R({type:"stopStream",status:"success"});break;case AG_LIVESRCMOONSERVER.LO:R({type:"streamConfig",status:"success",channelId:y(t.slice(2,18))});break;case AG_LIVESRCMOONSERVER.GO:R({type:"streamConfig",status:"failed",channelId:y(t.slice(2,18))});break;case AG_LIVESRCMOONSERVER.PO:R({type:"delChannel",status:"success",channelId:y(t.slice(2,18))});break;case AG_LIVESRCMOONSERVER.uO:a=parseInt("0x"+w(t.slice(2,4)));var i=y(t.slice(4,4+a));R({type:"delChannel",status:"failed",channelId:y(t.slice(4+a,4+a+16)),msg:i});break;case AG_LIVESRCMOONSERVER.EO:R({type:"createChannel",status:"success",channelId:y(t.slice(2,18))});break;case AG_LIVESRCMOONSERVER._O:a=parseInt("0x"+w(t.slice(2,4)));R({type:"createChannel",status:"failed",msg:i=y(t.slice(4,4+a))});break;case AG_LIVESRCMOONSERVER.vO:n=parseInt("0x"+w(t.slice(2,3))),E=parseInt("0x"+w(t.slice(3,4)));var I=y(t.slice(5));R({type:"streamData",status:"success",upId:n,siv:E,streamDataType:parseInt("0x"+w(t.slice(4,5))),streamData:I});break;case AG_LIVESRCMOONSERVER.bO:(i={}).errId=parseInt("0x"+w(t.slice(2,4))),i.errStrlen=parseInt("0x"+w(t.slice(4,6))),i.errStr=y(t.slice(6,6+i.errStrlen)),R({type:"serverErr",status:"failed",msg:i});break;case AG_LIVESRCMOONSERVER.JO:O=parseInt("0x"+w(t.slice(2,4)));R({type:"webrtcReg",status:"success",fingerprint:y(t.slice(4,4+O))});break;case AG_LIVESRCMOONSERVER.QO:R({type:"webrtcConnect",status:"success"})}},H.parseVdnMoonServerMessage=function(e,R){var t=new Uint8Array(e);switch(parseInt("0x"+w(t.slice(0,2)))){case AG_LIVEVDNMOONSERVER.aa:var O=parseInt("0x"+w(t.slice(2,4)));R({type:"webrtcReg",status:"success",fingerprint:y(t.slice(4,4+O))});break;case AG_LIVEVDNMOONSERVER.Ea:for(var a=y(t.slice(2,18)),E=parseInt("0x"+w(t.slice(18,19))),_=19,r=t.length,s={siv:E,uperInfos:{}};_<r;){var n=parseInt("0x"+w(t.slice(_,_+1)));_+=1;var c=parseInt("0x"+w(t.slice(_,_+2)));_+=2;var S=y(t.slice(_,_+c));_+=c,s.uperInfos[n]={upId:n,userId:S}}R({type:"vdnApplyDownload",status:"success",channelId:a,uperInfos:s});break;case AG_LIVEVDNMOONSERVER._a:console.log("vdn 心跳反馈");break;case AG_LIVEVDNMOONSERVER.ra:var i=parseInt("0x"+w(t.slice(2,4))),I=y(t.slice(4,4+i));R({type:"vdnApplyDownload",status:"failed",channelId:a=y(t.slice(4+i,4+i+16)),failedStatus:I});break;case AG_LIVEVDNMOONSERVER.sa:R({type:"streamConfig",status:"success",channelId:a=y(t.slice(2,18))});break;case AG_LIVEVDNMOONSERVER.na:R({type:"streamConfig",status:"failed",channelId:a=y(t.slice(2,18))});break;case AG_LIVEVDNMOONSERVER.ca:for(a=y(t.slice(2,18)),E=parseInt("0x"+w(t.slice(18,19))),_=19,r=t.length,s={channelId:a,siv:E,uperInfos:{}};_<r;){n=parseInt("0x"+w(t.slice(_,_+1)));_+=1;c=parseInt("0x"+w(t.slice(_,_+2)));_+=2;S=y(t.slice(_,_+c));_+=c,s.uperInfos[n]={upId:n,userId:S}}R({type:"uperStreamInfoUpdate",status:"success",channelId:a,msg:s});break;case AG_LIVEVDNMOONSERVER.Sa:R({type:"streamData",status:"success",upId:n=parseInt("0x"+w(t.slice(2,3))),siv:E=parseInt("0x"+w(t.slice(3,4))),streamDataType:parseInt("0x"+w(t.slice(4,5))),streamData:y(t.slice(5))});break;case AG_LIVEVDNMOONSERVER.ia:break;case AG_LIVEVDNMOONSERVER.Va:R({type:"webrtcConnect",status:"success"});break;case AG_LIVEVDNMOONSERVER.Ia:case AG_LIVEVDNMOONSERVER.oa:break;case AG_LIVEVDNMOONSERVER.Na:var o={};o.errId=parseInt("0x"+w(t.slice(2,4))),o.errStrlen=parseInt("0x"+w(t.slice(4,6))),o.errStr=y(t.slice(6,6+o.errStrlen)),R({type:"serverErr",status:"failed",msg:o})}},H.parseChatMoonServerMessage=function(e,R){var t=new Uint8Array(e),O=parseInt("0x"+w(t.slice(0,2)));switch(O){case AG_CHATROOMMOONSERVER.ER:R({type:"createChatRoom",status:"success",chatroomId:E=y(t.slice(2,18)),maxContentLen:parseInt("0x"+w(t.slice(18,20)))});break;case AG_CHATROOMMOONSERVER._R:var a=parseInt("0x"+w(t.slice(2,4)));R({type:"createChatRoom",status:"failed",status:y(t.slice(4,4+a))});break;case AG_CHATROOMMOONSERVER.rR:R({type:"deleteChatRoom",status:"success",roomId:E=y(t.slice(2,18))});break;case AG_CHATROOMMOONSERVER.sR:var E=y(t.slice(2,18));a=parseInt("0x"+w(t.slice(18,20)));R({type:"deleteChatRoom",status:"failed",msg:y(t.slice(20,20+a)),roomId:E});break;case AG_CHATROOMMOONSERVER.nR:var _=parseInt("0x"+w(t.slice(2,4)));R({type:"banaedToSendMsg",status:"success",banUserId:r=y(t.slice(4,4+_)),banTime:s=parseInt("0x"+w(t.slice(4+_,4+_+2)))});break;case AG_CHATROOMMOONSERVER.cR:_=parseInt("0x"+w(t.slice(2,4)));var r=y(t.slice(4,4+_)),s=parseInt("0x"+w(t.slice(4+_,4+_+2)));a=parseInt("0x"+w(t.slice(4+_+2,4+_+2+2)));R({type:"banaedToSendMsg",status:"failed",banUserId:r,banTime:s,msg:y(t.slice(4+_+2+2,4+_+2+2+a))});break;case AG_CHATROOMMOONSERVER.SR:var n=parseInt("0x"+w(t.slice(2,4)));R({type:"kickOutUser",status:"success",kickOutUserId:c=y(t.slice(4,4+n))});break;case AG_CHATROOMMOONSERVER.iR:n=parseInt("0x"+w(t.slice(2,4)));var c=y(t.slice(4,4+n));a=parseInt("0x"+w(t.slice(4+n,4+_+2)));R({type:"kickOutUser",status:"failed",kickOutUserId:c,msg:y(t.slice(4+n+2,4+n+2+a))});break;case AG_CHATROOMMOONSERVER.IR:case AG_CHATROOMMOONSERVER.oR:R({type:"joinChatRoom",status:"success",roomId:E=y(t.slice(2,18)),maxContentLen:parseInt("0x"+w(t.slice(18,20)))});break;case AG_CHATROOMMOONSERVER.AR:E=y(t.slice(2,18)),a=parseInt("0x"+w(t.slice(18,20)));R({type:"joinChatRoom",status:"failed",failedStatus:y(t.slice(20,20+a)),roomId:E});break;case AG_CHATROOMMOONSERVER.NR:console.log("chatRoom心跳反馈");break;case AG_CHATROOMMOONSERVER.MR:case AG_CHATROOMMOONSERVER.VR:var S=parseInt("0x"+w(t.slice(2,4))),i=y(t.slice(4,4+S)),I=parseInt("0x"+w(t.slice(4+S,4+S+4))),o=y(t.slice(4+S+4,4+S+4+I));R({type:O==AG_CHATROOMMOONSERVER.MR?"recvChatPrivateMsg":"recvChatMsg",status:"success",fromUserId:i,msg:o});break;case AG_CHATROOMMOONSERVER.CR:R({type:"chatroomUserBannedMsg",status:"success",banTime:s=parseInt("0x"+w(t.slice(2,4)))});break;case AG_CHATROOMMOONSERVER.TR:R({type:"chatroomUserKicked",status:"success"});break;case AG_CHATROOMMOONSERVER.PR:R({type:"sendMsgNoFree"});break;case AG_CHATROOMMOONSERVER.uR:(o={}).errId=parseInt("0x"+w(t.slice(2,4))),o.errStrlen=parseInt("0x"+w(t.slice(4,6))),o.errStr=y(t.slice(6,6+o.errStrlen)),R({type:"serverErr",status:"failed",msg:o});break;case AG_CHATROOMMOONSERVER.LR:R({type:"getRoomOnlineNum",status:"success",roomId:E=y(t.slice(2,18)),onlineNum:parseInt("0x"+w(t.slice(18,22)))});break;case AG_CHATROOMMOONSERVER.bR:R({type:"saveToChatroomList",status:"success",roomId:E=y(t.slice(2,18))});break;case AG_CHATROOMMOONSERVER.HR:R({type:"saveToChatroomList",status:"failed",roomId:E=y(t.slice(2,18))});break;case AG_CHATROOMMOONSERVER.gR:R({type:"delFromToChatroomList",status:"success",roomId:E=y(t.slice(2,18))});break;case AG_CHATROOMMOONSERVER.mR:R({type:"delFromToChatroomList",status:"failed",roomId:E=y(t.slice(2,18))});break;case AG_CHATROOMMOONSERVER.wR:var A=parseInt("0x"+w(t.slice(2,6)));R({type:"queryAllChatroomList",status:"success",listData:y(t.slice(6,6+A))})}},H.parseVoipMoonServerMessage=function(e,R){var t=new Uint8Array(e);switch(parseInt("0x"+w(t.slice(0,2)))){case AG_VOIPMOONSERVER.QR:R({type:"voipCallingAck",status:"success"});break;case AG_VOIPMOONSERVER.XR:var O=parseInt("0x"+w(t.slice(2,4)));R({type:"voipCalling",status:"success",fingerprint:y(t.slice(4,4+O))});break;case AG_VOIPMOONSERVER.$R:(a={}).errId=parseInt("0x"+w(t.slice(2,4))),a.errStrlen=parseInt("0x"+w(t.slice(4,6))),a.errStr=y(t.slice(6,6+a.errStrlen)),R({type:"voipCalling",status:"failed",msg:a});break;case AG_VOIPMOONSERVER.ZR:O=parseInt("0x"+w(t.slice(2,4)));R({type:"voipResponseing",status:"success",fingerprint:y(t.slice(4,4+O))});break;case AG_VOIPMOONSERVER.et:(a={}).errId=parseInt("0x"+w(t.slice(2,4))),a.errStrlen=parseInt("0x"+w(t.slice(4,6))),a.errStr=y(t.slice(6,6+a.errStrlen)),R({type:"voipResponseing",status:"failed",msg:a});break;case AG_VOIPMOONSERVER.Rt:case AG_VOIPMOONSERVER.tt:break;case AG_VOIPMOONSERVER.Ot:var a;(a={}).errId=parseInt("0x"+w(t.slice(2,4))),a.errStrlen=parseInt("0x"+w(t.slice(4,6))),a.errStr=y(t.slice(6,6+a.errStrlen)),R({type:"serverErr",status:"failed",msg:a})}},H.constructHeartBeatMsg=function(e){return new Uint8Array(q(K(e.toString(16))))}},StarRtc.StarManager=new function(){var a=this,e="starRTC v1.0.1",E="",_="",r="",s="",n="",R=null,c=null,S="";a.version=function(){return console.log(e),e},a.login=function(e,R,t,O){"WebSocket"in window?(r=(E=e)+"_"+(_=R),s=t,c=O,StarRtc.Instance.configModePulic?$.get("https://"+StarRtc.Instance.loginServerUrl+":"+StarRtc.Instance.loginServerPort+"/?userId="+r+"&authKey="+s,function(e,R){if(console.log("authKey 验证：",R,e),"success"===R){var t=JSON.parse(e);1==t.status?(n=t.data,$.get("https://"+StarRtc.Instance.msgScheduleUrl+":"+StarRtc.Instance.msgSchedulePort+"/?userId="+r,function(e,R){R="success";console.log("消息调度：",R,e);var t=JSON.parse(e);1==t.status?(S="wss://"+t.data,a.connect()):O({msg:"请求msg调度数据异常"},"connect failed")})):O({msg:"登录验证失败"},"connect failed")}else O({msg:"请求验证地址失败"},"connect failed")}):(n="free",S="wss://"+StarRtc.Instance.msgServerUrl+":"+StarRtc.Instance.msgServerWebsocketPort,a.connect())):(console.log("当前浏览器 Not support websocket"),O({msg:"当前浏览器 Not support websocket"},"connect failed"))},a.connect=function(){console.log("WebSocket："+S),(R=new WebSocket(S)).onerror=function(){console.log("WebSocket连接发生错误"),c({msg:"WebSocket连接发生错误"},"connect failed")},R.onopen=function(){console.log("WebSocket连接成功"),c({msg:"WebSocket连接成功"},"connect success"),a.startAuth()},R.onmessage=function(e){console.log("onmessage",e.data),c(e.data,"onmessage")},R.onclose=function(){console.log("WebSocket连接关闭"),c({msg:"WebSocket连接关闭"},"connect closed"),R=null}},a.close=function(){console.log("关闭WebSocket连接"),StarRtc.AUtils.clear(),null!=R&&R.close()},a.send=function(e){null!=R&&R.send(e)},a.startAuth=function(){StarRtc.AUtils.setUserInfo(E,_,n),a.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructAuthMsg()))},window.onbeforeunload=function(){a.close()}},StarRtc.Instance=new function(){var s=this,n="",c="",S="",a=null,O=null,E=0;s.configModePulic=!0,s.loginServerUrl="ips2.starrtc.com",s.loginServerPort="9920",s.msgScheduleUrl="ips2.starrtc.com",s.msgSchedulePort="9904",s.chatRoomScheduleUrl="ips2.starrtc.com",s.chatRoomSchedulePort="9907",s.srcScheduleUrl="ips2.starrtc.com",s.srcSchedulePort="9929",s.vdnScheduleUrl="ips2.starrtc.com",s.vdnSchedulePort="9926",s.voipServerUrl="voip2.starrtc.com",s.voipServerPort="10086",s.voipServerWebsocketPort="10087",s.voipServerWebrtcPort="10088",s.workServerUrl="https://api.starrtc.com/public",s.webrtcServerIP="123.103.93.74",s.msgServerUrl="ips2.starrtc.com",s.msgServerWebsocketPort="9904",s.chatRoomServerUrl="ips2.starrtc.com",s.chatRoomServerWebsocketPort="9907",s.srcServerUrl="ips2.starrtc.com",s.srcServerWebsocketPort="9929",s.srcServerWebrtcPort="10088",s.vdnServerUrl="ips2.starrtc.com",s.vdnServerWebsocketPort="9929",s.vdnServerWebrtcPort="10088",s.version=function(){return StarRtc.StarManager.version()};var _=function(e,R){switch(R){case"connect failed":case"connect success":case"connect closed":a(e,R);break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){switch(e.appid){case APP_PRODUCT_ID.R:StarRtc.AUtils.parseMessage(e.msgArr,_)}});break;case"onSingleMessage":e.msg=JSON.parse(e.msg);var t=R;if(0==e.msg.type)switch(e.msg.code){case AG_MSG_VOIP_CTRL.h:e.type="voipCall",t="onVoipMessage";break;case AG_MSG_VOIP_CTRL.F:e.type="voipRefuse",t="onVoipMessage";break;case AG_MSG_VOIP_CTRL.K:e.type="voipHangup",t="onVoipMessage";break;case AG_MSG_VOIP_CTRL.W:e.type="voipBusy",t="onVoipMessage";break;case AG_MSG_VOIP_CTRL.B:e.type="voipConnect",t="onVoipMessage";break;default:e.type="voipSingleMsg"}else e.type="voipSingleMsg";(null!=O?O:a)(e,t);break;case"onLoginMessage":case"onGroupMessage":case"onGroupPrivateMessage":case"onGroupPushMessage":case"onSystemPushMessage":case"onErrorMessage":case"onGetGroupList":case"onGetOnlineNumber":case"onGetGroupUserList":case"onGetAllUserList":case"onPushGroupSystemMsgFin":case"onPushSystemMsgFin":case"onUnsetGroupMsgIgnoreFin":case"onSetGroupMsgIgnoreFin":case"onRemoveGroupUserFin":case"onAddGroupUserFin":case"onDelGroupFin":case"onCreateGroupFin":case"onSendGroupMsgFin":null!=O&&O(e,R),a(e,R)}};s.setLoginServerUrl=function(e){s.loginServerUrl=e},s.setMsgScheduleUrl=function(e){s.msgScheduleUrl=e},s.setChatRoomScheduleUrl=function(e){s.chatRoomScheduleUrl=e},s.setSrcScheduleUrl=function(e){s.srcScheduleUrl=e},s.setVdnScheduleUrl=function(e){s.vdnScheduleUrl=e},s.setVoipServerUrl=function(e){s.voipServerUrl=e},s.setWorkServerUrl=function(e){s.workServerUrl=e},s.setWebrtcServerIP=function(e){s.webrtcServerIP=e},s.setMsgServerInfo=function(e,R){s.msgServerUrl=e,s.msgServerWebsocketPort=R},s.setChatRoomServerInfo=function(e,R){s.chatRoomServerUrl=e,s.chatRoomServerWebsocketPort=R},s.setSrcServerInfo=function(e,R,t){s.srcServerUrl=e,s.srcServerWebsocketPort=R,s.srcServerWebrtcPort=t},s.setVdnServerInfo=function(e,R,t){s.vdnServerUrl=e,s.vdnServerWebsocketPort=R,s.vdnServerWebrtcPort=t},s.setVoipServerInfo=function(e,R,t,O){s.voipServerUrl=e,s.voipServerPort=R,s.voipServerWebsocketPort=t,s.voipServerWebrtcPort=O},s.setConfigModePulic=function(e){s.configModePulic=e},s.login=function(e,R,t,O){s.configModePulic||(e="APPID-FREE"),(n=e)+"_"+(c=R),S=t,a=O,StarRtc.StarManager.login(e,R,t,_)},s.logout=function(){StarRtc.StarManager.close()},s.sendSingleMsg=function(e,R,t,O){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructSingleMsg(e,++E,R,t,O)))},s.sendGroupMsg=function(e,R,t){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructGroupMsg(e,++E,R,t)))},s.sendSingleCtrlMsg=function(e,R,t,O){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructSingleCtrlMsg(e,++E,R,t,O)))},s.sendVoipCtrlMsg=function(e,R){var t="";R==AG_MSG_VOIP_CTRL.h&&(t=JSON.stringify({VoIP_protocal_type:"TCP",VoIP_server_IP:StarRtc.Instance.voipServerUrl,VoIP_server_Port:StarRtc.Instance.voipServerPort})),s.sendSingleCtrlMsg(e,"新消息",t,R)},s.sendVoipCallMsg=function(e,R){var t,O=R||(new Date).getTime();t=JSON.stringify({VoIP_protocal_type:"TCP",VoIP_server_IP:StarRtc.Instance.voipServerUrl,VoIP_server_Port:StarRtc.Instance.voipServerPort,ts:O}),s.sendSingleCtrlMsg(e,"新消息",t,AG_MSG_VOIP_CTRL.h)},s.sendVoipRefuseMsg=function(e){s.sendVoipCtrlMsg(e,AG_MSG_VOIP_CTRL.F)},s.sendVoipHungupMsg=function(e){s.sendVoipCtrlMsg(e,AG_MSG_VOIP_CTRL.K),null!=O&&O({type:"voipCancle"},"onVoipMessage")},s.sendVoipBusyMsg=function(e){s.sendVoipCtrlMsg(e,AG_MSG_VOIP_CTRL.W)},s.sendVoipConnectMsg=function(e){s.sendVoipCtrlMsg(e,AG_MSG_VOIP_CTRL.B)},s.setIMExtraback=function(e){O=e},s.getStarRoomSDK=function(e,R,t,O,a,E,_){var r=new StarRtc.StarRoomSDK(e,R,t,O,a,E,_);return r.login(n,c,S),r},s.getVideoMeetingRoomSDK=function(e,R,t){return s.getStarRoomSDK("src",e,R,t,3,1)},s.getVideoLiveRoomSDK=function(e,R,t,O){return s.getStarRoomSDK(e,R,t,O,3,2)},s.getVoipRoomSDK=function(e,R,t){return s.getStarRoomSDK("voip",e,R,t,2,0,s)},s.reportVideoMeetingRoom=function(e,R){s.reportRoom(CHATROOM_LIST_TYPE.X,e,R)},s.reportVideoLiveRoom=function(e,R){s.reportRoom(CHATROOM_LIST_TYPE.J,e,R)},s.reportVideoClassRoom=function(e,R){s.reportRoom(CHATROOM_LIST_TYPE.Z,e,R)},s.reportChatRoom=function(e,R){s.reportRoom(CHATROOM_LIST_TYPE.q,e,R)},s.reportRoom=function(t,e,O){if(!StarRtc.Instance.configModePulic){var a=null,E=e.ID.substring(16,33),_={};_.id=e.ID,_.creator=e.Creator,_.name=e.Name;var r=function(e,R){switch(e.obj=s,R){case"connect success":a.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.vR,{roomId:E,listType:t,userDefineData:encodeURIComponent(JSON.stringify(_))})));break;case"connect failed":O&&O("failed");case"connect closed":a=null;break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.t&&StarRtc.AUtils.parseChatMoonServerMessage(e.msgArr,function(e){r(e,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(e.type){case"saveToChatroomList":O&&O(e.status),a.close()}}};a=new StarRtc.WebrtcWebsocket(r,null);var R="wss://"+StarRtc.Instance.chatRoomServerUrl+":"+StarRtc.Instance.chatRoomServerWebsocketPort;a.connect(R)}},s.delVideoMeetingRoom=function(e,R){s.delRoom(CHATROOM_LIST_TYPE.X,e,R)},s.delVideoLiveRoom=function(e,R){s.delRoom(CHATROOM_LIST_TYPE.J,e,R)},s.delVideoClassRoom=function(e,R){s.delRoom(CHATROOM_LIST_TYPE.Z,e,R)},s.delChatRoom=function(e,R){s.delRoom(CHATROOM_LIST_TYPE.q,e,R)},s.delRoom=function(t,e,O){if(!StarRtc.Instance.configModePulic){var a=null,E=e.ID.substring(16,33),_=function(e,R){switch(e.obj=s,R){case"connect success":a.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.kR,{roomId:E,listType:t})));break;case"connect failed":O&&O("failed");case"connect closed":a=null;break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.t&&StarRtc.AUtils.parseChatMoonServerMessage(e.msgArr,function(e){_(e,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(e.type){case"delFromToChatroomList":O&&O(e.status),a.close()}}};a=new StarRtc.WebrtcWebsocket(_,null);var R="wss://"+StarRtc.Instance.chatRoomServerUrl+":"+StarRtc.Instance.chatRoomServerWebsocketPort;a.connect(R)}},s.queryVideoClassRoom=function(e){s.queryRoom(CHATROOM_LIST_TYPE.Z,e)},s.queryChatRoom=function(e){s.queryRoom(CHATROOM_LIST_TYPE.q,e)},s.queryVideoMeetingRoom=function(e){s.queryRoom(CHATROOM_LIST_TYPE.X,e)},s.queryVideoLiveRoom=function(e){s.queryRoom(CHATROOM_LIST_TYPE.J,e)},s.queryRoom=function(a,E){if(!StarRtc.Instance.configModePulic){var _=null,r=function(e,R){switch(e.obj=s,R){case"connect success":_.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.yR,{listTypes:a.toString(),userId:""})));break;case"connect failed":E&&E("failed");case"connect closed":_=null;break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.t&&StarRtc.AUtils.parseChatMoonServerMessage(e.msgArr,function(e){r(e,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(e.type){case"queryAllChatroomList":if(""==e.listData){E&&E(e.status,[]);break}for(var t=JSON.parse(e.listData).userDefineDataList.split(","),O=0;O<t.length;O++)t[O]=JSON.parse(decodeURIComponent(t[O])),t[O].ID=t[O].id,t[O].Name=t[O].name,t[O].Creator=t[O].creator;E&&E(e.status,t),_.close()}}};_=new StarRtc.WebrtcWebsocket(r,null);var e="wss://"+StarRtc.Instance.chatRoomServerUrl+":"+StarRtc.Instance.chatRoomServerWebsocketPort;_.connect(e)}},s.setGroupMsgPush=function(e){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(e?AG_MSG.Se:AG_MSG.ie,{reqIndex:0})))},s.removeGroupUsers=function(e,R){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.ce,{reqIndex:0,groupId:e,removeUsers:R.join(",")})))},s.addGroupUsers=function(e,R,t){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.ne,{reqIndex:0,groupId:e,addUsers:R.join(","),userDefineData:t})))},s.delGroup=function(e){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.se,{reqIndex:0,groupId:e})))},s.createGroup=function(e,R){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.re,{reqIndex:0,addUsers:e.join(","),userDefineData:R})))},s.getGroupList=function(){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.ye,{reqIndex:0})))},s.getGroupUserList=function(e){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.xe,{reqIndex:0,groupId:e})))},s.getOnlineNumber=function(){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.Ye,{})))},s.getAllUserList=function(e){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.Ke,{reqPageNum:e})))},s.getInfo=function(){return{agentId:n,userId:c,authKey:S}}},StarRtc.WebrtcWebsocket=function(e,R){var t,O=this,a=R,E=e,_=null;return O.startHeartBeat=function(e){_.send(e),t=setInterval(function(){_.send(e)},5e3)},O.stopHeartBeat=function(){clearInterval(t)},O.connect=function(e){console.log("webrtcConnect"+e),(_=new WebSocket(e)).onerror=function(e){console.log("WebSocket连接发生错误"),E({msg:"WebSocket连接发生错误",data:e.data},"connect failed")},_.onopen=function(){console.log("WebSocket连接成功"),E({msg:"WebSocket连接成功"},"connect success")},_.onmessage=function(e){console.log("onmessage",e.data),E(e.data,"onmessage")},_.onclose=function(e){console.log("WebSocket连接关闭"),O.stopHeartBeat(),E({msg:"WebSocket连接关闭",data:e.code},"connect closed"),_=null}},O.starConnect=function(O){$.get(a,function(e,R){if(console.log("消息调度：",R,e),"success"===R){var t=JSON.parse(e);1==t.status?O("success",t.data):O("failed")}else O("failed")})},O.send=function(e){_.send(e)},O.close=function(){null!=_&&_.close()},O.readyState=function(){return null!=_?_.readyState:-1},O},StarRtc.StarRoomSDK=function(e,R,t,O,a,E,_){var r="我要上麦！",s=this,n="",c=R,S=e,i=O,I=t,o=a||3,A=0!=(1&o),N=0!=(2&o),M=null,V=null,C=null,T=null,P=!1,u=null,L=_;function G(){null!=u&&(clearInterval(u),u=null)}function l(e){if(null!=e){var R=e.getState();0<=R&&R<2&&e.sigDisconnect()}}function p(){var e=!0;return A&&(e=e&&(3==C.getState()||-1==C.getState())),N&&(e=e&&(3==M.getState()||-1==M.getState())),e}null!=L&&"voip"==e&&L.setIMExtraback(function(e,R){D(e,"onVoipMessage")});var D=function(e,R){switch(e.userData=i,e.obj=s,R){case"connect success":N?M.sigConnect():I(e,R,c);break;case"connect failed":case"connect closed":N&&l(M),p()&&I(e,R,c);break;case"onmessage":break;case"onChatRoomMessage":switch(e.type){case"createChatRoom":"success"==e.status&&(i.roomInfo.ID=e.chatroomId,i.roomInfo.Creator=n,N&&(V.roomInfo.Name=e.chatroomId,M.createNew()));break;case"deleteChatRoom":"success"==e.status&&(N?M.deleteCurrRoom():I(e,R,c));break;case"joinChatRoom":"success"==e.status&&N&&M.joinRoom();break;case"recvChatPrivateMsg":if(0==e.msg.type)switch(e.msg.code){case 2e3:e.msg.msgType="apply";break;case 2002:e.msg.msgType="applyAgree";break;case 2004:e.msg.msgType="applyDisagree";break;case 2200:e.msg.msgType="linkStop";break;case 2100:e.msg.msgType="invite";break;case 2102:e.msg.msgType="inviteAgree";break;case 2106:e.msg.msgType="inviteDisagree";break;case 2104:e.msg.msgType="inviteLinkStart";break;default:e.msg.msgType="common"}}I(e,R,c);break;case"onVoipMessage":switch(e.type){case"voipCall":e.fromId!=i.roomInfo.targetId&&L.sendVoipBusyMsg(e.fromId);break;case"voipHangup":e.fromId==i.roomInfo.targetId&&(s.leaveRoom(!0),I(e,R,c));break;case"voipBusy":G(),s.leaveRoom(!0),I(e,R,c);break;case"voipConnect":case"voipRefuse":G(),I(e,R,c);break;case"voipCancle":G();break;default:I(e,R,c)}}};return V=clone(i),T=clone(i),N&&A&&i.roomInfo.ID&&(V.roomInfo.ID=i.roomInfo.ID.substring(0,16),T.roomInfo.ID=i.roomInfo.ID.substring(16,33)),N&&(M=new StarRtc.StarVideoSDK(e,R,function(e,R){switch(e.userData=i,e.obj=s,R){case"connect success":I(e,R,c);break;case"connect closed":case"connect failed":G(),A&&l(C),p()&&I(e,R,c);break;case"onmessage":break;case"onWebrtcMessage":switch(e.type){case"delChannel":"success"==e.status?I(e,R,c):alert("删除视频会议失败");break;case"createChannel":"success"==e.status&&(i.roomInfo.Creator=n,i.roomInfo.ID=A?e.channelId+i.roomInfo.ID:e.channelId),I(e,R,c);break;case"voipCallingAck":if(null!=L){G();var t=(new Date).getTime();L.sendVoipCallMsg(i.roomInfo.targetId,t),E=i.roomInfo.targetId,O=function(){L.sendVoipCallMsg(E,t)},a=3e3,null!=u&&G(),u=setInterval(O,a)}break;case"voipResponseing":"success"==e.status&&null!=L&&L.sendVoipConnectMsg(i.roomInfo.targetId),I(e,R,c);break;default:I(e,R,c)}}var O,a,E},V,E)),A&&(C=new StarRtc.StarChatSDK(R,D,T)),s.login=function(e,R,t){e+"_"+(n=R),t,A&&C.login(e,R,t),N&&M.login(e,R,t)},s.sigConnect=function(){P=!1,A?C.sigConnect():N&&M.sigConnect()},s.sigDisconnect=function(e){null==e&&(e=!0),P=e,N?M.sigDisconnect(e):A&&C.sigDisconnect(e)},s.createNew=function(){"voip"!=S&&(A?C.createNew():N&&M.createNew())},s.deleteCurrRoom=function(){"voip"!=S&&(A?C.deleteCurrRoom():N&&M.deleteCurrRoom())},s.createStream=function(e){N&&M.createStream(e)},s.joinRoom=function(){A&&"new"!=c?C.joinRoom():N&&M.joinRoom()},s.leaveRoom=function(e){if(N){switch(S){case"voip":var R=e||!1;null==L||R||L.sendVoipHungupMsg(i.roomInfo.targetId),L.setIMExtraback(null)}M.leaveRoom(R)}else A&&C.leaveRoom()},s.streamConfigChange=function(e){N&&M.streamConfigChange(e)},s.sendChatMsg=function(e){A&&C.sendChatMsg(e)},s.sendVoipMsg=function(e){"voip"==S&&null!=L&&L.sendSingleMsg(i.roomInfo.targetId,"新媒体",e)},s.sendChatPrivateMsg=function(e,R){A&&C.sendChatPrivateMsg(e,R)},s.sendApplyMsg=function(){A&&N&&"vdn"==S&&C.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2e3)},s.sendApplyAgreeMsg=function(e){A&&N&&"src"==S&&C.sendChatCtrlPrivateMsg(e,r,2002)},s.sendApplyDisagreeMsg=function(e){A&&N&&"src"==S&&C.sendChatCtrlPrivateMsg(e,r,2004)},s.sendInviteLinkMsg=function(e){A&&N&&"src"==S&&C.sendChatCtrlPrivateMsg(e,r,2100)},s.sendInviteLinkAgreeMsg=function(){A&&N&&"vdn"==S&&C.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2102)},s.sendInviteLinkDisagreeMsg=function(){A&&N&&"vdn"==S&&C.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2106)},s.sendInviteLinkStartMsg=function(){A&&N&&"vdn"==S&&C.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2104)},s.sendLinkStopMsg=function(e){A&&N&&"src"==S&&C.sendChatCtrlPrivateMsg(e,r,2200)},s.kickOutUser=function(e){A&&C.kickOutUser(e)},s.banToSendMsg=function(e,R){A&&C.banToSendMsg(e,R)},s.getRoomOnlineNum=function(){A&&C.getRoomOnlineNum()},s.sendStreamData=function(e){N&&"src"==S&&M.sendStreamData(e)},s.activeDisconnect=function(){return P},s.getUserData=function(){return i},s.startLocalStream=function(e){N&&M.startLocalStream(e)},s},StarRtc.StarVideoSDK=function(e,R,t,O,a){var n,c,S=this,i="",I="",o=O,A=e,N=t,M=R,V=null,C="",T={},P={},E=a||1,u={siv:0,uperInfos:{}},L=StarWebRTC();L.init();var G=!1,_=!1,r=function(e){switch(e.type){case"createOffer":if("success"==e.status){switch(A){case"src":e.channelId=o.roomInfo.ID;break;case"vdn":e.ssrc=e.bigVideoSSRC;break;case"voip":e.targetId=o.roomInfo.targetId,e.videoSSRC=e.bigVideoSSRC}S.joinRoomInternal(e)}break;case"applyAnswer":e.status}},s=function(e,R){var t={type:"streamCreated",streamObj:R};t.userData=o,t.obj=S,"success"==e?t.status="success":(t.status="failed",t.error=R),N(t,"onWebrtcMessage",M)},l=function(e,R){switch(e.userData=o,e.obj=S,R){case"connect success":var t=null;switch(A){case"src":t=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructHeartBeatMsg(AG_LIVESRCMOONSERVER.aO));break;case"vdn":t=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.T,StarRtc.AUtils.constructHeartBeatMsg(AG_LIVEVDNMOONSERVER.ea))}V.startHeartBeat(t),L.setServerInfo({serverIp:T.ip,serverPort:T.webrtcPort}),N(e,R,M);break;case"connect failed":case"connect closed":L.destroy(),V=null,N(e,R,M);break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.i?StarRtc.AUtils.parseSrcMoonServerMessage(e.msgArr,function(e){l(e,"onWebrtcMessage")}):e.appid==APP_PRODUCT_ID.I?StarRtc.AUtils.parseVdnMoonServerMessage(e.msgArr,function(e){l(e,"onWebrtcMessage")}):e.appid==APP_PRODUCT_ID.o&&StarRtc.AUtils.parseVoipMoonServerMessage(e.msgArr,function(e){l(e,"onWebrtcMessage")})});break;case"onWebrtcMessage":switch(e.type){case"uperStreamInfoUpdate":if("success"==e.status){if(G)for(var O=0;O<7;++O){var a=L.getStreamByIndex(O),E=void 0;0!=Object.keys(u.uperInfos).length&&(E=u.uperInfos[O]);var _=e.msg.uperInfos[O];if(null==E&&null!=_)_.userId!=I&&N({type:"addUploader",upId:_.upId,upUserId:_.userId,streamInfo:a,room:S},R,M);else if(null!=E&&null==_){var r=c==E.upId;r&&(c=n=void 0),L.resetStreamInfo(a),N({type:"removeUploader",upId:E.upId,upUserId:E.userId,streamInfo:a,bigFlag:r,room:S},R,M)}else null!=E&&null!=_&&E.userId!=_.userId&&N({type:"changeUploader",upId:_.upId,oldUpUserId:E.userId,newUpUserId:_.userId,streamInfo:a,room:S},R,M)}u=e.msg}break;case"webrtcConnect":if("success"==e.status)switch(A){case"vdn":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.T,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.zO,{channelId:o.roomInfo.ID})));break;case"src":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.Qt,P)))}break;case"webrtcReg":if("success"==e.status)switch(A){case"vdn":case"src":C=e.fingerprint,L.emit("_webrtc_apply_ok",C,function(){G=!0},102,111)}else console.log("webrtcReg failed");break;case"vdnApplyDownload":N(e,R,M),"success"==e.status?l({type:"uperStreamInfoUpdate",status:"success",msg:e.uperInfos},"onWebrtcMessage"):console.log("收到vdnApplyDownload failed");break;case"srcApplyUpload":if(N(e,R,M),"success"==e.status){e.tmpData=P,console.log("收到_webrtc_apply_ok");var s=clone(u);u.uperInfos={},l({type:"uperStreamInfoUpdate",status:"success",msg:s},"onWebrtcMessage")}else console.log("收到srcApplyUpload failed");break;case"streamConfig":if("success"==e.status){if(n==c){a=L.getStreamByIndex(n);L.switchStreamInfo(a);break}if(null!=n){a=L.getStreamByIndex(n);L.switchStreamInfo(a)}if(null!=c){a=L.getStreamByIndex(c);L.switchStreamInfo(a)}}break;case"createChannel":"success"==e.status&&(o.roomInfo.ID=e.channelId,o.roomInfo.Creator=i),N(e,R,M);break;case"delChannel":"success"==e.status&&(o.roomInfo.ID=""),N(e,R,M);break;case"serverErr":break;case"voipResponseing":case"voipCalling":"success"==e.status&&(console.log("收到_webrtc_apply_ok"),L.emit("_webrtc_apply_ok",e.fingerprint,function(){l({type:"voipStreamReady",status:"success"},"onWebrtcMessage")})),N(e,R,M);break;case"voipStreamReady":a=L.getStreamByIndex(0);L.switchStreamInfo(a),N({type:"voipStreamReady",streamObj:a.streamObj,room:S},R,M);break;default:N(e,R,M)}}};return S.login=function(e,R,t){I=e+"_"+(i=R),t},S.sigConnect=function(){switch(_=!1,T.ip=StarRtc.Instance.webrtcServerIP,V=null,A){case"src":if(!StarRtc.Instance.configModePulic){V=new StarRtc.WebrtcWebsocket(l,null),(t={}).ip=StarRtc.Instance.srcServerUrl,T.websocketPort=StarRtc.Instance.srcServerWebsocketPort,T.webrtcPort=StarRtc.Instance.srcServerWebrtcPort,t.websocketPort=T.websocketPort;var e="wss://"+t.ip+":"+t.websocketPort;return void V.connect(e)}var R="https://"+StarRtc.Instance.srcScheduleUrl+":"+StarRtc.Instance.srcSchedulePort+"?userId="+I;V=new StarRtc.WebrtcWebsocket(l,R);break;case"vdn":if(!StarRtc.Instance.configModePulic){V=new StarRtc.WebrtcWebsocket(l,null),(t={}).ip=StarRtc.Instance.vdnServerUrl,T.websocketPort=StarRtc.Instance.vdnServerWebsocketPort,T.webrtcPort=StarRtc.Instance.vdnServerWebrtcPort,t.websocketPort=T.websocketPort;e="wss://"+t.ip+":"+t.websocketPort;return void V.connect(e)}R="https://"+StarRtc.Instance.vdnScheduleUrl+":"+StarRtc.Instance.vdnSchedulePort+"?userId="+I+"&channelId="+o.channelId;V=new StarRtc.WebrtcWebsocket(l,R);break;case"voip":var t;V=new StarRtc.WebrtcWebsocket(l,null),(t={}).ip=StarRtc.Instance.voipServerUrl,T.websocketPort=StarRtc.Instance.voipServerWebsocketPort,T.webrtcPort=StarRtc.Instance.voipServerWebrtcPort,t.websocketPort=T.websocketPort;e="wss://"+t.ip+":"+t.websocketPort;return void V.connect(e);default:return}V.starConnect(function(e,R){if("success"==e){T.websocketPort=R.websocketPort,T.webrtcPort=R.webrtcPort;var t="wss://"+R.ip+":"+R.websocketPort;V.connect(t)}})},S.sigDisconnect=function(e){null==e&&(e=!0),_=e,null!=V&&(V.close(),V=null)},S.createNew=function(){if(null!=V)switch(A){case"src":var e="1";2==E&&(e="2");var R=AG_LIVESRCMOONSERVER.Ft;1==o.roomInfo.Type&&(R=AG_LIVESRCMOONSERVER.Kt),V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructSrcProtocol(R,{conCurrentNum:7,roomId:o.roomInfo.Name,extra:e,liveType:parseInt(e)})))}},S.deleteCurrRoom=function(){if(null!=V)switch(A){case"src":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.eO,{channelId:o.roomInfo.ID})))}},S.createStream=function(e){null==e&&(e={video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:25},facingMode:{ideal:["user"]}},audio:{deviceId:{ideal:["default"]}}}),"vdn"==A&&(e={video:!1,audio:!1}),L.createStream(e,s)},S.joinRoom=function(){L.emit("ready",r,"voip"==A)},S.joinRoomInternal=function(e){switch(P=e,A){case"src":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.qO,e)));break;case"vdn":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.T,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.$O,e)));break;case"voip":"call"==M?V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.FR,e))):"response"==M&&V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.WR,e)))}},S.leaveRoom=function(e){if(null!=V&&1==V.readyState())switch(A){case"src":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.Zt,{channelId:o.roomInfo.ID})));break;case"vdn":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.T,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.ZO,{})));case"voip":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.JR,{isActive:e?0:1})))}},S.streamConfigChange=function(e){if(null!=V){c==e?(c=n,n=e):(n=c,c=e);var R=L.getStreamInfos(),t=[];for(var O in R){var a=0;a=n==c?R[O].switchFlag?1:2:O==n?1:O==c?2:R[O].switchFlag?2:1,t.push(a)}switch(A){case"src":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.RO,{streamConfig:t})));break;case"vdn":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.T,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.ta,{streamConfig:t})))}}},S.getState=function(){return null!=V?V.readyState():-1},S.getType=function(){return A},S.sendStreamData=function(e){switch(A){case"src":V.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.T,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.OO,{streamData:e,streamDataType:8})))}},S.activeDisconnect=function(){return _},S.startLocalStream=function(e){L.startLocalStream(e)},S},StarRtc.StarChatSDK=function(e,R,t){var O=this,a="",E="",_={},r=t,s=R,n=e,c=null,S=0,i=!1,I=function(e,R){switch(e.userData=r,e.obj=O,R){case"connect success":var t;t=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructHeartBeatMsg(AG_CHATROOMMOONSERVER.ze)),c.startHeartBeat(t),s(e,R,n);break;case"connect failed":case"connect closed":c=null,s(e,R,n);break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.t&&StarRtc.AUtils.parseChatMoonServerMessage(e.msgArr,function(e){I(e,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(e.type){case"createChatRoom":"success"==e.status&&(r.roomInfo.ID=e.chatroomId,r.roomInfo.Creator=a);break;case"deleteChatRoom":case"joinChatRoom":e.status;break;case"recvChatPrivateMsg":case"recvChatMsg":if(""==e.fromUserId||""==e.msg)return;if(e.msg=JSON.parse(e.msg),e.msg.fromId==a)return}s(e,R,n)}};return O.login=function(e,R,t){E=e+"_"+(a=R),t},O.sigConnect=function(){if(i=!1,StarRtc.Instance.configModePulic){var e="https://"+StarRtc.Instance.chatRoomScheduleUrl+":"+StarRtc.Instance.chatRoomSchedulePort+"/?userId="+E;(c=new StarRtc.WebrtcWebsocket(I,e)).starConnect(function(e,R){if("success"==e){var t=R.split(":");_.ip=t[0],_.port=t[1];var O="wss://"+_.ip+":"+_.port;c.connect(O)}})}else{c=new StarRtc.WebrtcWebsocket(I,null),_.ip=StarRtc.Instance.chatRoomServerUrl,_.port=StarRtc.Instance.chatRoomServerWebsocketPort;var R="wss://"+_.ip+":"+_.port;c.connect(R)}},O.sigDisconnect=function(e){null==e&&(e=!0),i=e,null!=c&&(c.close(),c=null)},O.createNew=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Qe,{roomType:0==r.roomInfo.Type?1:2,conCurrentNum:100,userDefineData:r.roomInfo.Name})))},O.sendChatMsg=function(e){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.tR,{roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:e})))},O.sendChatPrivateMsg=function(e,R){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.OR,{toUserId:e,roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:R,type:"1",code:"0"})))},O.sendChatCtrlPrivateMsg=function(e,R,t){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.OR,{toUserId:e,roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:R,type:"0",code:t})))},O.kickOutUser=function(e){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.$e,{kickOutUserId:e})))},O.banToSendMsg=function(e,R){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Xe,{banUserId:e,banTime:R})))},O.getRoomOnlineNum=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.aR,{roomId:r.roomInfo.ID})))},O.deleteCurrRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.je)))},O.joinRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Ze,{roomId:r.roomInfo.ID})))},O.leaveRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.RR)))},O.getState=function(){return null!=c?c.readyState():-1},O.activeDisconnect=function(){return i},O},module.exports=exports=StarRtc;