import $ from 'jquery'
import StarWebRTC from './star_rtc_video.min'
var StarRtc=window.NameSpace||{};if(void 0===APP_PRODUCT_ID)var i=0,APP_PRODUCT_ID={R:i++,O:i++,t:i++,_:i++,s:i++,S:i++,i:i++,I:i++,o:i++,A:i++,N:i++};if(void 0===ACTION_GROUP_ID){i=0;var ACTION_GROUP_ID={M:i++,V:i++,T:i++,C:i++,P:i++,u:i++}}if(void 0===MSG_TYPE){i=0;var MSG_TYPE={L:i++,G:i++,l:i++,D:i++,p:i++}}if(void 0===MSG_DATA_TYPE){i=0;var MSG_DATA_TYPE={U:i++,v:i++,H:i++,m:i++}}if(void 0===ENCRYPT_TYPE){i=0;var ENCRYPT_TYPE={k:i++,g:i++}}if(void 0===AG_MSG_VOIP_CTRL)var AG_MSG_VOIP_CTRL={h:1e3,Y:1100,F:1001,W:1002,K:1003,B:1004};if(void 0===CHATROOM_LIST_TYPE){i=0;var CHATROOM_LIST_TYPE={J:i++,j:i++,q:i++,X:i++,$:i++,Z:i++,ee:i++}}if(void 0===AG_MSG){i=0;var AG_MSG={Re:i++,Oe:i++,te:i++,Ee:i++,_e:i++,ae:i++,re:i++,ne:i++,se:i++,ce:i++,Se:i++,ie:i++,Ie:i++,oe:i++,Ae:i++,Ne:i++,Me:i++,Ve:i++,Te:i++,Ce:i++,Pe:i++,ue:i++,Le:i++,Ge:i++,le:i++,fe:i++,De:i++,pe:i++,Ue:i++,ve:i++,de:i++,He:i++,be:i++,me:i++,ke:i++,ge:i++,ye:i++,we:i++,he:i++,Ye:i++,xe:i++,Fe:i++,We:i++,Ke:i++,Be:i++}}if(void 0===CHAT_ROOM_TYPE){i=1;var CHAT_ROOM_TYPE={Je:i++,Qe:i++}}if(void 0===AG_CHATROOMMOONSERVER){i=0;var AG_CHATROOMMOONSERVER={je:i++,qe:i++,Xe:i++,$e:i++,ze:i++,Ze:i++,eR:i++,RR:i++,OR:i++,tR:i++,ER:i++,_R:i++,aR:i++,rR:i++,nR:i++,sR:i++,cR:i++,SR:i++,iR:i++,IR:i++,oR:i++,AR:i++,NR:i++,MR:i++,VR:i++,TR:i++,CR:i++,PR:i++,uR:i++,LR:i++,GR:i++,lR:i++,fR:i++,DR:i++,pR:i++,UR:i++,vR:i++,dR:i++,HR:i++,bR:i++,mR:i++,kR:i++,gR:i++,yR:i++,wR:i++}}if(void 0===AG_VOIPMOONSERVER){i=0;var AG_VOIPMOONSERVER={hR:i++,YR:i++,xR:i++,FR:i++,WR:i++,KR:i++,BR:i++,JR:i++,QR:i++,jR:i++,qR:i++,XR:i++,$R:i++,zR:i++,ZR:i++,eO:i++,RO:i++,OO:i++,tO:i++,EO:i++,_O:i++,aO:i++,rO:i++,nO:i++,sO:i++,cO:i++,SO:i++,iO:i++,IO:i++,oO:i++,AO:i++,NO:i++,MO:i++,VO:i++,TO:i++,CO:i++,PO:i++,uO:i++,LO:i++}}if(void 0===AG_LIVESRCMOONSERVER){i=0;var AG_LIVESRCMOONSERVER={GO:i++,lO:i++,fO:i++,DO:i++,pO:i++,UO:i++,vO:i++,dO:i++,HO:i++,bO:i++,mO:i++,kO:i++,gO:i++,yO:i++,wO:i++,hO:i++,YO:i++,xO:i++,FO:i++,WO:i++,KO:i++,BO:i++,JO:i++,QO:i++,jO:i++,qO:i++,XO:i++,$O:i++,zO:i++,ZO:i++,et:i++,Rt:i++,Ot:i++,tt:i++,Et:i++,_t:i++,at:i++,rt:i++,nt:i++,st:i++,ct:i++,St:i++,it:i++,It:i++,ot:i++,At:i++,Nt:i++,Mt:i++,Vt:i++,Tt:i++,Ct:i++,Pt:i++,ut:i++,Lt:i++,Gt:i++,lt:i++,ft:i++,Dt:i++,pt:i++,Ut:i++,vt:i++,dt:i++,Ht:i++}}if(void 0===AG_LIVEVDNMOONSERVER){i=0;var AG_LIVEVDNMOONSERVER={bt:i++,kt:i++,gt:i++,yt:i++,wt:i++,ht:i++,Yt:i++,xt:i++,Ft:i++,Wt:i++,Kt:i++,Bt:i++,Jt:i++,Qt:i++,jt:i++,qt:i++,Xt:i++,$t:i++,zt:i++,Zt:i++,eE:i++,RE:i++,OE:i++}}function clone(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return(R=new Date).setTime(e.getTime()),R;if(e instanceof Array){for(var R=[],O=e.length,t=0;t<O;++t)R[t]=clone(e[t]);return R}if(e instanceof Object){R={};for(var E in e)e.hasOwnProperty(E)&&(R[E]=clone(e[E]));return R}throw new Error("Unable to copy obj! Its type isn't supported.")}StarRtc.AUtils=new function(){var d,H=this,b="",m="",k="",g="";function T(e,R){for(var O=Y(e),t=F(w(O.length.toString(16))),E=Y(R),_=F(w(E.length.toString(16))),a=new Uint8Array(O.length+E.length+8),r=0,n=t.length,s=r;s<n;s++)a[s]=t[s-r];n=(r=n)+O.length;for(s=r;s<n;s++)a[s]=O[s-r];n=(r=n)+_.length;for(s=r;s<n;s++)a[s]=_[s-r];n=(r=n)+E.length;for(s=r;s<n;s++)a[s]=E[s-r];return a}function y(e){var R=new Uint8Array(e),O=0,t=parseInt("0x"+W(R.slice(O,O+4)));O+=4;var E=x(R.slice(O,O+t));O+=t;var _=parseInt("0x"+W(R.slice(O,O+4)));return O+=4,{digest:E,content:x(R.slice(O,O+_))}}function w(e){var R=8-e.length;return"00000000".substr(0,R)+e}function h(e){var R=4-e.length;return"0000".substr(0,R)+e}function N(e,R){var O=new Array(e+1).join("0"),t=e-R.length;return O.substr(0,t)+R}function Y(e){var R,O,t=new Array;R=e.length;for(var E=0;E<R;E++)65536<=(O=e.charCodeAt(E))&&O<=1114111?(t.push(O>>18&7|240),t.push(O>>12&63|128),t.push(O>>6&63|128),t.push(63&O|128)):2048<=O&&O<=65535?(t.push(O>>12&15|224),t.push(O>>6&63|128),t.push(63&O|128)):128<=O&&O<=2047?(t.push(O>>6&31|192),t.push(63&O|128)):t.push(255&O);return t}function x(e){if("string"==typeof e)return e;for(var R="",O=e,t=0;t<O.length;t++){var E=O[t].toString(2),_=E.match(/^1+?(?=0)/);if(_&&8==E.length){for(var a=_[0].length,r=O[t].toString(2).slice(7-a),n=1;n<a;n++)r+=O[n+t].toString(2).slice(2);R+=String.fromCharCode(parseInt(r,2)),t+=a-1}else R+=String.fromCharCode(O[t])}return R}function F(e){var R=0,O=e.length;if(O%2!=0)return null;O/=2;for(var t=new Array,E=0;E<O;E++){var _=e.substr(R,2),a=parseInt("0x"+_);t.push(a),R+=2}return t}function W(e){for(var R="",O=0;O<e.length;O++){var t=e[O].toString(16);1==t.length&&(t="0"+t),R+=t}return R}function K(e,R,O){var t=R;for(var E in O)for(var _=O[E],a=0;a<_.length;a++,t++)e[t]=_[a]}H.msgMaxLen=0,H.setUserInfo=function(e,R,O){k=(b=e)+"_"+(m=R),g=O},H.clear=function(){g=k=m=b="",H.msgMaxLen=0,clearInterval(d)},H.parseProtocol=function(e,c){var R=new Blob([e],{type:"text/plain"}),S=new FileReader;S.readAsArrayBuffer(R),S.onload=function(e){var R=new Uint8Array(S.result);console.info("parseProtocol:",R);var O=R[0],t=R.slice(1,5),E=R[5],_=R.slice(6,8),a=R.slice(8,10),r=R[10],n=R.slice(11,R.byteLength-2);console.info("parseProtocol: msgArr = ",n);var s=R.slice(R.byteLength-2,R.byteLength);c({appid:O,plength:t,appver:E,rese1:_,rese2:a,actionid:r,msgArr:n,end:s})}},H.packageProtocol=function(e,R,O){var t=e,E=new Array(255,255),_=new Array(255,255),a=R,r=(new Array(18,52),O),n=new Uint8Array(r),s=F(w((r.byteLength+12).toString(16))),c=new ArrayBuffer(r.byteLength+13),S=new Uint8Array(c);S[0]=t;for(var i=1;i<5;i++)S[i]=s[i-1];S[5]=1,S[6]=E[0],S[7]=E[1],S[8]=_[0],S[9]=_[1],S[10]=a;for(i=11;i<11+n.byteLength;i++)S[i]=n[i-11];return S[11+n.byteLength]=18,S[12+n.byteLength]=52,console.log("packageProtocol",S),S},H.constructAuthMsg=function(){for(var e=F(h(AG_MSG.Re.toString(16))),R=Y(k),O=F(h(R.length.toString(16))),t=Y(g),E=new Uint8Array(R.length+36),_=0,a=e.length,r=_;r<a;r++)E[r]=e[r];a=(_=a)+O.length;for(r=_;r<a;r++)E[r]=O[r-_];a=(_=a)+R.length;for(r=_;r<a;r++)E[r]=R[r-_];a=(_=a)+t.length;for(r=_;r<a;r++)E[r]=t[r-_];_=0;var n=[];return n.push(e),n.push(O),n.push(R),n.push(t),K(E,_,n),E},H.constructMsgProtocol=function(e,R){var O,t=[],E=F(h(e.toString(16))),_=Y(k),a=F(h(_.length.toString(16)));F(h(Y(g).length.toString(16)));switch(e){case AG_MSG.re:case AG_MSG.ne:case AG_MSG.se:case AG_MSG.ce:case AG_MSG.Se:case AG_MSG.ie:case AG_MSG.Ie:case AG_MSG.oe:case AG_MSG.Ae:break;case AG_MSG.ye:var r=F(w(R.reqIndex.toString(16)));O=new Uint8Array(6+(2+_.length)),t.push(E),t.push(r),t.push(a),t.push(_);break;case AG_MSG.he:r=F(w(R.reqIndex.toString(16)));var n=Y(R.groupId),s=F(h(n.length.toString(16)));O=new Uint8Array(6+(2+_.length)+(2+n.length)),t.push(E),t.push(r),t.push(a),t.push(_),t.push(s),t.push(n);break;case AG_MSG.xe:O=new Uint8Array(2),t.push(E);break;case AG_MSG.We:O=new Uint8Array(4);var c=F(h(R.reqPageNum.toString(16)));t.push(E),t.push(c)}return K(O,0,t),O},H.constructSingleMsg=function(e,R,O,t,E){var _=F(h(AG_MSG.ae.toString(16))),a=Y(k),r=F(h(a.length.toString(16))),n=Y(b+"_"+e),s=F(h(n.length.toString(16))),c=F(w(R.toString(16))),S=ENCRYPT_TYPE.k,i=MSG_DATA_TYPE.v;null!=E&&(i=E);var I={fromId:m,targetId:e,time:"0",msgIndex:R,type:1,code:0,contentData:t},o=T(O,JSON.stringify(I)),A=F(w(o.length.toString(16))),N=new Uint8Array(a.length+n.length+o.length+16),M=[];return M.push(_),M.push(r),M.push(a),M.push(s),M.push(n),M.push(c),M.push([S]),M.push([i]),M.push(A),M.push(o),K(N,0,M),N},H.constructGroupMsg=function(e,R,O,t){var E=F(h(AG_MSG.Ae.toString(16))),_=Y(""),a=F(h(_.length.toString(16))),r=F(w(R.toString(16))),n=Y(b+"_"+e),s=F(h(n.length.toString(16))),c=Y(k),S=F(h(c.length.toString(16))),i=ENCRYPT_TYPE.k,I=MSG_DATA_TYPE.v,o={fromId:m,targetId:e,time:"0",msgIndex:R,type:1,code:0,contentData:t},A=T(O,JSON.stringify(o)),N=F(w(A.length.toString(16))),M=new Uint8Array(_.length+n.length+c.length+A.length+18),V=[];return V.push(E),V.push(a),V.push(_),V.push(r),V.push(s),V.push(n),V.push(S),V.push(c),V.push([i]),V.push([I]),V.push(N),V.push(A),K(M,0,V),M},H.constructReceivedMsg=function(e){var R=F(h(AG_MSG.De.toString(16))),O=Y(k),t=F(h(O.length.toString(16))),E=new Uint8Array(e),_=new Uint8Array(O.length+12),a=[];return a.push(R),a.push(t),a.push(O),a.push(E),K(_,0,a),_},H.constructSingleCtrlMsg=function(e,R,O,t,E){var _=F(h(AG_MSG.ae.toString(16))),a=Y(k),r=F(h(a.length.toString(16))),n=Y(b+"_"+e),s=F(h(n.length.toString(16))),c=F(w(R.toString(16))),S=ENCRYPT_TYPE.k,i=MSG_DATA_TYPE.U,I={fromId:m,targetId:e,time:"0",msgIndex:R,type:0,code:parseInt(E),contentData:t},o=T(O,JSON.stringify(I)),A=F(w(o.length.toString(16))),N=new Uint8Array(a.length+n.length+o.length+16),M=[];return M.push(_),M.push(r),M.push(a),M.push(s),M.push(n),M.push(c),M.push([S]),M.push([i]),M.push(A),M.push(o),K(N,0,M),N},H.constructVOIPProtocol=function(e,R){var O,t=[],E=F(h(e.toString(16))),_=Y(k),a=F(h(_.length.toString(16))),r=Y(g),n=F(h(r.length.toString(16)));switch(e){case AG_VOIPMOONSERVER.FR:case AG_VOIPMOONSERVER.KR:var s=Y(b+"_"+R.targetId),c=F(h(s.length.toString(16))),S=F(N(8,parseInt(R.audioSSRC).toString(16))),i=F(N(8,parseInt(R.videoSSRC).toString(16))),I=F(N(2,parseInt(R.videoCodec).toString(16))),o=F(N(2,parseInt(R.audioCodec).toString(16)));O=new Uint8Array(2+(2+_.length)+(2+r.length)+(2+s.length)+4+4+1+1),t.push(E),t.push(a),t.push(_),t.push(n),t.push(r),t.push(c),t.push(s),t.push(S),t.push(i),t.push(I),t.push(o);break;case AG_VOIPMOONSERVER.QR:var A=R.isActive;O=new Uint8Array(3),t.push(E),t.push([A])}return K(O,0,t),O},H.constructSrcProtocol=function(e,R){var O,t=[],E=F(h(e.toString(16))),_=F(h((o=Y(k)).length.toString(16))),a=F(h((A=Y(g)).length.toString(16)));switch(e){case AG_LIVESRCMOONSERVER.xO:case AG_LIVESRCMOONSERVER.FO:var r=F(h(R.conCurrentNum.toString(16))),n=F(h((0).toString(16))),s=F(h((i=Y(R.roomId)).length.toString(16))),c=R.liveType,S=F(h((V=Y(R.extra)).length.toString(16)));O=new Uint8Array(2+(2+o.length)+(2+A.length)+2+2+(2+i.length)+1+(2+V.length)),t.push(E),t.push(_),t.push(o),t.push(a),t.push(A),t.push(r),t.push(n),t.push(s),t.push(i),t.push([c]),t.push(S),t.push(V);break;case AG_LIVESRCMOONSERVER.WO:r=F(h(R.conCurrentNum.toString(16))),n=F(h(R.validTime.toString(16))),s=F(h((i=Y(R.roomId)).length.toString(16))),S=F(h((V=Y(R.extra)).length.toString(16)));var i,I=F(h((T=Y(R.spec)).length.toString(16)));t.push(E),t.push(_),t.push(o),t.push(a),t.push(A),t.push(r),t.push(n),t.push(s),t.push(i),t.push(S),t.push(V),t.push(I),t.push(T);break;case AG_LIVESRCMOONSERVER.KO:E=F(h(e.toString(16))),_=F(h((o=Y(m)).length.toString(16))),a=F(h((A=Y(g)).length.toString(16))),n=F(h((0).toString(16)));var o,A,N=F(h((M=Y(R.groupId)).length.toString(16)));S=F(h((V=Y(R.extra)).length.toString(16)));t.push(E),t.push(_),t.push(o),t.push(a),t.push(A),t.push(n),t.push(N),t.push(M),t.push(S),t.push(V);break;case AG_LIVESRCMOONSERVER.BO:var M,V,T;n=F(h((0).toString(16))),N=F(h((M=Y(R.groupId)).length.toString(16))),S=F(h((V=Y(R.extra)).length.toString(16))),I=F(h((T=Y(R.spec)).length.toString(16)));t.push(E),t.push(_),t.push(o),t.push(a),t.push(A),t.push(n),t.push(N),t.push(M),t.push(S),t.push(V),t.push(I),t.push(T);break;case AG_LIVESRCMOONSERVER.JO:var C=Y(R.channelId),P=Y(R.avParam),u=F(h(P.length.toString(16)));t.push(E),t.push(_),t.push(o),t.push(a),t.push(A),t.push(C),t.push(u),t.push(P);break;case AG_LIVESRCMOONSERVER.jO:C=Y(R.channelId);var L=F(h((G=Y(R.upUserId)).length.toString(16)));t.push(E),t.push(_),t.push(o),t.push(a),t.push(A),t.push(C),t.push(L),t.push(G);break;case AG_LIVESRCMOONSERVER.qO:case AG_LIVESRCMOONSERVER.XO:case AG_LIVESRCMOONSERVER.$O:var G;C=Y(R.channelId),L=F(h((G=Y(R.upUserId)).length.toString(16)));t.push(E),t.push(_),t.push(o),t.push(a),t.push(A),t.push(C),t.push(L),t.push(G);break;case AG_LIVESRCMOONSERVER.zO:case AG_LIVESRCMOONSERVER.ZO:C=Y(R.channelId);O=new Uint8Array(2+(2+o.length)+(2+A.length)+16),t.push(E),t.push(_),t.push(o),t.push(a),t.push(A),t.push(C);break;case AG_LIVESRCMOONSERVER.et:for(var l=R.streamConfig,f=new Uint8Array(16),D=0;D<16;D++)null!=l[D]?f[D]=l[D]:f[D]=0;O=new Uint8Array(18),t.push(E),t.push(f);break;case AG_LIVESRCMOONSERVER.Rt:C=Y(R.channelId);t.push(E),t.push(C);break;case AG_LIVESRCMOONSERVER.tt:t.push(E);break;case AG_LIVESRCMOONSERVER.Ot:var p=Y(R.streamData);O=new Uint8Array(3+p.length),t.push(E),t.push([R.streamDataType]),t.push(p)}return K(O,0,t),O},H.constructVdnProtocol=function(e,R){var O,t=[],E=F(h(e.toString(16))),_=Y(k),a=F(h(_.length.toString(16))),r=Y(g),n=F(h(r.length.toString(16)));switch(e){case AG_LIVEVDNMOONSERVER.gt:var s=F(N(8,parseInt(R.ssrc).toString(16))),c=F(N(2,parseInt(R.videoCodec).toString(16))),S=F(N(2,parseInt(R.audioCodec).toString(16)));O=new Uint8Array(8),t.push(E),t.push(s),t.push(c),t.push(S);break;case AG_LIVEVDNMOONSERVER.yt:var i=Y(R.channelId);O=new Uint8Array(18+(2+_.length)+(2+r.length)),t.push(E),t.push(i),t.push(a),t.push(_),t.push(n),t.push(r);break;case AG_LIVEVDNMOONSERVER.wt:case AG_LIVEVDNMOONSERVER.ht:O=new Uint8Array(2),t.push(E);break;case AG_LIVEVDNMOONSERVER.Ft:case AG_LIVEVDNMOONSERVER.Yt:i=Y(R.channelId);O=new Uint8Array(18),t.push(E),t.push(i);break;case AG_LIVEVDNMOONSERVER.xt:for(var I=R.streamConfig,o=new Uint8Array(16),A=0;A<16;A++)null!=I[A]?o[A]=I[A]:o[A]=0;O=new Uint8Array(18),t.push(E),t.push(o)}return K(O,0,t),O},H.constructChatProtocol=function(e,R){var O,t=[],E=F(h(e.toString(16))),_=Y(k),a=F(h(_.length.toString(16))),r=Y(g),n=F(h(r.length.toString(16)));if(e==AG_CHATROOMMOONSERVER.je){var s=R.roomType,c=F(h(R.conCurrentNum.toString(16))),S=F(w((l=Y(R.userDefineData)).length.toString(16)));O=new Uint8Array(2+(2+_.length)+(2+r.length)+1+2+(4+l.length)),t.push(E),t.push(a),t.push(_),t.push(n),t.push(r),t.push([s]),t.push(c),t.push(S),t.push(l)}else if(e==AG_CHATROOMMOONSERVER.qe)O=new Uint8Array(2),t.push(E);else if(e==AG_CHATROOMMOONSERVER.Xe){var i=Y(b+"_"+R.banUserId),I=F(h(i.length.toString(16))),o=F(h(R.banTime.toString(16)));O=new Uint8Array(2+(2+i.length)+2),t.push(E),t.push(I),t.push(i),t.push(o)}else if(e==AG_CHATROOMMOONSERVER.$e){var A=Y(b+"_"+R.kickOutUserId),N=F(h(A.length.toString(16)));O=new Uint8Array(2+(2+A.length)),t.push(E),t.push(N),t.push(A)}else if(e==AG_CHATROOMMOONSERVER.ze)O=new Uint8Array(2),t.push(E);else if(e==AG_CHATROOMMOONSERVER.Ze){var M=Y(R.roomId);O=new Uint8Array(2+(2+_.length)+(2+r.length)+16),t.push(E),t.push(a),t.push(_),t.push(n),t.push(r),t.push(M)}else if(e==AG_CHATROOMMOONSERVER.eR);else if(e==AG_CHATROOMMOONSERVER.RR)O=new Uint8Array(2),t.push(E);else if(e==AG_CHATROOMMOONSERVER.OR){var V={fromId:m,targetId:R.roomId,time:"0",msgIndex:R.msgIndex,type:1,code:0,contentData:R.msg},T=Y(JSON.stringify(V)),C=F(w(T.length.toString(16)));O=new Uint8Array(2+(4+T.length)),t.push(E),t.push(C),t.push(T)}else if(e==AG_CHATROOMMOONSERVER.tR){V={fromId:m,targetId:R.roomId,time:"0",msgIndex:R.msgIndex,type:parseInt(R.type),code:parseInt(R.code),contentData:R.msg};var P=Y(JSON.stringify(V)),u=F(w(P.length.toString(16))),L=Y(b+"_"+R.toUserId),G=F(h(L.length.toString(16)));O=new Uint8Array(2+(2+L.length)+(4+P.length)),t.push(E),t.push(G),t.push(L),t.push(u),t.push(P)}else if(e==AG_CHATROOMMOONSERVER.ER){M=Y(R.roomId);O=new Uint8Array(18),t.push(E),t.push(M)}else if(e==AG_CHATROOMMOONSERVER.dR){var l,f=F(h((p=Y(m)).length.toString(16))),D=F(h(R.listType.toString(16)));S=F(w((l=Y(R.userDefineData)).length.toString(16))),M=Y(R.roomId);O=new Uint8Array(4+(2+p.length)+16+(4+l.length)),t.push(E),t.push(D),t.push(f),t.push(p),t.push(M),t.push(S),t.push(l)}else if(e==AG_CHATROOMMOONSERVER.mR){D=F(h(R.listType.toString(16))),M=Y(R.roomId);O=new Uint8Array(4+(2+_.length)+16),t.push(E),t.push(D),t.push(a),t.push(_),t.push(M)}else if(e==AG_CHATROOMMOONSERVER.yR){var p,U=Y(R.listTypes),v=F(h(U.length.toString(16))),d=F(h((p=Y(R.userId)).length.toString(16)));O=new Uint8Array(2+(2+U.length)+(2+p.length)),t.push(E),t.push(v),t.push(U),t.push(d),t.push(p)}return K(O,0,t),O},H.constructWebrtcUploadMsgProtocol=function(e){var R=F(h(AG_LIVESRCMOONSERVER.QO.toString(16))),O=Y(k),t=F(h(O.length.toString(16))),E=Y(g),_=F(h(E.length.toString(16))),a=Y(e.channelId),r=F(N(8,parseInt(e.audioSSRC).toString(16))),n=F(N(8,parseInt(e.smallVideoSSRC).toString(16))),s=F(N(8,parseInt(e.bigVideoSSRC).toString(16))),c=F(N(2,parseInt(e.videoCodec).toString(16))),S=F(N(2,parseInt(e.audioCodec).toString(16))),i=new Uint8Array(O.length+E.length+34+1+1);return K(i,0,[R,t,O,_,E,a,r,n,s,c,S]),i},H.parseMessage=function(e,R){var O,t=new Uint8Array(e);switch(parseInt("0x"+W(t.slice(0,2)))){case AG_MSG.Oe:t=new Uint8Array(e);StarRtc.AUtils.msgMaxLen=parseInt("0x"+W(t.slice(2,4))),console.log("登录成功，最大消息长度：",StarRtc.AUtils.msgMaxLen),StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,H.constructHeartBeatMsg(AG_MSG.Ee))),d=setInterval(function(){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,H.constructHeartBeatMsg(AG_MSG.Ee)))},15e3),R({status:"success"},"onLoginMessage");break;case AG_MSG.te:console.log("登录失败"),R({status:"failed"},"onLoginMessage");break;case AG_MSG._e:console.log("心跳反馈");break;case AG_MSG.le:console.log("服务器收到消息");break;case AG_MSG.fe:console.log("收到消息");parseInt("0x"+W(t.slice(10,14)));var E=15;switch(t[14]){case MSG_TYPE.L:console.log("单聊消息");var _=parseInt("0x"+W(t.slice(E,E+2)));E+=2;var a=x(t.slice(E,E+_)),r=t[E+=_];switch(E+=1,r){case ENCRYPT_TYPE.k:var n=parseInt("0x"+W(t.slice(E,E+4)));E+=4;var s=y(t.slice(E,E+n));console.log(a,s.digest,s.content),2==(i=a.split("_")).length&&(a=i[1]),R(e={fromId:a,digest:s.digest,msg:s.content},"onSingleMessage");break;case ENCRYPT_TYPE.g:}break;case MSG_TYPE.G:console.log("群消息");var c=parseInt("0x"+W(t.slice(E,E+2)));E+=2;var S=x(t.slice(E,E+c));E+=c;_=parseInt("0x"+W(t.slice(E,E+2)));E+=2;a=x(t.slice(E,E+_)),r=t[E+=_];switch(E+=1,r){case ENCRYPT_TYPE.k:n=parseInt("0x"+W(t.slice(E,E+4)));E+=4;s=y(t.slice(E,E+n));console.log(S,a,s.digest,s.content),2==(i=a.split("_")).length&&(a=i[1]),2==(I=S.split("_")).length&&(S=I[1]),R(e={groupId:S,fromId:a,digest:s.digest,msg:s.content},"onGroupMessage");break;case ENCRYPT_TYPE.g:}break;case MSG_TYPE.l:console.log("群私信消息");c=parseInt("0x"+W(t.slice(E,E+2)));E+=2;S=x(t.slice(E,E+c));E+=c;_=parseInt("0x"+W(t.slice(E,E+2)));E+=2;a=x(t.slice(E,E+_)),r=t[E+=_];switch(E+=1,r){case ENCRYPT_TYPE.k:n=parseInt("0x"+W(t.slice(E,E+4)));E+=4;var i;s=y(t.slice(E,E+n));console.log(S,a,s.digest,s.content),2==(i=a.split("_")).length&&(a=i[1]),2==(I=S.split("_")).length&&(S=I[1]),R(e={groupId:S,fromId:a,digest:s.digest,msg:s.content},"onGroupPrivateMessage");break;case ENCRYPT_TYPE.g:}break;case MSG_TYPE.D:console.log("推送群信息");c=parseInt("0x"+W(t.slice(E,E+2)));E+=2;S=x(t.slice(E,E+c));E+=c;n=parseInt("0x"+W(t.slice(E,E+4)));E+=4;var I;s=y(t.slice(E,E+n));console.log(S,s.digest,s.content),2==(I=S.split("_")).length&&(S=I[1]),R(e={groupId:S,digest:s.digest,msg:s.content},"onGroupPushMessage");break;case MSG_TYPE.p:console.log("推送系统信息");n=parseInt("0x"+W(t.slice(E,E+4)));E+=4;s=y(t.slice(E,E+n));console.log(s.digest,s.content),R(e={digest:s.digest,msg:s.content},"onSystemPushMessage")}O=t.slice(2,10),console.log("发送消息回执"),StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructReceivedMsg(O)));break;case AG_MSG.pe:var o=parseInt("0x"+W(t.slice(2,4))),A=x(t.slice(6,t.byteLength));console.log("报错:",o,A),R(e={errId:o,errStr:A},"onErrorMessage");break;case AG_MSG.we:var N=parseInt("0x"+W(t.slice(2,4))),M=x(t.slice(4,4+N)),V=parseInt("0x"+W(t.slice(4+N,4+N+4))),T=parseInt("0x"+W(t.slice(4+N+4,4+N+4+4))),C=x(t.slice(4+N+4+4,4+N+4+4+T)).split(",");0==T&&(C=[]);for(var P=parseInt("0x"+W(t.slice(4+N+4+4+T,4+N+4+4+T+4))),u=x(t.slice(4+N+4+4+T+4,4+N+4+4+T+4+P)).split(","),L=parseInt("0x"+W(t.slice(4+N+4+4+T+4+P,4+N+4+4+T+4+P+4))),G=x(t.slice(4+N+4+4+T+4+P+4,4+N+4+4+T+4+P+4+L)).split(","),l=[],f=0;f<C.length;f++){var D={groupId:C[f],groupName:u[f],creator:G[f]};l.push(D)}R({status:"success",statusStr:M,reqIndex:V,groupsInfo:l},"onGetGroupList");break;case AG_MSG.Ye:N=parseInt("0x"+W(t.slice(2,4))),M=x(t.slice(4,4+N)),V=parseInt("0x"+W(t.slice(4+N,4+N+4)));var p=parseInt("0x"+W(t.slice(4+N+4,4+N+4+4)));R({status:"success",statusStr:M,reqIndex:V,userIdList:x(t.slice(4+N+4+4,4+N+4+4+p)).split(",")},"onGetGroupUserList");break;case AG_MSG.Fe:R({status:"success",count:parseInt("0x"+W(t.slice(2,6))),totalPageNum:U=parseInt("0x"+W(t.slice(6,8)))},"onGetOnlineNumber");break;case AG_MSG.Ke:var U=parseInt("0x"+W(t.slice(2,4))),v=parseInt("0x"+W(t.slice(4,6)));p=parseInt("0x"+W(t.slice(6,10)));R({status:"success",totalPageNum:U,reqPageNum:v,userIdList:x(t.slice(10,10+p)).split(",")},"onGetAllUserList");break;case AG_MSG.Be:R({status:"failed",totalPageNum:U=parseInt("0x"+W(t.slice(2,4))),reqPageNum:v=parseInt("0x"+W(t.slice(4,6)))},"onGetAllUserList")}},H.parseSrcMoonServerMessage=function(e,R){var O=new Uint8Array(e);switch(parseInt("0x"+W(O.slice(0,2)))){case AG_LIVESRCMOONSERVER.rt:W(O.slice(18,20));var t=parseInt("0x"+W(O.slice(18,20)));R({type:"srcApplyUpload",status:"success",fingerprint:x(O.slice(20,20+t))});break;case AG_LIVESRCMOONSERVER.nt:var E=parseInt("0x"+W(O.slice(2,4)));R({type:"srcApplyUpload",status:"failed",msg:i=x(O.slice(4,4+E))});break;case AG_LIVESRCMOONSERVER.pt:console.log("webrtc心跳反馈");break;case AG_LIVESRCMOONSERVER.Ut:for(var _=parseInt("0x"+W(O.slice(2,3))),a=3,r=O.length,n={siv:_,uperInfos:{}};a<r;){var s=parseInt("0x"+W(O.slice(a,a+1)));a+=1;var c=parseInt("0x"+W(O.slice(a,a+2)));a+=2;var S=x(O.slice(a,a+c));a+=c,n.uperInfos[s]={upId:s,userId:S}}R({type:"uperStreamInfoUpdate",status:"success",msg:n});break;case AG_LIVESRCMOONSERVER.Dt:R({type:"stopStream",status:"success"});break;case AG_LIVESRCMOONSERVER.ut:R({type:"streamConfig",status:"success",channelId:x(O.slice(2,18))});break;case AG_LIVESRCMOONSERVER.Lt:R({type:"streamConfig",status:"failed",channelId:x(O.slice(2,18))});break;case AG_LIVESRCMOONSERVER.Ct:R({type:"delChannel",status:"success",channelId:x(O.slice(2,18))});break;case AG_LIVESRCMOONSERVER.Pt:E=parseInt("0x"+W(O.slice(2,4)));var i=x(O.slice(4,4+E));R({type:"delChannel",status:"failed",channelId:x(O.slice(4+E,4+E+16)),msg:i});break;case AG_LIVESRCMOONSERVER.Et:R({type:"createChannel",status:"success",channelId:x(O.slice(2,18))});break;case AG_LIVESRCMOONSERVER._t:E=parseInt("0x"+W(O.slice(2,4)));R({type:"createChannel",status:"failed",msg:i=x(O.slice(4,4+E))});break;case AG_LIVESRCMOONSERVER.vt:s=parseInt("0x"+W(O.slice(2,3))),_=parseInt("0x"+W(O.slice(3,4)));var I=x(O.slice(5));R({type:"streamData",status:"success",upId:s,siv:_,streamDataType:parseInt("0x"+W(O.slice(4,5))),streamData:I});break;case AG_LIVESRCMOONSERVER.dt:(i={}).errId=parseInt("0x"+W(O.slice(2,4))),i.errStrlen=parseInt("0x"+W(O.slice(4,6))),i.errStr=x(O.slice(6,6+i.errStrlen)),R({type:"serverErr",status:"failed",msg:i})}},H.parseVdnMoonServerMessage=function(e,R){var O=new Uint8Array(e);switch(parseInt("0x"+W(O.slice(0,2)))){case AG_LIVEVDNMOONSERVER.Wt:var t=parseInt("0x"+W(O.slice(2,4)));R({type:"vdnWebrtcReg",status:"success",fingerprint:x(O.slice(4,4+t))});break;case AG_LIVEVDNMOONSERVER.Kt:for(var E=x(O.slice(2,18)),_=parseInt("0x"+W(O.slice(18,19))),a=19,r=O.length,n={siv:_,uperInfos:{}};a<r;){var s=parseInt("0x"+W(O.slice(a,a+1)));a+=1;var c=parseInt("0x"+W(O.slice(a,a+2)));a+=2;var S=x(O.slice(a,a+c));a+=c,n.uperInfos[s]={upId:s,userId:S}}R({type:"vdnApplyDownload",status:"success",channelId:E,uperInfos:n});break;case AG_LIVEVDNMOONSERVER.Bt:console.log("vdn 心跳反馈");break;case AG_LIVEVDNMOONSERVER.Jt:var i=parseInt("0x"+W(O.slice(2,4))),I=x(O.slice(4,4+i));R({type:"vdnApplyDownload",status:"failed",channelId:E=x(O.slice(4+i,4+i+16)),failedStatus:I});break;case AG_LIVEVDNMOONSERVER.Qt:R({type:"streamConfig",status:"success",channelId:E=x(O.slice(2,18))});break;case AG_LIVEVDNMOONSERVER.jt:R({type:"streamConfig",status:"failed",channelId:E=x(O.slice(2,18))});break;case AG_LIVEVDNMOONSERVER.qt:for(E=x(O.slice(2,18)),_=parseInt("0x"+W(O.slice(18,19))),a=19,r=O.length,n={channelId:E,siv:_,uperInfos:{}};a<r;){s=parseInt("0x"+W(O.slice(a,a+1)));a+=1;c=parseInt("0x"+W(O.slice(a,a+2)));a+=2;S=x(O.slice(a,a+c));a+=c,n.uperInfos[s]={upId:s,userId:S}}R({type:"uperStreamInfoUpdate",status:"success",channelId:E,msg:n});break;case AG_LIVEVDNMOONSERVER.Xt:R({type:"streamData",status:"success",upId:s=parseInt("0x"+W(O.slice(2,3))),siv:_=parseInt("0x"+W(O.slice(3,4))),streamDataType:parseInt("0x"+W(O.slice(4,5))),streamData:x(O.slice(5))});break;case AG_LIVEVDNMOONSERVER.$t:case AG_LIVEVDNMOONSERVER.zt:case AG_LIVEVDNMOONSERVER.Zt:break;case AG_LIVEVDNMOONSERVER.RE:var o={};o.errId=parseInt("0x"+W(O.slice(2,4))),o.errStrlen=parseInt("0x"+W(O.slice(4,6))),o.errStr=x(O.slice(6,6+o.errStrlen)),R({type:"serverErr",status:"failed",msg:o})}},H.parseChatMoonServerMessage=function(e,R){var O=new Uint8Array(e),t=parseInt("0x"+W(O.slice(0,2)));switch(t){case AG_CHATROOMMOONSERVER._R:R({type:"createChatRoom",status:"success",chatroomId:_=x(O.slice(2,18)),maxContentLen:parseInt("0x"+W(O.slice(18,20)))});break;case AG_CHATROOMMOONSERVER.aR:var E=parseInt("0x"+W(O.slice(2,4)));R({type:"createChatRoom",status:"failed",status:x(O.slice(4,4+E))});break;case AG_CHATROOMMOONSERVER.rR:R({type:"deleteChatRoom",status:"success",roomId:_=x(O.slice(2,18))});break;case AG_CHATROOMMOONSERVER.nR:var _=x(O.slice(2,18));E=parseInt("0x"+W(O.slice(18,20)));R({type:"deleteChatRoom",status:"failed",msg:x(O.slice(20,20+E)),roomId:_});break;case AG_CHATROOMMOONSERVER.sR:var a=parseInt("0x"+W(O.slice(2,4)));R({type:"banaedToSendMsg",status:"success",banUserId:r=x(O.slice(4,4+a)),banTime:n=parseInt("0x"+W(O.slice(4+a,4+a+2)))});break;case AG_CHATROOMMOONSERVER.cR:a=parseInt("0x"+W(O.slice(2,4)));var r=x(O.slice(4,4+a)),n=parseInt("0x"+W(O.slice(4+a,4+a+2)));E=parseInt("0x"+W(O.slice(4+a+2,4+a+2+2)));R({type:"banaedToSendMsg",status:"failed",banUserId:r,banTime:n,msg:x(O.slice(4+a+2+2,4+a+2+2+E))});break;case AG_CHATROOMMOONSERVER.SR:var s=parseInt("0x"+W(O.slice(2,4)));R({type:"kickOutUser",status:"success",kickOutUserId:c=x(O.slice(4,4+s))});break;case AG_CHATROOMMOONSERVER.iR:s=parseInt("0x"+W(O.slice(2,4)));var c=x(O.slice(4,4+s));E=parseInt("0x"+W(O.slice(4+s,4+a+2)));R({type:"kickOutUser",status:"failed",kickOutUserId:c,msg:x(O.slice(4+s+2,4+s+2+E))});break;case AG_CHATROOMMOONSERVER.IR:case AG_CHATROOMMOONSERVER.oR:R({type:"joinChatRoom",status:"success",roomId:_=x(O.slice(2,18)),maxContentLen:parseInt("0x"+W(O.slice(18,20)))});break;case AG_CHATROOMMOONSERVER.AR:_=x(O.slice(2,18)),E=parseInt("0x"+W(O.slice(18,20)));R({type:"joinChatRoom",status:"failed",failedStatus:x(O.slice(20,20+E)),roomId:_});break;case AG_CHATROOMMOONSERVER.NR:console.log("chatRoom心跳反馈");break;case AG_CHATROOMMOONSERVER.MR:case AG_CHATROOMMOONSERVER.VR:var S=parseInt("0x"+W(O.slice(2,4))),i=x(O.slice(4,4+S)),I=parseInt("0x"+W(O.slice(4+S,4+S+4))),o=x(O.slice(4+S+4,4+S+4+I));R({type:t==AG_CHATROOMMOONSERVER.MR?"recvChatPrivateMsg":"recvChatMsg",status:"success",fromUserId:i,msg:o});break;case AG_CHATROOMMOONSERVER.TR:R({type:"chatroomUserBannedMsg",status:"success",banTime:n=parseInt("0x"+W(O.slice(2,4)))});break;case AG_CHATROOMMOONSERVER.CR:R({type:"chatroomUserKicked",status:"success"});break;case AG_CHATROOMMOONSERVER.PR:R({type:"sendMsgNoFree"});break;case AG_CHATROOMMOONSERVER.uR:(o={}).errId=parseInt("0x"+W(O.slice(2,4))),o.errStrlen=parseInt("0x"+W(O.slice(4,6))),o.errStr=x(O.slice(6,6+o.errStrlen)),R({type:"serverErr",status:"failed",msg:o});break;case AG_CHATROOMMOONSERVER.LR:R({type:"getRoomOnlineNum",status:"success",roomId:_=x(O.slice(2,18)),onlineNum:parseInt("0x"+W(O.slice(18,22)))});break;case AG_CHATROOMMOONSERVER.HR:R({type:"saveToChatroomList",status:"success",roomId:_=x(O.slice(2,18))});break;case AG_CHATROOMMOONSERVER.bR:R({type:"saveToChatroomList",status:"failed",roomId:_=x(O.slice(2,18))});break;case AG_CHATROOMMOONSERVER.kR:R({type:"delFromToChatroomList",status:"success",roomId:_=x(O.slice(2,18))});break;case AG_CHATROOMMOONSERVER.gR:R({type:"delFromToChatroomList",status:"failed",roomId:_=x(O.slice(2,18))});break;case AG_CHATROOMMOONSERVER.wR:var A=parseInt("0x"+W(O.slice(2,6)));R({type:"queryAllChatroomList",status:"success",listData:x(O.slice(6,6+A))})}},H.parseVoipMoonServerMessage=function(e,R){var O=new Uint8Array(e);switch(parseInt("0x"+W(O.slice(0,2)))){case AG_VOIPMOONSERVER.jR:R({type:"voipCallingAck",status:"success"});break;case AG_VOIPMOONSERVER.XR:var t=parseInt("0x"+W(O.slice(2,4)));R({type:"voipCalling",status:"success",fingerprint:x(O.slice(4,4+t))});break;case AG_VOIPMOONSERVER.$R:(E={}).errId=parseInt("0x"+W(O.slice(2,4))),E.errStrlen=parseInt("0x"+W(O.slice(4,6))),E.errStr=x(O.slice(6,6+E.errStrlen)),R({type:"voipCalling",status:"failed",msg:E});break;case AG_VOIPMOONSERVER.ZR:t=parseInt("0x"+W(O.slice(2,4)));R({type:"voipResponseing",status:"success",fingerprint:x(O.slice(4,4+t))});break;case AG_VOIPMOONSERVER.eO:(E={}).errId=parseInt("0x"+W(O.slice(2,4))),E.errStrlen=parseInt("0x"+W(O.slice(4,6))),E.errStr=x(O.slice(6,6+E.errStrlen)),R({type:"voipResponseing",status:"failed",msg:E});break;case AG_VOIPMOONSERVER.RO:case AG_VOIPMOONSERVER.OO:break;case AG_VOIPMOONSERVER.tO:var E;(E={}).errId=parseInt("0x"+W(O.slice(2,4))),E.errStrlen=parseInt("0x"+W(O.slice(4,6))),E.errStr=x(O.slice(6,6+E.errStrlen)),R({type:"serverErr",status:"failed",msg:E})}},H.constructHeartBeatMsg=function(e){return new Uint8Array(F(h(e.toString(16))))}},StarRtc.StarManager=new function(){var E=this,e="starRTC v1.0.0",_="",a="",r="",n="",s="",R=null,c=null,S="";E.version=function(){return console.log(e),e},E.login=function(e,R,O,t){"WebSocket"in window?(r=(_=e)+"_"+(a=R),n=O,c=t,StarRtc.Instance.configModePulic?$.get("https://"+StarRtc.Instance.loginServerUrl+":"+StarRtc.Instance.loginServerPort+"/?userId="+r+"&authKey="+n,function(e,R){if(console.log("authKey 验证：",R,e),"success"===R){var O=JSON.parse(e);1==O.status?(s=O.data,$.get("https://"+StarRtc.Instance.msgScheduleUrl+":"+StarRtc.Instance.msgSchedulePort+"/?userId="+r,function(e,R){R="success";console.log("消息调度：",R,e);var O=JSON.parse(e);1==O.status?(S="wss://"+O.data,E.connect()):t({msg:"请求msg调度数据异常"},"connect failed")})):t({msg:"登录验证失败"},"connect failed")}else t({msg:"请求验证地址失败"},"connect failed")}):(s="free",S="wss://"+StarRtc.Instance.msgServerUrl+":"+StarRtc.Instance.msgServerWebsocketPort,E.connect())):(console.log("当前浏览器 Not support websocket"),t({msg:"当前浏览器 Not support websocket"},"connect failed"))},E.connect=function(){console.log("WebSocket："+S),(R=new WebSocket(S)).onerror=function(){console.log("WebSocket连接发生错误"),c({msg:"WebSocket连接发生错误"},"connect failed")},R.onopen=function(){console.log("WebSocket连接成功"),c({msg:"WebSocket连接成功"},"connect success"),E.startAuth()},R.onmessage=function(e){console.log("onmessage",e.data),c(e.data,"onmessage")},R.onclose=function(){console.log("WebSocket连接关闭"),c({msg:"WebSocket连接关闭"},"connect closed"),R=null}},E.close=function(){console.log("关闭WebSocket连接"),StarRtc.AUtils.clear(),null!=R&&R.close()},E.send=function(e){null!=R&&R.send(e)},E.startAuth=function(){StarRtc.AUtils.setUserInfo(_,a,s),E.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructAuthMsg()))},window.onbeforeunload=function(){E.close()}},StarRtc.Instance=new function(){var n=this,s="",c="",S="",E=null,t=null,_=0;n.configModePulic=!0,n.loginServerUrl="ips2.starrtc.com",n.loginServerPort="9920",n.msgScheduleUrl="ips2.starrtc.com",n.msgSchedulePort="9904",n.chatRoomScheduleUrl="ips2.starrtc.com",n.chatRoomSchedulePort="9907",n.srcScheduleUrl="ips2.starrtc.com",n.srcSchedulePort="9929",n.vdnScheduleUrl="ips2.starrtc.com",n.vdnSchedulePort="9926",n.voipServerUrl="voip2.starrtc.com",n.voipServerPort="10086",n.voipServerWebsocketPort="10087",n.voipServerWebrtcPort="10088",n.workServerUrl="https://api.starrtc.com/public",n.webrtcServerIP="123.103.93.74",n.msgServerUrl="ips2.starrtc.com",n.msgServerWebsocketPort="9904",n.chatRoomServerUrl="ips2.starrtc.com",n.chatRoomServerWebsocketPort="9907",n.srcServerUrl="ips2.starrtc.com",n.srcServerWebsocketPort="9929",n.srcServerWebrtcPort="10088",n.vdnServerUrl="ips2.starrtc.com",n.vdnServerWebsocketPort="9929",n.vdnServerWebrtcPort="10088",n.version=function(){return StarRtc.StarManager.version()};var a=function(e,R){switch(R){case"connect failed":case"connect success":case"connect closed":E(e,R);break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){switch(e.appid){case APP_PRODUCT_ID.R:StarRtc.AUtils.parseMessage(e.msgArr,a)}});break;case"onSingleMessage":e.msg=JSON.parse(e.msg);var O=R;if(0==e.msg.type)switch(e.msg.code){case AG_MSG_VOIP_CTRL.h:e.type="voipCall",O="onVoipMessage";break;case AG_MSG_VOIP_CTRL.F:e.type="voipRefuse",O="onVoipMessage";break;case AG_MSG_VOIP_CTRL.W:e.type="voipHangup",O="onVoipMessage";break;case AG_MSG_VOIP_CTRL.K:e.type="voipBusy",O="onVoipMessage";break;case AG_MSG_VOIP_CTRL.B:e.type="voipConnect",O="onVoipMessage";break;default:e.type="voipSingleMsg"}else e.type="voipSingleMsg";(null!=t?t:E)(e,O);break;case"onLoginMessage":case"onGroupMessage":case"onGroupPrivateMessage":case"onGroupPushMessage":case"onSystemPushMessage":case"onErrorMessage":case"onGetGroupList":case"onGetOnlineNumber":case"onGetGroupUserList":case"onGetAllUserList":null!=t&&t(e,R),E(e,R)}};n.setLoginServerUrl=function(e){n.loginServerUrl=e},n.setMsgScheduleUrl=function(e){n.msgScheduleUrl=e},n.setChatRoomScheduleUrl=function(e){n.chatRoomScheduleUrl=e},n.setSrcScheduleUrl=function(e){n.srcScheduleUrl=e},n.setVdnScheduleUrl=function(e){n.vdnScheduleUrl=e},n.setVoipServerUrl=function(e){n.voipServerUrl=e},n.setWorkServerUrl=function(e){n.workServerUrl=e},n.setWebrtcServerIP=function(e){n.webrtcServerIP=e},n.setMsgServerInfo=function(e,R){n.msgServerUrl=e,n.msgServerWebsocketPort=R},n.setchatRoomServerInfo=function(e,R){n.chatRoomServerUrl=e,n.chatRoomServerWebsocketPort=R},n.setSrcServerInfo=function(e,R,O){n.srcServerUrl=e,n.srcServerWebsocketPort=R,n.srcServerWebrtcPort=O},n.setVdnServerInfo=function(e,R,O){n.vdnServerUrl=e,n.vdnServerWebsocketPort=R,n.vdnServerWebrtcPort=O},n.setVoipServerInfo=function(e,R,O,t){n.voipServerUrl=e,n.voipServerPort=R,n.voipServerWebsocketPort=O,n.voipServerWebrtcPort=t},n.setConfigModePulic=function(e){n.configModePulic=e},n.login=function(e,R,O,t){n.configModePulic||(e="APPID-FREE"),(s=e)+"_"+(c=R),S=O,E=t,StarRtc.StarManager.login(e,R,O,a)},n.logout=function(){StarRtc.StarManager.close()},n.sendSingleMsg=function(e,R,O,t){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructSingleMsg(e,++_,R,O,t)))},n.sendGroupMsg=function(e,R,O){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructGroupMsg(e,++_,R,O)))},n.sendSingleCtrlMsg=function(e,R,O,t){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructSingleCtrlMsg(e,++_,R,O,t)))},n.sendVoipCtrlMsg=function(e,R){var O="";R==AG_MSG_VOIP_CTRL.h&&(O=JSON.stringify({VoIP_protocal_type:"TCP",VoIP_server_IP:StarRtc.Instance.voipServerUrl,VoIP_server_Port:StarRtc.Instance.voipServerPort})),n.sendSingleCtrlMsg(e,"新消息",O,R)},n.sendVoipCallMsg=function(e,R){var O,t=R||(new Date).getTime();O=JSON.stringify({VoIP_protocal_type:"TCP",VoIP_server_IP:StarRtc.Instance.voipServerUrl,VoIP_server_Port:StarRtc.Instance.voipServerPort,ts:t}),n.sendSingleCtrlMsg(e,"新消息",O,AG_MSG_VOIP_CTRL.h)},n.sendVoipRefuseMsg=function(e){n.sendVoipCtrlMsg(e,AG_MSG_VOIP_CTRL.F)},n.sendVoipHungupMsg=function(e){n.sendVoipCtrlMsg(e,AG_MSG_VOIP_CTRL.W),null!=t&&t({type:"voipCancle"},"onVoipMessage")},n.sendVoipBusyMsg=function(e){n.sendVoipCtrlMsg(e,AG_MSG_VOIP_CTRL.K)},n.sendVoipConnectMsg=function(e){n.sendVoipCtrlMsg(e,AG_MSG_VOIP_CTRL.B)},n.setIMExtraback=function(e){t=e},n.getStarRoomSDK=function(e,R,O,t,E,_,a){var r=new StarRtc.StarRoomSDK(e,R,O,t,E,_,a);return r.login(s,c,S),r},n.getVideoMeetingRoomSDK=function(e,R,O){return n.getStarRoomSDK("src",e,R,O,3,1)},n.getVideoLiveRoomSDK=function(e,R,O,t){return n.getStarRoomSDK(e,R,O,t,3,2)},n.getVoipRoomSDK=function(e,R,O){return n.getStarRoomSDK("voip",e,R,O,2,0,n)},n.reportVideoMeetingRoom=function(e,R){n.reportRoom(CHATROOM_LIST_TYPE.X,e,R)},n.reportVideoLiveRoom=function(e,R){n.reportRoom(CHATROOM_LIST_TYPE.j,e,R)},n.reportVideoClassRoom=function(e,R){n.reportRoom(CHATROOM_LIST_TYPE.Z,e,R)},n.reportChatRoom=function(e,R){n.reportRoom(CHATROOM_LIST_TYPE.J,e,R)},n.reportRoom=function(O,e,t){if(!StarRtc.Instance.configModePulic){var E=null,_=e.ID.substring(16,33),a={};a.id=e.ID,a.creator=e.Creator,a.name=e.Name;var r=function(e,R){switch(e.obj=n,R){case"connect success":E.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.dR,{roomId:_,listType:O,userDefineData:encodeURIComponent(JSON.stringify(a))})));break;case"connect failed":t&&t("failed");case"connect closed":E=null;break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.O&&StarRtc.AUtils.parseChatMoonServerMessage(e.msgArr,function(e){r(e,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(e.type){case"saveToChatroomList":t&&t(e.status),E.close()}}};E=new StarRtc.WebrtcWebsocket(r,null);var R="wss://"+StarRtc.Instance.chatRoomServerUrl+":"+StarRtc.Instance.chatRoomServerWebsocketPort;E.connect(R)}},n.delVideoMeetingRoom=function(e,R){n.delRoom(CHATROOM_LIST_TYPE.X,e,R)},n.delVideoLiveRoom=function(e,R){n.delRoom(CHATROOM_LIST_TYPE.j,e,R)},n.delVideoClassRoom=function(e,R){n.delRoom(CHATROOM_LIST_TYPE.Z,e,R)},n.delChatRoom=function(e,R){n.delRoom(CHATROOM_LIST_TYPE.J,e,R)},n.delRoom=function(O,e,t){if(!StarRtc.Instance.configModePulic){var E=null,_=e.ID.substring(16,33),a=function(e,R){switch(e.obj=n,R){case"connect success":E.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.mR,{roomId:_,listType:O})));break;case"connect failed":t&&t("failed");case"connect closed":E=null;break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.O&&StarRtc.AUtils.parseChatMoonServerMessage(e.msgArr,function(e){a(e,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(e.type){case"delFromToChatroomList":t&&t(e.status),E.close()}}};E=new StarRtc.WebrtcWebsocket(a,null);var R="wss://"+StarRtc.Instance.chatRoomServerUrl+":"+StarRtc.Instance.chatRoomServerWebsocketPort;E.connect(R)}},n.queryVideoClassRoom=function(e){n.queryRoom(CHATROOM_LIST_TYPE.Z,e)},n.queryChatRoom=function(e){n.queryRoom(CHATROOM_LIST_TYPE.J,e)},n.queryVideoMeetingRoom=function(e){n.queryRoom(CHATROOM_LIST_TYPE.X,e)},n.queryVideoLiveRoom=function(e){n.queryRoom(CHATROOM_LIST_TYPE.j,e)},n.queryRoom=function(E,_){if(!StarRtc.Instance.configModePulic){var a=null,r=function(e,R){switch(e.obj=n,R){case"connect success":a.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.yR,{listTypes:E.toString(),userId:""})));break;case"connect failed":_&&_("failed");case"connect closed":a=null;break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.O&&StarRtc.AUtils.parseChatMoonServerMessage(e.msgArr,function(e){r(e,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(e.type){case"queryAllChatroomList":if(""==e.listData){_&&_(e.status,[]);break}for(var O=JSON.parse(e.listData).userDefineDataList.split(","),t=0;t<O.length;t++)O[t]=JSON.parse(decodeURIComponent(O[t])),O[t].ID=O[t].id,O[t].Name=O[t].name,O[t].Creator=O[t].creator;_&&_(e.status,O),a.close()}}};a=new StarRtc.WebrtcWebsocket(r,null);var e="wss://"+StarRtc.Instance.chatRoomServerUrl+":"+StarRtc.Instance.chatRoomServerWebsocketPort;a.connect(e)}},n.getGroupList=function(){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.ye,{reqIndex:0})))},n.getGroupUserList=function(e){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.he,{reqIndex:0,groupId:e})))},n.getOnlineNumber=function(){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.xe,{})))},n.getAllUserList=function(e){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.We,{reqPageNum:e})))},n.getInfo=function(){return{agentId:s,userId:c,authKey:S}}},StarRtc.WebrtcWebsocket=function(e,R){var O,t=this,E=R,_=e,a=null;return t.startHeartBeat=function(e){a.send(e),O=setInterval(function(){a.send(e)},5e3)},t.stopHeartBeat=function(){clearInterval(O)},t.connect=function(e){console.log("webrtcConnect"+e),(a=new WebSocket(e)).onerror=function(e){console.log("WebSocket连接发生错误"),_({msg:"WebSocket连接发生错误",data:e.data},"connect failed")},a.onopen=function(){console.log("WebSocket连接成功"),_({msg:"WebSocket连接成功"},"connect success")},a.onmessage=function(e){console.log("onmessage",e.data),_(e.data,"onmessage")},a.onclose=function(e){console.log("WebSocket连接关闭"),t.stopHeartBeat(),_({msg:"WebSocket连接关闭",data:e.code},"connect closed"),a=null}},t.starConnect=function(t){$.get(E,function(e,R){if(console.log("消息调度：",R,e),"success"===R){var O=JSON.parse(e);1==O.status?t("success",O.data):t("failed")}else t("failed")})},t.send=function(e){a.send(e)},t.close=function(){null!=a&&a.close()},t.readyState=function(){return null!=a?a.readyState:-1},t},StarRtc.StarRoomSDK=function(e,R,O,t,E,_,a){var r="我要上麦！",n=this,s="",c=R,S=e,i=t,I=O,o=E||3,A=0!=(1&o),N=0!=(2&o),M=null,V=null,T=null,C=null,P=!1,u=null,L=a;function G(){null!=u&&(clearInterval(u),u=null)}function l(e){if(null!=e){var R=e.getState();0<=R&&R<2&&e.sigDisconnect()}}function f(){var e=!0;return A&&(e=e&&(3==T.getState()||-1==T.getState())),N&&(e=e&&(3==M.getState()||-1==M.getState())),e}null!=L&&"voip"==e&&L.setIMExtraback(function(e,R){D(e,"onVoipMessage")});var D=function(e,R){switch(e.userData=i,e.obj=n,R){case"connect success":N?M.sigConnect():I(e,R,c);break;case"connect failed":case"connect closed":N&&l(M),f()&&I(e,R,c);break;case"onmessage":break;case"onChatRoomMessage":switch(e.type){case"createChatRoom":"success"==e.status&&(i.roomInfo.ID=e.chatroomId,i.roomInfo.Creator=s,N&&(V.roomInfo.Name=e.chatroomId,M.createNew()));break;case"deleteChatRoom":"success"==e.status&&(N?M.deleteCurrRoom():I(e,R,c));break;case"joinChatRoom":"success"==e.status&&N&&M.joinRoom();break;case"recvChatPrivateMsg":if(0==e.msg.type)switch(e.msg.code){case 2e3:e.msg.msgType="apply";break;case 2002:e.msg.msgType="applyAgree";break;case 2004:e.msg.msgType="applyDisagree";break;case 2200:e.msg.msgType="linkStop";break;case 2100:e.msg.msgType="invite";break;case 2102:e.msg.msgType="inviteAgree";break;case 2106:e.msg.msgType="inviteDisagree";break;case 2104:e.msg.msgType="inviteLinkStart";break;default:e.msg.msgType="common"}}I(e,R,c);break;case"onVoipMessage":switch(e.type){case"voipCall":e.fromId!=i.roomInfo.targetId&&L.sendVoipBusyMsg(e.fromId);break;case"voipHangup":e.fromId==i.roomInfo.targetId&&(n.leaveRoom(!0),I(e,R,c));break;case"voipBusy":G(),n.leaveRoom(!0),I(e,R,c);break;case"voipConnect":case"voipRefuse":G(),I(e,R,c);break;case"voipCancle":G();break;default:I(e,R,c)}}};return V=clone(i),C=clone(i),N&&A&&i.roomInfo.ID&&(V.roomInfo.ID=i.roomInfo.ID.substring(0,16),C.roomInfo.ID=i.roomInfo.ID.substring(16,33)),N&&(M=new StarRtc.StarVideoSDK(e,R,function(e,R){switch(e.userData=i,e.obj=n,R){case"connect success":I(e,R,c);break;case"connect closed":case"connect failed":G(),A&&l(T),f()&&I(e,R,c);break;case"onmessage":break;case"onWebrtcMessage":switch(e.type){case"delChannel":"success"==e.status?I(e,R,c):alert("删除视频会议失败");break;case"createChannel":"success"==e.status&&(i.roomInfo.Creator=s,i.roomInfo.ID=A?e.channelId+i.roomInfo.ID:e.channelId),I(e,R,c);break;case"voipCallingAck":if(null!=L){G();var O=(new Date).getTime();L.sendVoipCallMsg(i.roomInfo.targetId,O),_=i.roomInfo.targetId,t=function(){L.sendVoipCallMsg(_,O)},E=3e3,null!=u&&G(),u=setInterval(t,E)}break;case"voipResponseing":"success"==e.status&&null!=L&&L.sendVoipConnectMsg(i.roomInfo.targetId),I(e,R,c);break;default:I(e,R,c)}}var t,E,_},V,_)),A&&(T=new StarRtc.StarChatSDK(R,D,C)),n.login=function(e,R,O){e+"_"+(s=R),O,A&&T.login(e,R,O),N&&M.login(e,R,O)},n.sigConnect=function(){P=!1,A?T.sigConnect():N&&M.sigConnect()},n.sigDisconnect=function(e){null==e&&(e=!0),P=e,N?M.sigDisconnect():A&&T.sigDisconnect()},n.createNew=function(){"voip"!=S&&(A?T.createNew():N&&M.createNew())},n.deleteCurrRoom=function(){"voip"!=S&&(A?T.deleteCurrRoom():N&&M.deleteCurrRoom())},n.createStream=function(e){N&&M.createStream(e)},n.joinRoom=function(){A&&"new"!=c?T.joinRoom():N&&M.joinRoom()},n.leaveRoom=function(e){if(N){switch(S){case"voip":var R=e||!1;null==L||R||L.sendVoipHungupMsg(i.roomInfo.targetId),L.setIMExtraback(null)}M.leaveRoom(R)}else A&&T.leaveRoom()},n.streamConfigChange=function(e){N&&M.streamConfigChange(e)},n.sendChatMsg=function(e){A&&T.sendChatMsg(e)},n.sendVoipMsg=function(e){"voip"==S&&null!=L&&L.sendSingleMsg(i.roomInfo.targetId,"新媒体",e)},n.sendChatPrivateMsg=function(e,R){A&&T.sendChatPrivateMsg(e,R)},n.sendApplyMsg=function(){A&&N&&"vdn"==S&&T.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2e3)},n.sendApplyAgreeMsg=function(e){A&&N&&"src"==S&&T.sendChatCtrlPrivateMsg(e,r,2002)},n.sendApplyDisagreeMsg=function(e){A&&N&&"src"==S&&T.sendChatCtrlPrivateMsg(e,r,2004)},n.sendInviteLinkMsg=function(e){A&&N&&"src"==S&&T.sendChatCtrlPrivateMsg(e,r,2100)},n.sendInviteLinkAgreeMsg=function(){A&&N&&"vdn"==S&&T.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2102)},n.sendInviteLinkDisagreeMsg=function(){A&&N&&"vdn"==S&&T.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2106)},n.sendInviteLinkStartMsg=function(){A&&N&&"vdn"==S&&T.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2104)},n.sendLinkStopMsg=function(e){A&&N&&"src"==S&&T.sendChatCtrlPrivateMsg(e,r,2200)},n.kickOutUser=function(e){A&&T.kickOutUser(e)},n.banToSendMsg=function(e,R){A&&T.banToSendMsg(e,R)},n.getRoomOnlineNum=function(){A&&T.getRoomOnlineNum()},n.sendStreamData=function(e){N&&"src"==S&&M.sendStreamData(e)},n.activeDisconnect=function(){return P},n.getUserData=function(){return i},n.startLocalStream=function(e){N&&M.startLocalStream(e)},n},StarRtc.StarVideoSDK=function(e,R,O,t,E){var n,s,c=this,S="",i="",I=t,o=e,A=O,N=R,M=null,V="",T={},C={},_=E||1,P={siv:0,uperInfos:{}},u=StarWebRTC();u.init();var L=!1,a=!1,r=function(e){switch(e.type){case"createOffer":if("success"==e.status){switch(o){case"src":e.channelId=I.roomInfo.ID;break;case"vdn":e.ssrc=e.bigVideoSSRC;break;case"voip":e.targetId=I.roomInfo.targetId,e.videoSSRC=e.bigVideoSSRC}c.joinRoomInternal(e)}break;case"applyAnswer":e.status}},G=function(e,R){var O={type:"streamCreated",streamObj:R};O.userData=I,O.obj=c,O.status="success"==e?"success":"failed",A(O,"onWebrtcMessage",N)},l=function(e,R){switch(e.userData=I,e.obj=c,R){case"connect success":var O=null;switch(o){case"src":O=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructHeartBeatMsg(AG_LIVESRCMOONSERVER.tt));break;case"vdn":O=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.C,StarRtc.AUtils.constructHeartBeatMsg(AG_LIVEVDNMOONSERVER.ht))}M.startHeartBeat(O),u.setServerInfo({serverIp:T.ip,serverPort:T.webrtcPort}),A(e,R,N);break;case"connect failed":case"connect closed":u.destroy(),M=null,A(e,R,N);break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.i?StarRtc.AUtils.parseSrcMoonServerMessage(e.msgArr,function(e){l(e,"onWebrtcMessage")}):e.appid==APP_PRODUCT_ID.I?StarRtc.AUtils.parseVdnMoonServerMessage(e.msgArr,function(e){l(e,"onWebrtcMessage")}):e.appid==APP_PRODUCT_ID.o&&StarRtc.AUtils.parseVoipMoonServerMessage(e.msgArr,function(e){l(e,"onWebrtcMessage")})});break;case"onWebrtcMessage":switch(e.type){case"uperStreamInfoUpdate":if("success"==e.status){if(L)for(var t=0;t<7;++t){var E=u.getStreamByIndex(t),_=void 0;0!=Object.keys(P.uperInfos).length&&(_=P.uperInfos[t]);var a=e.msg.uperInfos[t];if(null==_&&null!=a)a.userId!=i&&A({type:"addUploader",upId:a.upId,upUserId:a.userId,streamInfo:E,room:c},R,N);else if(null!=_&&null==a){var r=s==_.upId;r&&(s=n=void 0),u.resetStreamInfo(E),A({type:"removeUploader",upId:_.upId,upUserId:_.userId,streamInfo:E,bigFlag:r,room:c},R,N)}else null!=_&&null!=a&&_.userId!=a.userId&&A({type:"changeUploader",upId:a.upId,oldUpUserId:_.userId,newUpUserId:a.userId,streamInfo:E,room:c},R,N)}P=e.msg}break;case"vdnWebrtcReg":if("success"==e.status)switch(o){case"vdn":V=e.fingerprint,M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.C,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.yt,{channelId:I.roomInfo.ID})))}else console.log("vdnWebrtcReg failed");break;case"vdnApplyDownload":"success"==e.status?u.emit("_webrtc_apply_ok",V,function(){L=!0,l({type:"uperStreamInfoUpdate",status:"success",msg:e.uperInfos},"onWebrtcMessage")}):console.log("收到vdnApplyDownload failed"),A(e,R,N);break;case"srcApplyUpload":"success"==e.status?(e.tmpData=C,console.log("收到_webrtc_apply_ok"),u.emit("_webrtc_apply_ok",e.fingerprint,function(){L=!0;var e=clone(P);P.uperInfos={},l({type:"uperStreamInfoUpdate",status:"success",msg:e},"onWebrtcMessage")})):console.log("收到srcApplyUpload failed"),A(e,R,N);break;case"streamConfig":if("success"==e.status){if(n==s){E=u.getStreamByIndex(n);u.switchStreamInfo(E);break}if(null!=n){E=u.getStreamByIndex(n);u.switchStreamInfo(E)}if(null!=s){E=u.getStreamByIndex(s);u.switchStreamInfo(E)}}break;case"createChannel":"success"==e.status&&(I.roomInfo.ID=e.channelId,I.roomInfo.Creator=S),A(e,R,N);break;case"delChannel":"success"==e.status&&(I.roomInfo.ID=""),A(e,R,N);break;case"serverErr":break;case"voipResponseing":case"voipCalling":"success"==e.status&&(console.log("收到_webrtc_apply_ok"),u.emit("_webrtc_apply_ok",e.fingerprint,function(){l({type:"voipStreamReady",status:"success"},"onWebrtcMessage")})),A(e,R,N);break;case"voipStreamReady":E=u.getStreamByIndex(0);u.switchStreamInfo(E),A({type:"voipStreamReady",streamObj:E.streamObj,room:c},R,N);break;default:A(e,R,N)}}};return c.login=function(e,R,O){i=e+"_"+(S=R),O},c.sigConnect=function(){switch(a=!1,T.ip=StarRtc.Instance.webrtcServerIP,M=null,o){case"src":if(!StarRtc.Instance.configModePulic){M=new StarRtc.WebrtcWebsocket(l,null),(O={}).ip=StarRtc.Instance.srcServerUrl,T.websocketPort=StarRtc.Instance.srcServerWebsocketPort,T.webrtcPort=StarRtc.Instance.srcServerWebrtcPort,O.websocketPort=T.websocketPort;var e="wss://"+O.ip+":"+O.websocketPort;return void M.connect(e)}var R="https://"+StarRtc.Instance.srcScheduleUrl+":"+StarRtc.Instance.srcSchedulePort+"?userId="+i;M=new StarRtc.WebrtcWebsocket(l,R);break;case"vdn":if(!StarRtc.Instance.configModePulic){M=new StarRtc.WebrtcWebsocket(l,null),(O={}).ip=StarRtc.Instance.vdnServerUrl,T.websocketPort=StarRtc.Instance.vdnServerWebsocketPort,T.webrtcPort=StarRtc.Instance.vdnServerWebrtcPort,O.websocketPort=T.websocketPort;e="wss://"+O.ip+":"+O.websocketPort;return void M.connect(e)}R="https://"+StarRtc.Instance.vdnScheduleUrl+":"+StarRtc.Instance.vdnSchedulePort+"?userId="+i+"&channelId="+I.channelId;M=new StarRtc.WebrtcWebsocket(l,R);break;case"voip":var O;M=new StarRtc.WebrtcWebsocket(l,null),(O={}).ip=StarRtc.Instance.voipServerUrl,T.websocketPort=StarRtc.Instance.voipServerWebsocketPort,T.webrtcPort=StarRtc.Instance.voipServerWebrtcPort,O.websocketPort=T.websocketPort;e="wss://"+O.ip+":"+O.websocketPort;return void M.connect(e);default:return}M.starConnect(function(e,R){if("success"==e){T.websocketPort=R.websocketPort,T.webrtcPort=R.webrtcPort;var O="wss://"+R.ip+":"+R.websocketPort;M.connect(O)}})},c.sigDisconnect=function(e){null==e&&(e=!0),a=e,null!=M&&(M.close(),M=null)},c.createNew=function(){if(null!=M)switch(o){case"src":var e="1";2==_&&(e="2");var R=AG_LIVESRCMOONSERVER.xO;1==I.roomInfo.Type&&(R=AG_LIVESRCMOONSERVER.FO),M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructSrcProtocol(R,{conCurrentNum:7,roomId:I.roomInfo.Name,extra:e,liveType:parseInt(e)})))}},c.deleteCurrRoom=function(){if(null!=M)switch(o){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.ZO,{channelId:I.roomInfo.ID})))}},c.createStream=function(e){null==e&&(e={video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:25},facingMode:{ideal:["user"]}},audio:{deviceId:{ideal:["default"]}}}),u.createStream(e,G)},c.joinRoom=function(){u.emit("ready",r,"voip"==o)},c.joinRoomInternal=function(e){switch(C=e,o){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructWebrtcUploadMsgProtocol(e)));break;case"vdn":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.C,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.gt,e)));break;case"voip":"call"==N?M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.FR,e))):"response"==N&&M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.KR,e)))}},c.leaveRoom=function(e){if(null!=M&&1==M.readyState())switch(o){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.zO,{channelId:I.roomInfo.ID})));break;case"vdn":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.C,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.wt,{})));case"voip":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.P,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.QR,{isActive:e?0:1})))}},c.streamConfigChange=function(e){if(null!=M){s==e?(s=n,n=e):(n=s,s=e);var R=u.getStreamInfos(),O=[];for(var t in R){var E=0;E=n==s?R[t].switchFlag?1:2:t==n?1:t==s?2:R[t].switchFlag?2:1,O.push(E)}switch(o){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.et,{streamConfig:O})));break;case"vdn":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.C,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.xt,{streamConfig:O})))}}},c.getState=function(){return null!=M?M.readyState():-1},c.getType=function(){return o},c.sendStreamData=function(e){switch(o){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.Ot,{streamData:e,streamDataType:8})))}},c.activeDisconnect=function(){return a},c.startLocalStream=function(e){u.startLocalStream(e)},c},StarRtc.StarChatSDK=function(e,R,O){var t=this,E="",_="",a={},r=O,n=R,s=e,c=null,S=0,i=!1,I=function(e,R){switch(e.userData=r,e.obj=t,R){case"connect success":var O;O=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructHeartBeatMsg(AG_CHATROOMMOONSERVER.ze)),c.startHeartBeat(O),n(e,R,s);break;case"connect failed":case"connect closed":c=null,n(e,R,s);break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.O&&StarRtc.AUtils.parseChatMoonServerMessage(e.msgArr,function(e){I(e,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(e.type){case"createChatRoom":"success"==e.status&&(r.roomInfo.ID=e.chatroomId,r.roomInfo.Creator=E);break;case"deleteChatRoom":case"joinChatRoom":e.status;break;case"recvChatPrivateMsg":case"recvChatMsg":if(""==e.fromUserId||""==e.msg)return;if(e.msg=JSON.parse(e.msg),e.msg.fromId==E)return}n(e,R,s)}};return t.login=function(e,R,O){_=e+"_"+(E=R),O},t.sigConnect=function(){if(i=!1,StarRtc.Instance.configModePulic){var e="https://"+StarRtc.Instance.chatRoomScheduleUrl+":"+StarRtc.Instance.chatRoomSchedulePort+"/?userId="+_;(c=new StarRtc.WebrtcWebsocket(I,e)).starConnect(function(e,R){if("success"==e){var O=R.split(":");a.ip=O[0],a.port=O[1];var t="wss://"+a.ip+":"+a.port;c.connect(t)}})}else{c=new StarRtc.WebrtcWebsocket(I,null),a.ip=StarRtc.Instance.chatRoomServerUrl,a.port=StarRtc.Instance.chatRoomServerWebsocketPort;var R="wss://"+a.ip+":"+a.port;c.connect(R)}},t.sigDisconnect=function(e){null==e&&(e=!0),i=e,null!=c&&(c.close(),c=null)},t.createNew=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.je,{roomType:0==r.roomInfo.Type?1:2,conCurrentNum:100,userDefineData:r.roomInfo.Name})))},t.sendChatMsg=function(e){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.OR,{roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:e})))},t.sendChatPrivateMsg=function(e,R){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.tR,{toUserId:e,roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:R,type:"1",code:"0"})))},t.sendChatCtrlPrivateMsg=function(e,R,O){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.tR,{toUserId:e,roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:R,type:"0",code:O})))},t.kickOutUser=function(e){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.$e,{kickOutUserId:e})))},t.banToSendMsg=function(e,R){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Xe,{banUserId:e,banTime:R})))},t.getRoomOnlineNum=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.ER,{roomId:r.roomInfo.ID})))},t.deleteCurrRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.qe)))},t.joinRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Ze,{roomId:r.roomInfo.ID})))},t.leaveRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.O,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.RR)))},t.getState=function(){return null!=c?c.readyState():-1},t.activeDisconnect=function(){return i},t},module.exports=exports=StarRtc;