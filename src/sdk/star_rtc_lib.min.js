import $ from 'jquery'
import StarWebRTC from './star_rtc_video.min'
var StarRtc=window.NameSpace||{};if(void 0===APP_PRODUCT_ID)var i=0,APP_PRODUCT_ID={t:i++,R:i++,O:i++,_:i++,s:i++,S:i++,i:i++,I:i++,o:i++,A:i++,N:i++};if(void 0===ACTION_GROUP_ID){i=0;var ACTION_GROUP_ID={M:i++,V:i++,T:i++,C:i++,u:i++,P:i++}}if(void 0===MSG_TYPE){i=0;var MSG_TYPE={G:i++,L:i++,l:i++,p:i++,D:i++}}if(void 0===MSG_DATA_TYPE){i=0;var MSG_DATA_TYPE={U:i++,v:i++,H:i++,k:i++}}if(void 0===ENCRYPT_TYPE){i=0;var ENCRYPT_TYPE={g:i++,m:i++}}if(void 0===AG_MSG_VOIP_CTRL)var AG_MSG_VOIP_CTRL={h:1e3,Y:1100,F:1001,W:1002,K:1003,B:1004};if(void 0===CHATROOM_LIST_TYPE){i=0;var CHATROOM_LIST_TYPE={q:i++,J:i++,j:i++,X:i++,$:i++,Z:i++,ee:i++}}if(void 0===AG_MSG){i=0;var AG_MSG={te:i++,Re:i++,ae:i++,Oe:i++,_e:i++,Ee:i++,re:i++,se:i++,ne:i++,ce:i++,Se:i++,ie:i++,Ie:i++,oe:i++,Ae:i++,Ne:i++,Me:i++,Ve:i++,Te:i++,Ce:i++,ue:i++,Pe:i++,Ge:i++,Le:i++,le:i++,pe:i++,fe:i++,De:i++,Ue:i++,de:i++,ve:i++,be:i++,He:i++,ke:i++,ge:i++,me:i++,ye:i++,we:i++,xe:i++,he:i++,Ye:i++,Fe:i++,We:i++,Ke:i++,Be:i++}}if(void 0===CHAT_ROOM_TYPE){i=1;var CHAT_ROOM_TYPE={qe:i++,Je:i++}}if(void 0===AG_CHATROOMMOONSERVER){i=0;var AG_CHATROOMMOONSERVER={Qe:i++,je:i++,Xe:i++,$e:i++,ze:i++,Ze:i++,et:i++,tt:i++,Rt:i++,at:i++,Ot:i++,_t:i++,Et:i++,rt:i++,st:i++,nt:i++,ct:i++,St:i++,it:i++,It:i++,ot:i++,At:i++,Nt:i++,Mt:i++,Vt:i++,Tt:i++,Ct:i++,ut:i++,Pt:i++,Gt:i++,Lt:i++,lt:i++,pt:i++,ft:i++,Dt:i++,Ut:i++,dt:i++,vt:i++,bt:i++,Ht:i++,kt:i++,gt:i++,yt:i++,wt:i++,xt:i++}}if(void 0===AG_VOIPMOONSERVER){i=0;var AG_VOIPMOONSERVER={ht:i++,Yt:i++,Ft:i++,Wt:i++,Kt:i++,Bt:i++,qt:i++,Jt:i++,Qt:i++,jt:i++,Xt:i++,$t:i++,zt:i++,Zt:i++,eR:i++,tR:i++,RR:i++,aR:i++,OR:i++,_R:i++,ER:i++,rR:i++,sR:i++,nR:i++,cR:i++,SR:i++,iR:i++,IR:i++,oR:i++,AR:i++,NR:i++,MR:i++,VR:i++,TR:i++,CR:i++,uR:i++,PR:i++,GR:i++,LR:i++}}if(void 0===AG_LIVESRCMOONSERVER){i=0;var AG_LIVESRCMOONSERVER={lR:i++,pR:i++,fR:i++,DR:i++,UR:i++,dR:i++,vR:i++,bR:i++,HR:i++,kR:i++,gR:i++,mR:i++,yR:i++,wR:i++,xR:i++,hR:i++,YR:i++,FR:i++,WR:i++,KR:i++,BR:i++,qR:i++,JR:i++,QR:i++,jR:i++,XR:i++,$R:i++,zR:i++,ZR:i++,ea:i++,ta:i++,Ra:i++,aa:i++,Oa:i++,_a:i++,Ea:i++,ra:i++,sa:i++,na:i++,ca:i++,Sa:i++,ia:i++,Ia:i++,oa:i++,Aa:i++,Na:i++,Ma:i++,Va:i++,Ta:i++,Ca:i++,ua:i++,Pa:i++,Ga:i++,La:i++,la:i++,pa:i++,fa:i++,Da:i++,Ua:i++,da:i++,va:i++,ba:i++,Ha:i++}}if(void 0===AG_LIVEVDNMOONSERVER){i=0;var AG_LIVEVDNMOONSERVER={ka:i++,ga:i++,ma:i++,ya:i++,wa:i++,xa:i++,ha:i++,Ya:i++,Fa:i++,Wa:i++,Ka:i++,Ba:i++,qa:i++,Ja:i++,Qa:i++,ja:i++,Xa:i++,$a:i++,za:i++,Za:i++,eO:i++,tO:i++,RO:i++}}function clone(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return(t=new Date).setTime(e.getTime()),t;if(e instanceof Array){for(var t=[],R=e.length,a=0;a<R;++a)t[a]=clone(e[a]);return t}if(e instanceof Object){t={};for(var O in e)e.hasOwnProperty(O)&&(t[O]=clone(e[O]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")}StarRtc.AUtils=new function(){var b,H=this,k="",g="",m="",y="";function T(e,t){for(var R=Y(e),a=W(x(R.length.toString(16))),O=Y(t),_=W(x(O.length.toString(16))),E=new Uint8Array(R.length+O.length+8),r=0,s=a.length,n=r;n<s;n++)E[n]=a[n-r];s=(r=s)+R.length;for(n=r;n<s;n++)E[n]=R[n-r];s=(r=s)+_.length;for(n=r;n<s;n++)E[n]=_[n-r];s=(r=s)+O.length;for(n=r;n<s;n++)E[n]=O[n-r];return E}function w(e){var t=new Uint8Array(e),R=0,a=parseInt("0x"+K(t.slice(R,R+4)));R+=4;var O=F(t.slice(R,R+a));R+=a;var _=parseInt("0x"+K(t.slice(R,R+4)));return R+=4,{digest:O,content:F(t.slice(R,R+_))}}function x(e){var t=8-e.length;return"00000000".substr(0,t)+e}function h(e){var t=4-e.length;return"0000".substr(0,t)+e}function N(e,t){var R=new Array(e+1).join("0"),a=e-t.length;return R.substr(0,a)+t}function Y(e){var t,R,a=new Array;t=e.length;for(var O=0;O<t;O++)65536<=(R=e.charCodeAt(O))&&R<=1114111?(a.push(R>>18&7|240),a.push(R>>12&63|128),a.push(R>>6&63|128),a.push(63&R|128)):2048<=R&&R<=65535?(a.push(R>>12&15|224),a.push(R>>6&63|128),a.push(63&R|128)):128<=R&&R<=2047?(a.push(R>>6&31|192),a.push(63&R|128)):a.push(255&R);return a}function F(e){if("string"==typeof e)return e;for(var t="",R=e,a=0;a<R.length;a++){var O=R[a].toString(2),_=O.match(/^1+?(?=0)/);if(_&&8==O.length){for(var E=_[0].length,r=R[a].toString(2).slice(7-E),s=1;s<E;s++)r+=R[s+a].toString(2).slice(2);t+=String.fromCharCode(parseInt(r,2)),a+=E-1}else t+=String.fromCharCode(R[a])}return t}function W(e){var t=0,R=e.length;if(R%2!=0)return null;R/=2;for(var a=new Array,O=0;O<R;O++){var _=e.substr(t,2),E=parseInt("0x"+_);a.push(E),t+=2}return a}function K(e){for(var t="",R=0;R<e.length;R++){var a=e[R].toString(16);1==a.length&&(a="0"+a),t+=a}return t}function B(e,t,R){var a=t;for(var O in R)for(var _=R[O],E=0;E<_.length;E++,a++)e[a]=_[E]}H.msgMaxLen=0,H.setUserInfo=function(e,t,R){m=(k=e)+"_"+(g=t),y=R},H.clear=function(){y=m=g=k="",H.msgMaxLen=0,clearInterval(b)},H.parseProtocol=function(e,c){var t=new Blob([e],{type:"text/plain"}),S=new FileReader;S.readAsArrayBuffer(t),S.onload=function(e){var t=new Uint8Array(S.result);console.info("parseProtocol:",t);var R=t[0],a=t.slice(1,5),O=t[5],_=t.slice(6,8),E=t.slice(8,10),r=t[10],s=t.slice(11,t.byteLength-2);console.info("parseProtocol: msgArr = ",s);var n=t.slice(t.byteLength-2,t.byteLength);c({appid:R,plength:a,appver:O,rese1:_,rese2:E,actionid:r,msgArr:s,end:n})}},H.packageProtocol=function(e,t,R){var a=e,O=new Array(255,255),_=new Array(255,255),E=t,r=(new Array(18,52),R),s=new Uint8Array(r),n=W(x((r.byteLength+12).toString(16))),c=new ArrayBuffer(r.byteLength+13),S=new Uint8Array(c);S[0]=a;for(var i=1;i<5;i++)S[i]=n[i-1];S[5]=1,S[6]=O[0],S[7]=O[1],S[8]=_[0],S[9]=_[1],S[10]=E;for(i=11;i<11+s.byteLength;i++)S[i]=s[i-11];return S[11+s.byteLength]=18,S[12+s.byteLength]=52,console.log("packageProtocol",S),S},H.constructAuthMsg=function(){for(var e=W(h(AG_MSG.te.toString(16))),t=Y(m),R=W(h(t.length.toString(16))),a=Y(y),O=new Uint8Array(t.length+36),_=0,E=e.length,r=_;r<E;r++)O[r]=e[r];E=(_=E)+R.length;for(r=_;r<E;r++)O[r]=R[r-_];E=(_=E)+t.length;for(r=_;r<E;r++)O[r]=t[r-_];E=(_=E)+a.length;for(r=_;r<E;r++)O[r]=a[r-_];_=0;var s=[];return s.push(e),s.push(R),s.push(t),s.push(a),B(O,_,s),O},H.constructMsgProtocol=function(e,t){var R,a=[],O=W(h(e.toString(16))),_=Y(m),E=W(h(_.length.toString(16)));W(h(Y(y).length.toString(16)));switch(e){case AG_MSG.re:var r=W(x(t.reqIndex.toString(16))),s=W(x((S=Y(t.addUsers)).length.toString(16))),n=W(x((i=Y(t.userDefineData)).length.toString(16)));R=new Uint8Array(6+(2+_.length)+(4+S.length)+(4+i.length)),a.push(O),a.push(r),a.push(E),a.push(_),a.push(s),a.push(S),a.push(n),a.push(i);break;case AG_MSG.se:r=W(x(t.reqIndex.toString(16)));var c=W(x((A=Y(t.groupId)).length.toString(16)));R=new Uint8Array(6+(2+A.length)+(2+_.length)),a.push(O),a.push(r),a.push(c),a.push(A),a.push(E),a.push(_);break;case AG_MSG.ne:var S;r=W(x(t.reqIndex.toString(16))),c=W(x((A=Y(t.groupId)).length.toString(16))),s=W(x((S=Y(t.addUsers)).length.toString(16))),n=W(x((i=Y(t.userDefineData)).length.toString(16)));R=new Uint8Array(6+(2+A.length)+(2+_.length)+(4+S.length)+(4+i.length)),a.push(O),a.push(r),a.push(c),a.push(A),a.push(E),a.push(_),a.push(s),a.push(S),a.push(n),a.push(i);break;case AG_MSG.ce:r=W(x(t.reqIndex.toString(16))),c=W(x((A=Y(t.groupId)).length.toString(16)));var i,I=Y(t.removeUsers),o=W(x(I.length.toString(16)));n=W(x((i=Y(t.userDefineData)).length.toString(16)));R=new Uint8Array(6+(2+A.length)+(2+_.length)+(4+I.length)),a.push(O),a.push(r),a.push(c),a.push(A),a.push(E),a.push(_),a.push(o),a.push(I);break;case AG_MSG.Se:case AG_MSG.ie:r=W(x(t.reqIndex.toString(16))),c=W(x((A=Y(t.groupId)).length.toString(16)));R=new Uint8Array(6+(2+A.length)+(2+_.length)),a.push(O),a.push(r),a.push(c),a.push(A),a.push(E),a.push(_);break;case AG_MSG.Ie:case AG_MSG.oe:break;case AG_MSG.ye:r=W(x(t.reqIndex.toString(16)));R=new Uint8Array(6+(2+_.length)),a.push(O),a.push(r),a.push(E),a.push(_);break;case AG_MSG.xe:var A;r=W(x(t.reqIndex.toString(16))),c=W(h((A=Y(t.groupId)).length.toString(16)));R=new Uint8Array(6+(2+_.length)+(2+A.length)),a.push(O),a.push(r),a.push(E),a.push(_),a.push(c),a.push(A);break;case AG_MSG.Ye:R=new Uint8Array(2),a.push(O);break;case AG_MSG.We:R=new Uint8Array(4);var N=W(h(t.reqPageNum.toString(16)));a.push(O),a.push(N)}return B(R,0,a),R},H.constructSingleMsg=function(e,t,R,a,O){var _=W(h(AG_MSG.Ee.toString(16))),E=Y(m),r=W(h(E.length.toString(16))),s=Y(k+"_"+e),n=W(h(s.length.toString(16))),c=W(x(t.toString(16))),S=ENCRYPT_TYPE.g,i=MSG_DATA_TYPE.v;null!=O&&(i=O);var I={fromId:g,targetId:e,time:"0",msgIndex:t,type:1,code:0,contentData:a},o=T(R,JSON.stringify(I)),A=W(x(o.length.toString(16))),N=new Uint8Array(E.length+s.length+o.length+16),M=[];return M.push(_),M.push(r),M.push(E),M.push(n),M.push(s),M.push(c),M.push([S]),M.push([i]),M.push(A),M.push(o),B(N,0,M),N},H.constructGroupMsg=function(e,t,R,a){var O=W(h(AG_MSG.Ae.toString(16))),_=Y(""),E=W(h(_.length.toString(16))),r=W(x(t.toString(16))),s=Y(k+"_"+e),n=W(h(s.length.toString(16))),c=Y(m),S=W(h(c.length.toString(16))),i=ENCRYPT_TYPE.g,I=MSG_DATA_TYPE.v,o={fromId:g,targetId:e,time:"0",msgIndex:t,type:1,code:0,contentData:a},A=T(R,JSON.stringify(o)),N=W(x(A.length.toString(16))),M=new Uint8Array(_.length+s.length+c.length+A.length+18),V=[];return V.push(O),V.push(E),V.push(_),V.push(r),V.push(n),V.push(s),V.push(S),V.push(c),V.push([i]),V.push([I]),V.push(N),V.push(A),B(M,0,V),M},H.constructReceivedMsg=function(e){var t=W(h(AG_MSG.fe.toString(16))),R=Y(m),a=W(h(R.length.toString(16))),O=new Uint8Array(e),_=new Uint8Array(R.length+12),E=[];return E.push(t),E.push(a),E.push(R),E.push(O),B(_,0,E),_},H.constructSingleCtrlMsg=function(e,t,R,a,O){var _=W(h(AG_MSG.Ee.toString(16))),E=Y(m),r=W(h(E.length.toString(16))),s=Y(k+"_"+e),n=W(h(s.length.toString(16))),c=W(x(t.toString(16))),S=ENCRYPT_TYPE.g,i=MSG_DATA_TYPE.U,I={fromId:g,targetId:e,time:"0",msgIndex:t,type:0,code:parseInt(O),contentData:a},o=T(R,JSON.stringify(I)),A=W(x(o.length.toString(16))),N=new Uint8Array(E.length+s.length+o.length+16),M=[];return M.push(_),M.push(r),M.push(E),M.push(n),M.push(s),M.push(c),M.push([S]),M.push([i]),M.push(A),M.push(o),B(N,0,M),N},H.constructVOIPProtocol=function(e,t){var R,a=[],O=W(h(e.toString(16))),_=Y(m),E=W(h(_.length.toString(16))),r=Y(y),s=W(h(r.length.toString(16)));switch(e){case AG_VOIPMOONSERVER.Wt:case AG_VOIPMOONSERVER.Bt:var n=Y(k+"_"+t.targetId),c=W(h(n.length.toString(16))),S=W(N(8,parseInt(t.audioSSRC).toString(16))),i=W(N(8,parseInt(t.videoSSRC).toString(16))),I=W(N(2,parseInt(t.videoCodec).toString(16))),o=W(N(2,parseInt(t.audioCodec).toString(16)));R=new Uint8Array(2+(2+_.length)+(2+r.length)+(2+n.length)+4+4+1+1),a.push(O),a.push(E),a.push(_),a.push(s),a.push(r),a.push(c),a.push(n),a.push(S),a.push(i),a.push(I),a.push(o);break;case AG_VOIPMOONSERVER.Qt:var A=t.isActive;R=new Uint8Array(3),a.push(O),a.push([A])}return B(R,0,a),R},H.constructSrcProtocol=function(e,t){var R,a=[],O=W(h(e.toString(16))),_=W(h((o=Y(m)).length.toString(16))),E=W(h((A=Y(y)).length.toString(16)));switch(e){case AG_LIVESRCMOONSERVER.FR:case AG_LIVESRCMOONSERVER.WR:var r=W(h(t.conCurrentNum.toString(16))),s=W(h((0).toString(16))),n=W(h((i=Y(t.roomId)).length.toString(16))),c=t.liveType,S=W(h((V=Y(t.extra)).length.toString(16)));R=new Uint8Array(2+(2+o.length)+(2+A.length)+2+2+(2+i.length)+1+(2+V.length)),a.push(O),a.push(_),a.push(o),a.push(E),a.push(A),a.push(r),a.push(s),a.push(n),a.push(i),a.push([c]),a.push(S),a.push(V);break;case AG_LIVESRCMOONSERVER.KR:r=W(h(t.conCurrentNum.toString(16))),s=W(h(t.validTime.toString(16))),n=W(h((i=Y(t.roomId)).length.toString(16))),S=W(h((V=Y(t.extra)).length.toString(16)));var i,I=W(h((T=Y(t.spec)).length.toString(16)));a.push(O),a.push(_),a.push(o),a.push(E),a.push(A),a.push(r),a.push(s),a.push(n),a.push(i),a.push(S),a.push(V),a.push(I),a.push(T);break;case AG_LIVESRCMOONSERVER.BR:O=W(h(e.toString(16))),_=W(h((o=Y(g)).length.toString(16))),E=W(h((A=Y(y)).length.toString(16))),s=W(h((0).toString(16)));var o,A,N=W(h((M=Y(t.groupId)).length.toString(16)));S=W(h((V=Y(t.extra)).length.toString(16)));a.push(O),a.push(_),a.push(o),a.push(E),a.push(A),a.push(s),a.push(N),a.push(M),a.push(S),a.push(V);break;case AG_LIVESRCMOONSERVER.qR:var M,V,T;s=W(h((0).toString(16))),N=W(h((M=Y(t.groupId)).length.toString(16))),S=W(h((V=Y(t.extra)).length.toString(16))),I=W(h((T=Y(t.spec)).length.toString(16)));a.push(O),a.push(_),a.push(o),a.push(E),a.push(A),a.push(s),a.push(N),a.push(M),a.push(S),a.push(V),a.push(I),a.push(T);break;case AG_LIVESRCMOONSERVER.JR:var C=Y(t.channelId),u=Y(t.avParam),P=W(h(u.length.toString(16)));a.push(O),a.push(_),a.push(o),a.push(E),a.push(A),a.push(C),a.push(P),a.push(u);break;case AG_LIVESRCMOONSERVER.jR:C=Y(t.channelId);var G=W(h((L=Y(t.upUserId)).length.toString(16)));a.push(O),a.push(_),a.push(o),a.push(E),a.push(A),a.push(C),a.push(G),a.push(L);break;case AG_LIVESRCMOONSERVER.XR:case AG_LIVESRCMOONSERVER.$R:case AG_LIVESRCMOONSERVER.zR:var L;C=Y(t.channelId),G=W(h((L=Y(t.upUserId)).length.toString(16)));a.push(O),a.push(_),a.push(o),a.push(E),a.push(A),a.push(C),a.push(G),a.push(L);break;case AG_LIVESRCMOONSERVER.ZR:case AG_LIVESRCMOONSERVER.ea:C=Y(t.channelId);R=new Uint8Array(2+(2+o.length)+(2+A.length)+16),a.push(O),a.push(_),a.push(o),a.push(E),a.push(A),a.push(C);break;case AG_LIVESRCMOONSERVER.ta:for(var l=t.streamConfig,p=new Uint8Array(16),f=0;f<16;f++)null!=l[f]?p[f]=l[f]:p[f]=0;R=new Uint8Array(18),a.push(O),a.push(p);break;case AG_LIVESRCMOONSERVER.Ra:C=Y(t.channelId);a.push(O),a.push(C);break;case AG_LIVESRCMOONSERVER.Oa:a.push(O);break;case AG_LIVESRCMOONSERVER.aa:var D=Y(t.streamData);R=new Uint8Array(3+D.length),a.push(O),a.push([t.streamDataType]),a.push(D)}return B(R,0,a),R},H.constructVdnProtocol=function(e,t){var R,a=[],O=W(h(e.toString(16))),_=Y(m),E=W(h(_.length.toString(16))),r=Y(y),s=W(h(r.length.toString(16)));switch(e){case AG_LIVEVDNMOONSERVER.ma:var n=W(N(8,parseInt(t.ssrc).toString(16))),c=W(N(2,parseInt(t.videoCodec).toString(16))),S=W(N(2,parseInt(t.audioCodec).toString(16)));R=new Uint8Array(8),a.push(O),a.push(n),a.push(c),a.push(S);break;case AG_LIVEVDNMOONSERVER.ya:var i=Y(t.channelId);R=new Uint8Array(18+(2+_.length)+(2+r.length)),a.push(O),a.push(i),a.push(E),a.push(_),a.push(s),a.push(r);break;case AG_LIVEVDNMOONSERVER.wa:case AG_LIVEVDNMOONSERVER.xa:R=new Uint8Array(2),a.push(O);break;case AG_LIVEVDNMOONSERVER.Fa:case AG_LIVEVDNMOONSERVER.ha:i=Y(t.channelId);R=new Uint8Array(18),a.push(O),a.push(i);break;case AG_LIVEVDNMOONSERVER.Ya:for(var I=t.streamConfig,o=new Uint8Array(16),A=0;A<16;A++)null!=I[A]?o[A]=I[A]:o[A]=0;R=new Uint8Array(18),a.push(O),a.push(o)}return B(R,0,a),R},H.constructChatProtocol=function(e,t){var R,a=[],O=W(h(e.toString(16))),_=Y(m),E=W(h(_.length.toString(16))),r=Y(y),s=W(h(r.length.toString(16)));if(e==AG_CHATROOMMOONSERVER.Qe){var n=t.roomType,c=W(h(t.conCurrentNum.toString(16))),S=W(x((l=Y(t.userDefineData)).length.toString(16)));R=new Uint8Array(2+(2+_.length)+(2+r.length)+1+2+(4+l.length)),a.push(O),a.push(E),a.push(_),a.push(s),a.push(r),a.push([n]),a.push(c),a.push(S),a.push(l)}else if(e==AG_CHATROOMMOONSERVER.je)R=new Uint8Array(2),a.push(O);else if(e==AG_CHATROOMMOONSERVER.Xe){var i=Y(k+"_"+t.banUserId),I=W(h(i.length.toString(16))),o=W(h(t.banTime.toString(16)));R=new Uint8Array(2+(2+i.length)+2),a.push(O),a.push(I),a.push(i),a.push(o)}else if(e==AG_CHATROOMMOONSERVER.$e){var A=Y(k+"_"+t.kickOutUserId),N=W(h(A.length.toString(16)));R=new Uint8Array(2+(2+A.length)),a.push(O),a.push(N),a.push(A)}else if(e==AG_CHATROOMMOONSERVER.ze)R=new Uint8Array(2),a.push(O);else if(e==AG_CHATROOMMOONSERVER.Ze){var M=Y(t.roomId);R=new Uint8Array(2+(2+_.length)+(2+r.length)+16),a.push(O),a.push(E),a.push(_),a.push(s),a.push(r),a.push(M)}else if(e==AG_CHATROOMMOONSERVER.et);else if(e==AG_CHATROOMMOONSERVER.tt)R=new Uint8Array(2),a.push(O);else if(e==AG_CHATROOMMOONSERVER.Rt){var V={fromId:g,targetId:t.roomId,time:"0",msgIndex:t.msgIndex,type:1,code:0,contentData:t.msg},T=Y(JSON.stringify(V)),C=W(x(T.length.toString(16)));R=new Uint8Array(2+(4+T.length)),a.push(O),a.push(C),a.push(T)}else if(e==AG_CHATROOMMOONSERVER.at){V={fromId:g,targetId:t.roomId,time:"0",msgIndex:t.msgIndex,type:parseInt(t.type),code:parseInt(t.code),contentData:t.msg};var u=Y(JSON.stringify(V)),P=W(x(u.length.toString(16))),G=Y(k+"_"+t.toUserId),L=W(h(G.length.toString(16)));R=new Uint8Array(2+(2+G.length)+(4+u.length)),a.push(O),a.push(L),a.push(G),a.push(P),a.push(u)}else if(e==AG_CHATROOMMOONSERVER.Ot){M=Y(t.roomId);R=new Uint8Array(18),a.push(O),a.push(M)}else if(e==AG_CHATROOMMOONSERVER.vt){var l,p=W(h((D=Y(g)).length.toString(16))),f=W(h(t.listType.toString(16)));S=W(x((l=Y(t.userDefineData)).length.toString(16))),M=Y(t.roomId);R=new Uint8Array(4+(2+D.length)+16+(4+l.length)),a.push(O),a.push(f),a.push(p),a.push(D),a.push(M),a.push(S),a.push(l)}else if(e==AG_CHATROOMMOONSERVER.kt){f=W(h(t.listType.toString(16))),M=Y(t.roomId);R=new Uint8Array(4+(2+_.length)+16),a.push(O),a.push(f),a.push(E),a.push(_),a.push(M)}else if(e==AG_CHATROOMMOONSERVER.wt){var D,U=Y(t.listTypes),d=W(h(U.length.toString(16))),v=W(h((D=Y(t.userId)).length.toString(16)));R=new Uint8Array(2+(2+U.length)+(2+D.length)),a.push(O),a.push(d),a.push(U),a.push(v),a.push(D)}return B(R,0,a),R},H.constructWebrtcUploadMsgProtocol=function(e){var t=W(h(AG_LIVESRCMOONSERVER.QR.toString(16))),R=Y(m),a=W(h(R.length.toString(16))),O=Y(y),_=W(h(O.length.toString(16))),E=Y(e.channelId),r=W(N(8,parseInt(e.audioSSRC).toString(16))),s=W(N(8,parseInt(e.smallVideoSSRC).toString(16))),n=W(N(8,parseInt(e.bigVideoSSRC).toString(16))),c=W(N(2,parseInt(e.videoCodec).toString(16))),S=W(N(2,parseInt(e.audioCodec).toString(16))),i=new Uint8Array(R.length+O.length+34+1+1);return B(i,0,[t,a,R,_,O,E,r,s,n,c,S]),i},H.parseMessage=function(e,t){var R,a=new Uint8Array(e);switch(parseInt("0x"+K(a.slice(0,2)))){case AG_MSG.Re:a=new Uint8Array(e);StarRtc.AUtils.msgMaxLen=parseInt("0x"+K(a.slice(2,4))),console.log("登录成功，最大消息长度：",StarRtc.AUtils.msgMaxLen),StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,H.constructHeartBeatMsg(AG_MSG.Oe))),b=setInterval(function(){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,H.constructHeartBeatMsg(AG_MSG.Oe)))},15e3),t({status:"success"},"onLoginMessage");break;case AG_MSG.ae:console.log("登录失败"),t({status:"failed"},"onLoginMessage");break;case AG_MSG._e:console.log("心跳反馈");break;case AG_MSG.le:console.log("服务器收到消息");break;case AG_MSG.pe:console.log("收到消息");parseInt("0x"+K(a.slice(10,14)));var O=15;switch(a[14]){case MSG_TYPE.G:console.log("单聊消息");var _=parseInt("0x"+K(a.slice(O,O+2)));O+=2;var E=F(a.slice(O,O+_)),r=a[O+=_];switch(O+=1,r){case ENCRYPT_TYPE.g:var s=parseInt("0x"+K(a.slice(O,O+4)));O+=4;var n=w(a.slice(O,O+s));console.log(E,n.digest,n.content),2==(i=E.split("_")).length&&(E=i[1]),t(e={fromId:E,digest:n.digest,msg:n.content},"onSingleMessage");break;case ENCRYPT_TYPE.m:}break;case MSG_TYPE.L:console.log("群消息");var c=parseInt("0x"+K(a.slice(O,O+2)));O+=2;var S=F(a.slice(O,O+c));O+=c;_=parseInt("0x"+K(a.slice(O,O+2)));O+=2;E=F(a.slice(O,O+_)),r=a[O+=_];switch(O+=1,r){case ENCRYPT_TYPE.g:s=parseInt("0x"+K(a.slice(O,O+4)));O+=4;n=w(a.slice(O,O+s));console.log(S,E,n.digest,n.content),2==(i=E.split("_")).length&&(E=i[1]),2==(I=S.split("_")).length&&(S=I[1]),t(e={groupId:S,fromId:E,digest:n.digest,msg:n.content},"onGroupMessage");break;case ENCRYPT_TYPE.m:}break;case MSG_TYPE.l:console.log("群私信消息");c=parseInt("0x"+K(a.slice(O,O+2)));O+=2;S=F(a.slice(O,O+c));O+=c;_=parseInt("0x"+K(a.slice(O,O+2)));O+=2;E=F(a.slice(O,O+_)),r=a[O+=_];switch(O+=1,r){case ENCRYPT_TYPE.g:s=parseInt("0x"+K(a.slice(O,O+4)));O+=4;var i;n=w(a.slice(O,O+s));console.log(S,E,n.digest,n.content),2==(i=E.split("_")).length&&(E=i[1]),2==(I=S.split("_")).length&&(S=I[1]),t(e={groupId:S,fromId:E,digest:n.digest,msg:n.content},"onGroupPrivateMessage");break;case ENCRYPT_TYPE.m:}break;case MSG_TYPE.p:console.log("推送群信息");c=parseInt("0x"+K(a.slice(O,O+2)));O+=2;S=F(a.slice(O,O+c));O+=c;s=parseInt("0x"+K(a.slice(O,O+4)));O+=4;var I;n=w(a.slice(O,O+s));console.log(S,n.digest,n.content),2==(I=S.split("_")).length&&(S=I[1]),t(e={groupId:S,digest:n.digest,msg:n.content},"onGroupPushMessage");break;case MSG_TYPE.D:console.log("推送系统信息");s=parseInt("0x"+K(a.slice(O,O+4)));O+=4;n=w(a.slice(O,O+s));console.log(n.digest,n.content),t(e={digest:n.digest,msg:n.content},"onSystemPushMessage")}R=a.slice(2,10),console.log("发送消息回执"),StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructReceivedMsg(R)));break;case AG_MSG.De:var o=parseInt("0x"+K(a.slice(2,4))),A=F(a.slice(6,a.byteLength));console.log("报错:",o,A),t(e={errId:o,errStr:A},"onErrorMessage");break;case AG_MSG.Ne:var N=parseInt("0x"+K(a.slice(2,4))),M=F(a.slice(4,4+N)),V=parseInt("0x"+K(a.slice(4+N,4+N+4)));c=parseInt("0x"+K(a.slice(4+N+4,4+N+4+2)));t({status:"success",statusStr:M,groupMsgIndex:V,groupId:S=F(a.slice(4+N+4+2,4+N+4+2+c)),serverTimestamp:parseInt("0x"+K(a.slice(4+N+4+2+c,4+N+4+2+c+4)))},"onSendGroupMsgFin");break;case AG_MSG.Me:N=parseInt("0x"+K(a.slice(2,4))),M=F(a.slice(4,4+N));var T=parseInt("0x"+K(a.slice(4+N,4+N+4)));c=parseInt("0x"+K(a.slice(4+N+4,4+N+4+2)));t({status:"success",statusStr:M,reqIndex:T,groupId:S=F(a.slice(4+N+4+2,4+N+4+2+c))},"onCreateGroupFin");break;case AG_MSG.Ve:N=parseInt("0x"+K(a.slice(2,4))),M=F(a.slice(4,4+N)),T=parseInt("0x"+K(a.slice(4+N,4+N+4))),c=parseInt("0x"+K(a.slice(4+N+4,4+N+4+2)));t({status:"success",statusStr:M,reqIndex:T,groupId:S=F(a.slice(4+N+4+2,4+N+4+2+c))},"onDelGroupFin");break;case AG_MSG.Te:N=parseInt("0x"+K(a.slice(2,4))),M=F(a.slice(4,4+N)),T=parseInt("0x"+K(a.slice(4+N,4+N+4))),c=parseInt("0x"+K(a.slice(4+N+4,4+N+4+2)));t({status:"success",statusStr:M,reqIndex:T,groupId:S=F(a.slice(4+N+4+2,4+N+4+2+c))},"onAddGroupUserFin");break;case AG_MSG.Ce:N=parseInt("0x"+K(a.slice(2,4))),M=F(a.slice(4,4+N)),T=parseInt("0x"+K(a.slice(4+N,4+N+4))),c=parseInt("0x"+K(a.slice(4+N+4,4+N+4+2)));t({status:"success",statusStr:M,reqIndex:T,groupId:S=F(a.slice(4+N+4+2,4+N+4+2+c))},"onRemoveGroupUserFin");break;case AG_MSG.ue:N=parseInt("0x"+K(a.slice(2,4))),M=F(a.slice(4,4+N)),T=parseInt("0x"+K(a.slice(4+N,4+N+4))),c=parseInt("0x"+K(a.slice(4+N+4,4+N+4+2)));t({status:"success",statusStr:M,reqIndex:T,groupId:S=F(a.slice(4+N+4+2,4+N+4+2+c))},"onSetGroupMsgIgnoreFin");break;case AG_MSG.Pe:N=parseInt("0x"+K(a.slice(2,4))),M=F(a.slice(4,4+N)),T=parseInt("0x"+K(a.slice(4+N,4+N+4))),c=parseInt("0x"+K(a.slice(4+N+4,4+N+4+2)));t({status:"success",statusStr:M,reqIndex:T,groupId:S=F(a.slice(4+N+4+2,4+N+4+2+c))},"onUnsetGroupMsgIgnoreFin");break;case AG_MSG.Ge:N=parseInt("0x"+K(a.slice(2,4)));t({status:"success",statusStr:M=F(a.slice(4,4+N)),reqIndex:T=parseInt("0x"+K(a.slice(4+N,4+N+4)))},"onPushSystemMsgFin");break;case AG_MSG.Le:N=parseInt("0x"+K(a.slice(2,4))),M=F(a.slice(4,4+N)),T=parseInt("0x"+K(a.slice(4+N,4+N+4))),c=parseInt("0x"+K(a.slice(4+N+4,4+N+4+2)));t({status:"success",statusStr:M,reqIndex:T,groupId:S=F(a.slice(4+N+4+2,4+N+4+2+c))},"onPushGroupSystemMsgFin");break;case AG_MSG.we:N=parseInt("0x"+K(a.slice(2,4))),M=F(a.slice(4,4+N)),T=parseInt("0x"+K(a.slice(4+N,4+N+4)));var C=parseInt("0x"+K(a.slice(4+N+4,4+N+4+4))),u=F(a.slice(4+N+4+4,4+N+4+4+C)).split(",");0==C&&(u=[]);for(var P=parseInt("0x"+K(a.slice(4+N+4+4+C,4+N+4+4+C+4))),G=F(a.slice(4+N+4+4+C+4,4+N+4+4+C+4+P)).split(","),L=parseInt("0x"+K(a.slice(4+N+4+4+C+4+P,4+N+4+4+C+4+P+4))),l=F(a.slice(4+N+4+4+C+4+P+4,4+N+4+4+C+4+P+4+L)).split(","),p=[],f=0;f<u.length;f++){var D={groupId:u[f],groupName:G[f],creator:l[f]};p.push(D)}t({status:"success",statusStr:M,reqIndex:T,groupsInfo:p},"onGetGroupList");break;case AG_MSG.he:N=parseInt("0x"+K(a.slice(2,4))),M=F(a.slice(4,4+N)),T=parseInt("0x"+K(a.slice(4+N,4+N+4)));var U=parseInt("0x"+K(a.slice(4+N+4,4+N+4+4)));t({status:"success",statusStr:M,reqIndex:T,userIdList:F(a.slice(4+N+4+4,4+N+4+4+U)).split(",")},"onGetGroupUserList");break;case AG_MSG.Fe:t({status:"success",count:parseInt("0x"+K(a.slice(2,6))),totalPageNum:d=parseInt("0x"+K(a.slice(6,8)))},"onGetOnlineNumber");break;case AG_MSG.Ke:var d=parseInt("0x"+K(a.slice(2,4))),v=parseInt("0x"+K(a.slice(4,6)));U=parseInt("0x"+K(a.slice(6,10)));t({status:"success",totalPageNum:d,reqPageNum:v,userIdList:F(a.slice(10,10+U)).split(",")},"onGetAllUserList");break;case AG_MSG.Be:t({status:"failed",totalPageNum:d=parseInt("0x"+K(a.slice(2,4))),reqPageNum:v=parseInt("0x"+K(a.slice(4,6)))},"onGetAllUserList")}},H.parseSrcMoonServerMessage=function(e,t){var R=new Uint8Array(e);switch(parseInt("0x"+K(R.slice(0,2)))){case AG_LIVESRCMOONSERVER.sa:K(R.slice(18,20));var a=parseInt("0x"+K(R.slice(18,20)));t({type:"srcApplyUpload",status:"success",fingerprint:F(R.slice(20,20+a))});break;case AG_LIVESRCMOONSERVER.na:var O=parseInt("0x"+K(R.slice(2,4)));t({type:"srcApplyUpload",status:"failed",msg:i=F(R.slice(4,4+O))});break;case AG_LIVESRCMOONSERVER.Ua:console.log("webrtc心跳反馈");break;case AG_LIVESRCMOONSERVER.da:for(var _=parseInt("0x"+K(R.slice(2,3))),E=3,r=R.length,s={siv:_,uperInfos:{}};E<r;){var n=parseInt("0x"+K(R.slice(E,E+1)));E+=1;var c=parseInt("0x"+K(R.slice(E,E+2)));E+=2;var S=F(R.slice(E,E+c));E+=c,s.uperInfos[n]={upId:n,userId:S}}t({type:"uperStreamInfoUpdate",status:"success",msg:s});break;case AG_LIVESRCMOONSERVER.Da:t({type:"stopStream",status:"success"});break;case AG_LIVESRCMOONSERVER.Ga:t({type:"streamConfig",status:"success",channelId:F(R.slice(2,18))});break;case AG_LIVESRCMOONSERVER.La:t({type:"streamConfig",status:"failed",channelId:F(R.slice(2,18))});break;case AG_LIVESRCMOONSERVER.ua:t({type:"delChannel",status:"success",channelId:F(R.slice(2,18))});break;case AG_LIVESRCMOONSERVER.Pa:O=parseInt("0x"+K(R.slice(2,4)));var i=F(R.slice(4,4+O));t({type:"delChannel",status:"failed",channelId:F(R.slice(4+O,4+O+16)),msg:i});break;case AG_LIVESRCMOONSERVER._a:t({type:"createChannel",status:"success",channelId:F(R.slice(2,18))});break;case AG_LIVESRCMOONSERVER.Ea:O=parseInt("0x"+K(R.slice(2,4)));t({type:"createChannel",status:"failed",msg:i=F(R.slice(4,4+O))});break;case AG_LIVESRCMOONSERVER.va:n=parseInt("0x"+K(R.slice(2,3))),_=parseInt("0x"+K(R.slice(3,4)));var I=F(R.slice(5));t({type:"streamData",status:"success",upId:n,siv:_,streamDataType:parseInt("0x"+K(R.slice(4,5))),streamData:I});break;case AG_LIVESRCMOONSERVER.ba:(i={}).errId=parseInt("0x"+K(R.slice(2,4))),i.errStrlen=parseInt("0x"+K(R.slice(4,6))),i.errStr=F(R.slice(6,6+i.errStrlen)),t({type:"serverErr",status:"failed",msg:i})}},H.parseVdnMoonServerMessage=function(e,t){var R=new Uint8Array(e);switch(parseInt("0x"+K(R.slice(0,2)))){case AG_LIVEVDNMOONSERVER.Wa:var a=parseInt("0x"+K(R.slice(2,4)));t({type:"vdnWebrtcReg",status:"success",fingerprint:F(R.slice(4,4+a))});break;case AG_LIVEVDNMOONSERVER.Ka:for(var O=F(R.slice(2,18)),_=parseInt("0x"+K(R.slice(18,19))),E=19,r=R.length,s={siv:_,uperInfos:{}};E<r;){var n=parseInt("0x"+K(R.slice(E,E+1)));E+=1;var c=parseInt("0x"+K(R.slice(E,E+2)));E+=2;var S=F(R.slice(E,E+c));E+=c,s.uperInfos[n]={upId:n,userId:S}}t({type:"vdnApplyDownload",status:"success",channelId:O,uperInfos:s});break;case AG_LIVEVDNMOONSERVER.Ba:console.log("vdn 心跳反馈");break;case AG_LIVEVDNMOONSERVER.qa:var i=parseInt("0x"+K(R.slice(2,4))),I=F(R.slice(4,4+i));t({type:"vdnApplyDownload",status:"failed",channelId:O=F(R.slice(4+i,4+i+16)),failedStatus:I});break;case AG_LIVEVDNMOONSERVER.Ja:t({type:"streamConfig",status:"success",channelId:O=F(R.slice(2,18))});break;case AG_LIVEVDNMOONSERVER.Qa:t({type:"streamConfig",status:"failed",channelId:O=F(R.slice(2,18))});break;case AG_LIVEVDNMOONSERVER.ja:for(O=F(R.slice(2,18)),_=parseInt("0x"+K(R.slice(18,19))),E=19,r=R.length,s={channelId:O,siv:_,uperInfos:{}};E<r;){n=parseInt("0x"+K(R.slice(E,E+1)));E+=1;c=parseInt("0x"+K(R.slice(E,E+2)));E+=2;S=F(R.slice(E,E+c));E+=c,s.uperInfos[n]={upId:n,userId:S}}t({type:"uperStreamInfoUpdate",status:"success",channelId:O,msg:s});break;case AG_LIVEVDNMOONSERVER.Xa:t({type:"streamData",status:"success",upId:n=parseInt("0x"+K(R.slice(2,3))),siv:_=parseInt("0x"+K(R.slice(3,4))),streamDataType:parseInt("0x"+K(R.slice(4,5))),streamData:F(R.slice(5))});break;case AG_LIVEVDNMOONSERVER.$a:case AG_LIVEVDNMOONSERVER.za:case AG_LIVEVDNMOONSERVER.Za:break;case AG_LIVEVDNMOONSERVER.tO:var o={};o.errId=parseInt("0x"+K(R.slice(2,4))),o.errStrlen=parseInt("0x"+K(R.slice(4,6))),o.errStr=F(R.slice(6,6+o.errStrlen)),t({type:"serverErr",status:"failed",msg:o})}},H.parseChatMoonServerMessage=function(e,t){var R=new Uint8Array(e),a=parseInt("0x"+K(R.slice(0,2)));switch(a){case AG_CHATROOMMOONSERVER._t:t({type:"createChatRoom",status:"success",chatroomId:_=F(R.slice(2,18)),maxContentLen:parseInt("0x"+K(R.slice(18,20)))});break;case AG_CHATROOMMOONSERVER.Et:var O=parseInt("0x"+K(R.slice(2,4)));t({type:"createChatRoom",status:"failed",status:F(R.slice(4,4+O))});break;case AG_CHATROOMMOONSERVER.rt:t({type:"deleteChatRoom",status:"success",roomId:_=F(R.slice(2,18))});break;case AG_CHATROOMMOONSERVER.st:var _=F(R.slice(2,18));O=parseInt("0x"+K(R.slice(18,20)));t({type:"deleteChatRoom",status:"failed",msg:F(R.slice(20,20+O)),roomId:_});break;case AG_CHATROOMMOONSERVER.nt:var E=parseInt("0x"+K(R.slice(2,4)));t({type:"banaedToSendMsg",status:"success",banUserId:r=F(R.slice(4,4+E)),banTime:s=parseInt("0x"+K(R.slice(4+E,4+E+2)))});break;case AG_CHATROOMMOONSERVER.ct:E=parseInt("0x"+K(R.slice(2,4)));var r=F(R.slice(4,4+E)),s=parseInt("0x"+K(R.slice(4+E,4+E+2)));O=parseInt("0x"+K(R.slice(4+E+2,4+E+2+2)));t({type:"banaedToSendMsg",status:"failed",banUserId:r,banTime:s,msg:F(R.slice(4+E+2+2,4+E+2+2+O))});break;case AG_CHATROOMMOONSERVER.St:var n=parseInt("0x"+K(R.slice(2,4)));t({type:"kickOutUser",status:"success",kickOutUserId:c=F(R.slice(4,4+n))});break;case AG_CHATROOMMOONSERVER.it:n=parseInt("0x"+K(R.slice(2,4)));var c=F(R.slice(4,4+n));O=parseInt("0x"+K(R.slice(4+n,4+E+2)));t({type:"kickOutUser",status:"failed",kickOutUserId:c,msg:F(R.slice(4+n+2,4+n+2+O))});break;case AG_CHATROOMMOONSERVER.It:case AG_CHATROOMMOONSERVER.ot:t({type:"joinChatRoom",status:"success",roomId:_=F(R.slice(2,18)),maxContentLen:parseInt("0x"+K(R.slice(18,20)))});break;case AG_CHATROOMMOONSERVER.At:_=F(R.slice(2,18)),O=parseInt("0x"+K(R.slice(18,20)));t({type:"joinChatRoom",status:"failed",failedStatus:F(R.slice(20,20+O)),roomId:_});break;case AG_CHATROOMMOONSERVER.Nt:console.log("chatRoom心跳反馈");break;case AG_CHATROOMMOONSERVER.Mt:case AG_CHATROOMMOONSERVER.Vt:var S=parseInt("0x"+K(R.slice(2,4))),i=F(R.slice(4,4+S)),I=parseInt("0x"+K(R.slice(4+S,4+S+4))),o=F(R.slice(4+S+4,4+S+4+I));t({type:a==AG_CHATROOMMOONSERVER.Mt?"recvChatPrivateMsg":"recvChatMsg",status:"success",fromUserId:i,msg:o});break;case AG_CHATROOMMOONSERVER.Tt:t({type:"chatroomUserBannedMsg",status:"success",banTime:s=parseInt("0x"+K(R.slice(2,4)))});break;case AG_CHATROOMMOONSERVER.Ct:t({type:"chatroomUserKicked",status:"success"});break;case AG_CHATROOMMOONSERVER.ut:t({type:"sendMsgNoFree"});break;case AG_CHATROOMMOONSERVER.Pt:(o={}).errId=parseInt("0x"+K(R.slice(2,4))),o.errStrlen=parseInt("0x"+K(R.slice(4,6))),o.errStr=F(R.slice(6,6+o.errStrlen)),t({type:"serverErr",status:"failed",msg:o});break;case AG_CHATROOMMOONSERVER.Gt:t({type:"getRoomOnlineNum",status:"success",roomId:_=F(R.slice(2,18)),onlineNum:parseInt("0x"+K(R.slice(18,22)))});break;case AG_CHATROOMMOONSERVER.bt:t({type:"saveToChatroomList",status:"success",roomId:_=F(R.slice(2,18))});break;case AG_CHATROOMMOONSERVER.Ht:t({type:"saveToChatroomList",status:"failed",roomId:_=F(R.slice(2,18))});break;case AG_CHATROOMMOONSERVER.gt:t({type:"delFromToChatroomList",status:"success",roomId:_=F(R.slice(2,18))});break;case AG_CHATROOMMOONSERVER.yt:t({type:"delFromToChatroomList",status:"failed",roomId:_=F(R.slice(2,18))});break;case AG_CHATROOMMOONSERVER.xt:var A=parseInt("0x"+K(R.slice(2,6)));t({type:"queryAllChatroomList",status:"success",listData:F(R.slice(6,6+A))})}},H.parseVoipMoonServerMessage=function(e,t){var R=new Uint8Array(e);switch(parseInt("0x"+K(R.slice(0,2)))){case AG_VOIPMOONSERVER.jt:t({type:"voipCallingAck",status:"success"});break;case AG_VOIPMOONSERVER.$t:var a=parseInt("0x"+K(R.slice(2,4)));t({type:"voipCalling",status:"success",fingerprint:F(R.slice(4,4+a))});break;case AG_VOIPMOONSERVER.zt:(O={}).errId=parseInt("0x"+K(R.slice(2,4))),O.errStrlen=parseInt("0x"+K(R.slice(4,6))),O.errStr=F(R.slice(6,6+O.errStrlen)),t({type:"voipCalling",status:"failed",msg:O});break;case AG_VOIPMOONSERVER.eR:a=parseInt("0x"+K(R.slice(2,4)));t({type:"voipResponseing",status:"success",fingerprint:F(R.slice(4,4+a))});break;case AG_VOIPMOONSERVER.tR:(O={}).errId=parseInt("0x"+K(R.slice(2,4))),O.errStrlen=parseInt("0x"+K(R.slice(4,6))),O.errStr=F(R.slice(6,6+O.errStrlen)),t({type:"voipResponseing",status:"failed",msg:O});break;case AG_VOIPMOONSERVER.RR:case AG_VOIPMOONSERVER.aR:break;case AG_VOIPMOONSERVER.OR:var O;(O={}).errId=parseInt("0x"+K(R.slice(2,4))),O.errStrlen=parseInt("0x"+K(R.slice(4,6))),O.errStr=F(R.slice(6,6+O.errStrlen)),t({type:"serverErr",status:"failed",msg:O})}},H.constructHeartBeatMsg=function(e){return new Uint8Array(W(h(e.toString(16))))}},StarRtc.StarManager=new function(){var O=this,e="starRTC v1.0.0",_="",E="",r="",s="",n="",t=null,c=null,S="";O.version=function(){return console.log(e),e},O.login=function(e,t,R,a){"WebSocket"in window?(r=(_=e)+"_"+(E=t),s=R,c=a,StarRtc.Instance.configModePulic?$.get("https://"+StarRtc.Instance.loginServerUrl+":"+StarRtc.Instance.loginServerPort+"/?userId="+r+"&authKey="+s,function(e,t){if(console.log("authKey 验证：",t,e),"success"===t){var R=JSON.parse(e);1==R.status?(n=R.data,$.get("https://"+StarRtc.Instance.msgScheduleUrl+":"+StarRtc.Instance.msgSchedulePort+"/?userId="+r,function(e,t){t="success";console.log("消息调度：",t,e);var R=JSON.parse(e);1==R.status?(S="wss://"+R.data,O.connect()):a({msg:"请求msg调度数据异常"},"connect failed")})):a({msg:"登录验证失败"},"connect failed")}else a({msg:"请求验证地址失败"},"connect failed")}):(n="free",S="wss://"+StarRtc.Instance.msgServerUrl+":"+StarRtc.Instance.msgServerWebsocketPort,O.connect())):(console.log("当前浏览器 Not support websocket"),a({msg:"当前浏览器 Not support websocket"},"connect failed"))},O.connect=function(){console.log("WebSocket："+S),(t=new WebSocket(S)).onerror=function(){console.log("WebSocket连接发生错误"),c({msg:"WebSocket连接发生错误"},"connect failed")},t.onopen=function(){console.log("WebSocket连接成功"),c({msg:"WebSocket连接成功"},"connect success"),O.startAuth()},t.onmessage=function(e){console.log("onmessage",e.data),c(e.data,"onmessage")},t.onclose=function(){console.log("WebSocket连接关闭"),c({msg:"WebSocket连接关闭"},"connect closed"),t=null}},O.close=function(){console.log("关闭WebSocket连接"),StarRtc.AUtils.clear(),null!=t&&t.close()},O.send=function(e){null!=t&&t.send(e)},O.startAuth=function(){StarRtc.AUtils.setUserInfo(_,E,n),O.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructAuthMsg()))},window.onbeforeunload=function(){O.close()}},StarRtc.Instance=new function(){var s=this,n="",c="",S="",O=null,a=null,_=0;s.configModePulic=!0,s.loginServerUrl="ips2.starrtc.com",s.loginServerPort="9920",s.msgScheduleUrl="ips2.starrtc.com",s.msgSchedulePort="9904",s.chatRoomScheduleUrl="ips2.starrtc.com",s.chatRoomSchedulePort="9907",s.srcScheduleUrl="ips2.starrtc.com",s.srcSchedulePort="9929",s.vdnScheduleUrl="ips2.starrtc.com",s.vdnSchedulePort="9926",s.voipServerUrl="voip2.starrtc.com",s.voipServerPort="10086",s.voipServerWebsocketPort="10087",s.voipServerWebrtcPort="10088",s.workServerUrl="https://api.starrtc.com/public",s.webrtcServerIP="123.103.93.74",s.msgServerUrl="ips2.starrtc.com",s.msgServerWebsocketPort="9904",s.chatRoomServerUrl="ips2.starrtc.com",s.chatRoomServerWebsocketPort="9907",s.srcServerUrl="ips2.starrtc.com",s.srcServerWebsocketPort="9929",s.srcServerWebrtcPort="10088",s.vdnServerUrl="ips2.starrtc.com",s.vdnServerWebsocketPort="9929",s.vdnServerWebrtcPort="10088",s.version=function(){return StarRtc.StarManager.version()};var E=function(e,t){switch(t){case"connect failed":case"connect success":case"connect closed":O(e,t);break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){switch(e.appid){case APP_PRODUCT_ID.t:StarRtc.AUtils.parseMessage(e.msgArr,E)}});break;case"onSingleMessage":e.msg=JSON.parse(e.msg);var R=t;if(0==e.msg.type)switch(e.msg.code){case AG_MSG_VOIP_CTRL.h:e.type="voipCall",R="onVoipMessage";break;case AG_MSG_VOIP_CTRL.F:e.type="voipRefuse",R="onVoipMessage";break;case AG_MSG_VOIP_CTRL.W:e.type="voipHangup",R="onVoipMessage";break;case AG_MSG_VOIP_CTRL.K:e.type="voipBusy",R="onVoipMessage";break;case AG_MSG_VOIP_CTRL.B:e.type="voipConnect",R="onVoipMessage";break;default:e.type="voipSingleMsg"}else e.type="voipSingleMsg";(null!=a?a:O)(e,R);break;case"onLoginMessage":case"onGroupMessage":case"onGroupPrivateMessage":case"onGroupPushMessage":case"onSystemPushMessage":case"onErrorMessage":case"onGetGroupList":case"onGetOnlineNumber":case"onGetGroupUserList":case"onGetAllUserList":case"onPushGroupSystemMsgFin":case"onPushSystemMsgFin":case"onUnsetGroupMsgIgnoreFin":case"onSetGroupMsgIgnoreFin":case"onRemoveGroupUserFin":case"onAddGroupUserFin":case"onDelGroupFin":case"onCreateGroupFin":case"onSendGroupMsgFin":null!=a&&a(e,t),O(e,t)}};s.setLoginServerUrl=function(e){s.loginServerUrl=e},s.setMsgScheduleUrl=function(e){s.msgScheduleUrl=e},s.setChatRoomScheduleUrl=function(e){s.chatRoomScheduleUrl=e},s.setSrcScheduleUrl=function(e){s.srcScheduleUrl=e},s.setVdnScheduleUrl=function(e){s.vdnScheduleUrl=e},s.setVoipServerUrl=function(e){s.voipServerUrl=e},s.setWorkServerUrl=function(e){s.workServerUrl=e},s.setWebrtcServerIP=function(e){s.webrtcServerIP=e},s.setMsgServerInfo=function(e,t){s.msgServerUrl=e,s.msgServerWebsocketPort=t},s.setChatRoomServerInfo=function(e,t){s.chatRoomServerUrl=e,s.chatRoomServerWebsocketPort=t},s.setSrcServerInfo=function(e,t,R){s.srcServerUrl=e,s.srcServerWebsocketPort=t,s.srcServerWebrtcPort=R},s.setVdnServerInfo=function(e,t,R){s.vdnServerUrl=e,s.vdnServerWebsocketPort=t,s.vdnServerWebrtcPort=R},s.setVoipServerInfo=function(e,t,R,a){s.voipServerUrl=e,s.voipServerPort=t,s.voipServerWebsocketPort=R,s.voipServerWebrtcPort=a},s.setConfigModePulic=function(e){s.configModePulic=e},s.login=function(e,t,R,a){s.configModePulic||(e="APPID-FREE"),(n=e)+"_"+(c=t),S=R,O=a,StarRtc.StarManager.login(e,t,R,E)},s.logout=function(){StarRtc.StarManager.close()},s.sendSingleMsg=function(e,t,R,a){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructSingleMsg(e,++_,t,R,a)))},s.sendGroupMsg=function(e,t,R){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructGroupMsg(e,++_,t,R)))},s.sendSingleCtrlMsg=function(e,t,R,a){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructSingleCtrlMsg(e,++_,t,R,a)))},s.sendVoipCtrlMsg=function(e,t){var R="";t==AG_MSG_VOIP_CTRL.h&&(R=JSON.stringify({VoIP_protocal_type:"TCP",VoIP_server_IP:StarRtc.Instance.voipServerUrl,VoIP_server_Port:StarRtc.Instance.voipServerPort})),s.sendSingleCtrlMsg(e,"新消息",R,t)},s.sendVoipCallMsg=function(e,t){var R,a=t||(new Date).getTime();R=JSON.stringify({VoIP_protocal_type:"TCP",VoIP_server_IP:StarRtc.Instance.voipServerUrl,VoIP_server_Port:StarRtc.Instance.voipServerPort,ts:a}),s.sendSingleCtrlMsg(e,"新消息",R,AG_MSG_VOIP_CTRL.h)},s.sendVoipRefuseMsg=function(e){s.sendVoipCtrlMsg(e,AG_MSG_VOIP_CTRL.F)},s.sendVoipHungupMsg=function(e){s.sendVoipCtrlMsg(e,AG_MSG_VOIP_CTRL.W),null!=a&&a({type:"voipCancle"},"onVoipMessage")},s.sendVoipBusyMsg=function(e){s.sendVoipCtrlMsg(e,AG_MSG_VOIP_CTRL.K)},s.sendVoipConnectMsg=function(e){s.sendVoipCtrlMsg(e,AG_MSG_VOIP_CTRL.B)},s.setIMExtraback=function(e){a=e},s.getStarRoomSDK=function(e,t,R,a,O,_,E){var r=new StarRtc.StarRoomSDK(e,t,R,a,O,_,E);return r.login(n,c,S),r},s.getVideoMeetingRoomSDK=function(e,t,R){return s.getStarRoomSDK("src",e,t,R,3,1)},s.getVideoLiveRoomSDK=function(e,t,R,a){return s.getStarRoomSDK(e,t,R,a,3,2)},s.getVoipRoomSDK=function(e,t,R){return s.getStarRoomSDK("voip",e,t,R,2,0,s)},s.reportVideoMeetingRoom=function(e,t){s.reportRoom(CHATROOM_LIST_TYPE.X,e,t)},s.reportVideoLiveRoom=function(e,t){s.reportRoom(CHATROOM_LIST_TYPE.J,e,t)},s.reportVideoClassRoom=function(e,t){s.reportRoom(CHATROOM_LIST_TYPE.Z,e,t)},s.reportChatRoom=function(e,t){s.reportRoom(CHATROOM_LIST_TYPE.q,e,t)},s.reportRoom=function(R,e,a){if(!StarRtc.Instance.configModePulic){var O=null,_=e.ID.substring(16,33),E={};E.id=e.ID,E.creator=e.Creator,E.name=e.Name;var r=function(e,t){switch(e.obj=s,t){case"connect success":O.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.vt,{roomId:_,listType:R,userDefineData:encodeURIComponent(JSON.stringify(E))})));break;case"connect failed":a&&a("failed");case"connect closed":O=null;break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.R&&StarRtc.AUtils.parseChatMoonServerMessage(e.msgArr,function(e){r(e,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(e.type){case"saveToChatroomList":a&&a(e.status),O.close()}}};O=new StarRtc.WebrtcWebsocket(r,null);var t="wss://"+StarRtc.Instance.chatRoomServerUrl+":"+StarRtc.Instance.chatRoomServerWebsocketPort;O.connect(t)}},s.delVideoMeetingRoom=function(e,t){s.delRoom(CHATROOM_LIST_TYPE.X,e,t)},s.delVideoLiveRoom=function(e,t){s.delRoom(CHATROOM_LIST_TYPE.J,e,t)},s.delVideoClassRoom=function(e,t){s.delRoom(CHATROOM_LIST_TYPE.Z,e,t)},s.delChatRoom=function(e,t){s.delRoom(CHATROOM_LIST_TYPE.q,e,t)},s.delRoom=function(R,e,a){if(!StarRtc.Instance.configModePulic){var O=null,_=e.ID.substring(16,33),E=function(e,t){switch(e.obj=s,t){case"connect success":O.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.kt,{roomId:_,listType:R})));break;case"connect failed":a&&a("failed");case"connect closed":O=null;break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.R&&StarRtc.AUtils.parseChatMoonServerMessage(e.msgArr,function(e){E(e,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(e.type){case"delFromToChatroomList":a&&a(e.status),O.close()}}};O=new StarRtc.WebrtcWebsocket(E,null);var t="wss://"+StarRtc.Instance.chatRoomServerUrl+":"+StarRtc.Instance.chatRoomServerWebsocketPort;O.connect(t)}},s.queryVideoClassRoom=function(e){s.queryRoom(CHATROOM_LIST_TYPE.Z,e)},s.queryChatRoom=function(e){s.queryRoom(CHATROOM_LIST_TYPE.q,e)},s.queryVideoMeetingRoom=function(e){s.queryRoom(CHATROOM_LIST_TYPE.X,e)},s.queryVideoLiveRoom=function(e){s.queryRoom(CHATROOM_LIST_TYPE.J,e)},s.queryRoom=function(O,_){if(!StarRtc.Instance.configModePulic){var E=null,r=function(e,t){switch(e.obj=s,t){case"connect success":E.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.wt,{listTypes:O.toString(),userId:""})));break;case"connect failed":_&&_("failed");case"connect closed":E=null;break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.R&&StarRtc.AUtils.parseChatMoonServerMessage(e.msgArr,function(e){r(e,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(e.type){case"queryAllChatroomList":if(""==e.listData){_&&_(e.status,[]);break}for(var R=JSON.parse(e.listData).userDefineDataList.split(","),a=0;a<R.length;a++)R[a]=JSON.parse(decodeURIComponent(R[a])),R[a].ID=R[a].id,R[a].Name=R[a].name,R[a].Creator=R[a].creator;_&&_(e.status,R),E.close()}}};E=new StarRtc.WebrtcWebsocket(r,null);var e="wss://"+StarRtc.Instance.chatRoomServerUrl+":"+StarRtc.Instance.chatRoomServerWebsocketPort;E.connect(e)}},s.setGroupMsgPush=function(e){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(e?AG_MSG.Se:AG_MSG.ie,{reqIndex:0})))},s.removeGroupUsers=function(e,t){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.ce,{reqIndex:0,groupId:e,removeUsers:t.join(",")})))},s.addGroupUsers=function(e,t,R){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.ne,{reqIndex:0,groupId:e,addUsers:t.join(","),userDefineData:R})))},s.delGroup=function(e){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.se,{reqIndex:0,groupId:e})))},s.createGroup=function(e,t){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.re,{reqIndex:0,addUsers:e.join(","),userDefineData:t})))},s.getGroupList=function(){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.ye,{reqIndex:0})))},s.getGroupUserList=function(e){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.xe,{reqIndex:0,groupId:e})))},s.getOnlineNumber=function(){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.Ye,{})))},s.getAllUserList=function(e){StarRtc.StarManager.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.t,ACTION_GROUP_ID.M,StarRtc.AUtils.constructMsgProtocol(AG_MSG.We,{reqPageNum:e})))},s.getInfo=function(){return{agentId:n,userId:c,authKey:S}}},StarRtc.WebrtcWebsocket=function(e,t){var R,a=this,O=t,_=e,E=null;return a.startHeartBeat=function(e){E.send(e),R=setInterval(function(){E.send(e)},5e3)},a.stopHeartBeat=function(){clearInterval(R)},a.connect=function(e){console.log("webrtcConnect"+e),(E=new WebSocket(e)).onerror=function(e){console.log("WebSocket连接发生错误"),_({msg:"WebSocket连接发生错误",data:e.data},"connect failed")},E.onopen=function(){console.log("WebSocket连接成功"),_({msg:"WebSocket连接成功"},"connect success")},E.onmessage=function(e){console.log("onmessage",e.data),_(e.data,"onmessage")},E.onclose=function(e){console.log("WebSocket连接关闭"),a.stopHeartBeat(),_({msg:"WebSocket连接关闭",data:e.code},"connect closed"),E=null}},a.starConnect=function(a){$.get(O,function(e,t){if(console.log("消息调度：",t,e),"success"===t){var R=JSON.parse(e);1==R.status?a("success",R.data):a("failed")}else a("failed")})},a.send=function(e){E.send(e)},a.close=function(){null!=E&&E.close()},a.readyState=function(){return null!=E?E.readyState:-1},a},StarRtc.StarRoomSDK=function(e,t,R,a,O,_,E){var r="我要上麦！",s=this,n="",c=t,S=e,i=a,I=R,o=O||3,A=0!=(1&o),N=0!=(2&o),M=null,V=null,T=null,C=null,u=!1,P=null,G=E;function L(){null!=P&&(clearInterval(P),P=null)}function l(e){if(null!=e){var t=e.getState();0<=t&&t<2&&e.sigDisconnect()}}function p(){var e=!0;return A&&(e=e&&(3==T.getState()||-1==T.getState())),N&&(e=e&&(3==M.getState()||-1==M.getState())),e}null!=G&&"voip"==e&&G.setIMExtraback(function(e,t){f(e,"onVoipMessage")});var f=function(e,t){switch(e.userData=i,e.obj=s,t){case"connect success":N?M.sigConnect():I(e,t,c);break;case"connect failed":case"connect closed":N&&l(M),p()&&I(e,t,c);break;case"onmessage":break;case"onChatRoomMessage":switch(e.type){case"createChatRoom":"success"==e.status&&(i.roomInfo.ID=e.chatroomId,i.roomInfo.Creator=n,N&&(V.roomInfo.Name=e.chatroomId,M.createNew()));break;case"deleteChatRoom":"success"==e.status&&(N?M.deleteCurrRoom():I(e,t,c));break;case"joinChatRoom":"success"==e.status&&N&&M.joinRoom();break;case"recvChatPrivateMsg":if(0==e.msg.type)switch(e.msg.code){case 2e3:e.msg.msgType="apply";break;case 2002:e.msg.msgType="applyAgree";break;case 2004:e.msg.msgType="applyDisagree";break;case 2200:e.msg.msgType="linkStop";break;case 2100:e.msg.msgType="invite";break;case 2102:e.msg.msgType="inviteAgree";break;case 2106:e.msg.msgType="inviteDisagree";break;case 2104:e.msg.msgType="inviteLinkStart";break;default:e.msg.msgType="common"}}I(e,t,c);break;case"onVoipMessage":switch(e.type){case"voipCall":e.fromId!=i.roomInfo.targetId&&G.sendVoipBusyMsg(e.fromId);break;case"voipHangup":e.fromId==i.roomInfo.targetId&&(s.leaveRoom(!0),I(e,t,c));break;case"voipBusy":L(),s.leaveRoom(!0),I(e,t,c);break;case"voipConnect":case"voipRefuse":L(),I(e,t,c);break;case"voipCancle":L();break;default:I(e,t,c)}}};return V=clone(i),C=clone(i),N&&A&&i.roomInfo.ID&&(V.roomInfo.ID=i.roomInfo.ID.substring(0,16),C.roomInfo.ID=i.roomInfo.ID.substring(16,33)),N&&(M=new StarRtc.StarVideoSDK(e,t,function(e,t){switch(e.userData=i,e.obj=s,t){case"connect success":I(e,t,c);break;case"connect closed":case"connect failed":L(),A&&l(T),p()&&I(e,t,c);break;case"onmessage":break;case"onWebrtcMessage":switch(e.type){case"delChannel":"success"==e.status?I(e,t,c):alert("删除视频会议失败");break;case"createChannel":"success"==e.status&&(i.roomInfo.Creator=n,i.roomInfo.ID=A?e.channelId+i.roomInfo.ID:e.channelId),I(e,t,c);break;case"voipCallingAck":if(null!=G){L();var R=(new Date).getTime();G.sendVoipCallMsg(i.roomInfo.targetId,R),_=i.roomInfo.targetId,a=function(){G.sendVoipCallMsg(_,R)},O=3e3,null!=P&&L(),P=setInterval(a,O)}break;case"voipResponseing":"success"==e.status&&null!=G&&G.sendVoipConnectMsg(i.roomInfo.targetId),I(e,t,c);break;default:I(e,t,c)}}var a,O,_},V,_)),A&&(T=new StarRtc.StarChatSDK(t,f,C)),s.login=function(e,t,R){e+"_"+(n=t),R,A&&T.login(e,t,R),N&&M.login(e,t,R)},s.sigConnect=function(){u=!1,A?T.sigConnect():N&&M.sigConnect()},s.sigDisconnect=function(e){null==e&&(e=!0),u=e,N?M.sigDisconnect(e):A&&T.sigDisconnect(e)},s.createNew=function(){"voip"!=S&&(A?T.createNew():N&&M.createNew())},s.deleteCurrRoom=function(){"voip"!=S&&(A?T.deleteCurrRoom():N&&M.deleteCurrRoom())},s.createStream=function(e){N&&M.createStream(e)},s.joinRoom=function(){A&&"new"!=c?T.joinRoom():N&&M.joinRoom()},s.leaveRoom=function(e){if(N){switch(S){case"voip":var t=e||!1;null==G||t||G.sendVoipHungupMsg(i.roomInfo.targetId),G.setIMExtraback(null)}M.leaveRoom(t)}else A&&T.leaveRoom()},s.streamConfigChange=function(e){N&&M.streamConfigChange(e)},s.sendChatMsg=function(e){A&&T.sendChatMsg(e)},s.sendVoipMsg=function(e){"voip"==S&&null!=G&&G.sendSingleMsg(i.roomInfo.targetId,"新媒体",e)},s.sendChatPrivateMsg=function(e,t){A&&T.sendChatPrivateMsg(e,t)},s.sendApplyMsg=function(){A&&N&&"vdn"==S&&T.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2e3)},s.sendApplyAgreeMsg=function(e){A&&N&&"src"==S&&T.sendChatCtrlPrivateMsg(e,r,2002)},s.sendApplyDisagreeMsg=function(e){A&&N&&"src"==S&&T.sendChatCtrlPrivateMsg(e,r,2004)},s.sendInviteLinkMsg=function(e){A&&N&&"src"==S&&T.sendChatCtrlPrivateMsg(e,r,2100)},s.sendInviteLinkAgreeMsg=function(){A&&N&&"vdn"==S&&T.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2102)},s.sendInviteLinkDisagreeMsg=function(){A&&N&&"vdn"==S&&T.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2106)},s.sendInviteLinkStartMsg=function(){A&&N&&"vdn"==S&&T.sendChatCtrlPrivateMsg(i.roomInfo.Creator,r,2104)},s.sendLinkStopMsg=function(e){A&&N&&"src"==S&&T.sendChatCtrlPrivateMsg(e,r,2200)},s.kickOutUser=function(e){A&&T.kickOutUser(e)},s.banToSendMsg=function(e,t){A&&T.banToSendMsg(e,t)},s.getRoomOnlineNum=function(){A&&T.getRoomOnlineNum()},s.sendStreamData=function(e){N&&"src"==S&&M.sendStreamData(e)},s.activeDisconnect=function(){return u},s.getUserData=function(){return i},s.startLocalStream=function(e){N&&M.startLocalStream(e)},s},StarRtc.StarVideoSDK=function(e,t,R,a,O){var s,n,c=this,S="",i="",I=a,o=e,A=R,N=t,M=null,V="",T={},C={},_=O||1,u={siv:0,uperInfos:{}},P=StarWebRTC();P.init();var G=!1,E=!1,r=function(e){switch(e.type){case"createOffer":if("success"==e.status){switch(o){case"src":e.channelId=I.roomInfo.ID;break;case"vdn":e.ssrc=e.bigVideoSSRC;break;case"voip":e.targetId=I.roomInfo.targetId,e.videoSSRC=e.bigVideoSSRC}c.joinRoomInternal(e)}break;case"applyAnswer":e.status}},L=function(e,t){var R={type:"streamCreated",streamObj:t};R.userData=I,R.obj=c,R.status="success"==e?"success":"failed",A(R,"onWebrtcMessage",N)},l=function(e,t){switch(e.userData=I,e.obj=c,t){case"connect success":var R=null;switch(o){case"src":R=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructHeartBeatMsg(AG_LIVESRCMOONSERVER.Oa));break;case"vdn":R=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.C,StarRtc.AUtils.constructHeartBeatMsg(AG_LIVEVDNMOONSERVER.xa))}M.startHeartBeat(R),P.setServerInfo({serverIp:T.ip,serverPort:T.webrtcPort}),A(e,t,N);break;case"connect failed":case"connect closed":P.destroy(),M=null,A(e,t,N);break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.i?StarRtc.AUtils.parseSrcMoonServerMessage(e.msgArr,function(e){l(e,"onWebrtcMessage")}):e.appid==APP_PRODUCT_ID.I?StarRtc.AUtils.parseVdnMoonServerMessage(e.msgArr,function(e){l(e,"onWebrtcMessage")}):e.appid==APP_PRODUCT_ID.o&&StarRtc.AUtils.parseVoipMoonServerMessage(e.msgArr,function(e){l(e,"onWebrtcMessage")})});break;case"onWebrtcMessage":switch(e.type){case"uperStreamInfoUpdate":if("success"==e.status){if(G)for(var a=0;a<7;++a){var O=P.getStreamByIndex(a),_=void 0;0!=Object.keys(u.uperInfos).length&&(_=u.uperInfos[a]);var E=e.msg.uperInfos[a];if(null==_&&null!=E)E.userId!=i&&A({type:"addUploader",upId:E.upId,upUserId:E.userId,streamInfo:O,room:c},t,N);else if(null!=_&&null==E){var r=n==_.upId;r&&(n=s=void 0),P.resetStreamInfo(O),A({type:"removeUploader",upId:_.upId,upUserId:_.userId,streamInfo:O,bigFlag:r,room:c},t,N)}else null!=_&&null!=E&&_.userId!=E.userId&&A({type:"changeUploader",upId:E.upId,oldUpUserId:_.userId,newUpUserId:E.userId,streamInfo:O,room:c},t,N)}u=e.msg}break;case"vdnWebrtcReg":if("success"==e.status)switch(o){case"vdn":V=e.fingerprint,M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.C,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.ya,{channelId:I.roomInfo.ID})))}else console.log("vdnWebrtcReg failed");break;case"vdnApplyDownload":"success"==e.status?P.emit("_webrtc_apply_ok",V,function(){G=!0,l({type:"uperStreamInfoUpdate",status:"success",msg:e.uperInfos},"onWebrtcMessage")}):console.log("收到vdnApplyDownload failed"),A(e,t,N);break;case"srcApplyUpload":"success"==e.status?(e.tmpData=C,console.log("收到_webrtc_apply_ok"),P.emit("_webrtc_apply_ok",e.fingerprint,function(){G=!0;var e=clone(u);u.uperInfos={},l({type:"uperStreamInfoUpdate",status:"success",msg:e},"onWebrtcMessage")})):console.log("收到srcApplyUpload failed"),A(e,t,N);break;case"streamConfig":if("success"==e.status){if(s==n){O=P.getStreamByIndex(s);P.switchStreamInfo(O);break}if(null!=s){O=P.getStreamByIndex(s);P.switchStreamInfo(O)}if(null!=n){O=P.getStreamByIndex(n);P.switchStreamInfo(O)}}break;case"createChannel":"success"==e.status&&(I.roomInfo.ID=e.channelId,I.roomInfo.Creator=S),A(e,t,N);break;case"delChannel":"success"==e.status&&(I.roomInfo.ID=""),A(e,t,N);break;case"serverErr":break;case"voipResponseing":case"voipCalling":"success"==e.status&&(console.log("收到_webrtc_apply_ok"),P.emit("_webrtc_apply_ok",e.fingerprint,function(){l({type:"voipStreamReady",status:"success"},"onWebrtcMessage")})),A(e,t,N);break;case"voipStreamReady":O=P.getStreamByIndex(0);P.switchStreamInfo(O),A({type:"voipStreamReady",streamObj:O.streamObj,room:c},t,N);break;default:A(e,t,N)}}};return c.login=function(e,t,R){i=e+"_"+(S=t),R},c.sigConnect=function(){switch(E=!1,T.ip=StarRtc.Instance.webrtcServerIP,M=null,o){case"src":if(!StarRtc.Instance.configModePulic){M=new StarRtc.WebrtcWebsocket(l,null),(R={}).ip=StarRtc.Instance.srcServerUrl,T.websocketPort=StarRtc.Instance.srcServerWebsocketPort,T.webrtcPort=StarRtc.Instance.srcServerWebrtcPort,R.websocketPort=T.websocketPort;var e="wss://"+R.ip+":"+R.websocketPort;return void M.connect(e)}var t="https://"+StarRtc.Instance.srcScheduleUrl+":"+StarRtc.Instance.srcSchedulePort+"?userId="+i;M=new StarRtc.WebrtcWebsocket(l,t);break;case"vdn":if(!StarRtc.Instance.configModePulic){M=new StarRtc.WebrtcWebsocket(l,null),(R={}).ip=StarRtc.Instance.vdnServerUrl,T.websocketPort=StarRtc.Instance.vdnServerWebsocketPort,T.webrtcPort=StarRtc.Instance.vdnServerWebrtcPort,R.websocketPort=T.websocketPort;e="wss://"+R.ip+":"+R.websocketPort;return void M.connect(e)}t="https://"+StarRtc.Instance.vdnScheduleUrl+":"+StarRtc.Instance.vdnSchedulePort+"?userId="+i+"&channelId="+I.channelId;M=new StarRtc.WebrtcWebsocket(l,t);break;case"voip":var R;M=new StarRtc.WebrtcWebsocket(l,null),(R={}).ip=StarRtc.Instance.voipServerUrl,T.websocketPort=StarRtc.Instance.voipServerWebsocketPort,T.webrtcPort=StarRtc.Instance.voipServerWebrtcPort,R.websocketPort=T.websocketPort;e="wss://"+R.ip+":"+R.websocketPort;return void M.connect(e);default:return}M.starConnect(function(e,t){if("success"==e){T.websocketPort=t.websocketPort,T.webrtcPort=t.webrtcPort;var R="wss://"+t.ip+":"+t.websocketPort;M.connect(R)}})},c.sigDisconnect=function(e){null==e&&(e=!0),E=e,null!=M&&(M.close(),M=null)},c.createNew=function(){if(null!=M)switch(o){case"src":var e="1";2==_&&(e="2");var t=AG_LIVESRCMOONSERVER.FR;1==I.roomInfo.Type&&(t=AG_LIVESRCMOONSERVER.WR),M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructSrcProtocol(t,{conCurrentNum:7,roomId:I.roomInfo.Name,extra:e,liveType:parseInt(e)})))}},c.deleteCurrRoom=function(){if(null!=M)switch(o){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.ea,{channelId:I.roomInfo.ID})))}},c.createStream=function(e){null==e&&(e={video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:25},facingMode:{ideal:["user"]}},audio:{deviceId:{ideal:["default"]}}}),P.createStream(e,L)},c.joinRoom=function(){P.emit("ready",r,"voip"==o)},c.joinRoomInternal=function(e){switch(C=e,o){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructWebrtcUploadMsgProtocol(e)));break;case"vdn":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.C,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.ma,e)));break;case"voip":"call"==N?M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.u,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.Wt,e))):"response"==N&&M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.u,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.Bt,e)))}},c.leaveRoom=function(e){if(null!=M&&1==M.readyState())switch(o){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.ZR,{channelId:I.roomInfo.ID})));break;case"vdn":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.C,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.wa,{})));case"voip":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.o,ACTION_GROUP_ID.u,StarRtc.AUtils.constructVOIPProtocol(AG_VOIPMOONSERVER.Qt,{isActive:e?0:1})))}},c.streamConfigChange=function(e){if(null!=M){n==e?(n=s,s=e):(s=n,n=e);var t=P.getStreamInfos(),R=[];for(var a in t){var O=0;O=s==n?t[a].switchFlag?1:2:a==s?1:a==n?2:t[a].switchFlag?2:1,R.push(O)}switch(o){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.ta,{streamConfig:R})));break;case"vdn":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.I,ACTION_GROUP_ID.C,StarRtc.AUtils.constructVdnProtocol(AG_LIVEVDNMOONSERVER.Ya,{streamConfig:R})))}}},c.getState=function(){return null!=M?M.readyState():-1},c.getType=function(){return o},c.sendStreamData=function(e){switch(o){case"src":M.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.i,ACTION_GROUP_ID.C,StarRtc.AUtils.constructSrcProtocol(AG_LIVESRCMOONSERVER.aa,{streamData:e,streamDataType:8})))}},c.activeDisconnect=function(){return E},c.startLocalStream=function(e){P.startLocalStream(e)},c},StarRtc.StarChatSDK=function(e,t,R){var a=this,O="",_="",E={},r=R,s=t,n=e,c=null,S=0,i=!1,I=function(e,t){switch(e.userData=r,e.obj=a,t){case"connect success":var R;R=StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructHeartBeatMsg(AG_CHATROOMMOONSERVER.ze)),c.startHeartBeat(R),s(e,t,n);break;case"connect failed":case"connect closed":c=null,s(e,t,n);break;case"onmessage":StarRtc.AUtils.parseProtocol(e,function(e){e.appid==APP_PRODUCT_ID.R&&StarRtc.AUtils.parseChatMoonServerMessage(e.msgArr,function(e){I(e,"onChatRoomMessage")})});break;case"onChatRoomMessage":switch(e.type){case"createChatRoom":"success"==e.status&&(r.roomInfo.ID=e.chatroomId,r.roomInfo.Creator=O);break;case"deleteChatRoom":case"joinChatRoom":e.status;break;case"recvChatPrivateMsg":case"recvChatMsg":if(""==e.fromUserId||""==e.msg)return;if(e.msg=JSON.parse(e.msg),e.msg.fromId==O)return}s(e,t,n)}};return a.login=function(e,t,R){_=e+"_"+(O=t),R},a.sigConnect=function(){if(i=!1,StarRtc.Instance.configModePulic){var e="https://"+StarRtc.Instance.chatRoomScheduleUrl+":"+StarRtc.Instance.chatRoomSchedulePort+"/?userId="+_;(c=new StarRtc.WebrtcWebsocket(I,e)).starConnect(function(e,t){if("success"==e){var R=t.split(":");E.ip=R[0],E.port=R[1];var a="wss://"+E.ip+":"+E.port;c.connect(a)}})}else{c=new StarRtc.WebrtcWebsocket(I,null),E.ip=StarRtc.Instance.chatRoomServerUrl,E.port=StarRtc.Instance.chatRoomServerWebsocketPort;var t="wss://"+E.ip+":"+E.port;c.connect(t)}},a.sigDisconnect=function(e){null==e&&(e=!0),i=e,null!=c&&(c.close(),c=null)},a.createNew=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Qe,{roomType:0==r.roomInfo.Type?1:2,conCurrentNum:100,userDefineData:r.roomInfo.Name})))},a.sendChatMsg=function(e){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Rt,{roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:e})))},a.sendChatPrivateMsg=function(e,t){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.at,{toUserId:e,roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:t,type:"1",code:"0"})))},a.sendChatCtrlPrivateMsg=function(e,t,R){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.at,{toUserId:e,roomId:r.roomInfo.ID,digest:"新消息",msgIndex:++S,msg:t,type:"0",code:R})))},a.kickOutUser=function(e){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.$e,{kickOutUserId:e})))},a.banToSendMsg=function(e,t){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Xe,{banUserId:e,banTime:t})))},a.getRoomOnlineNum=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Ot,{roomId:r.roomInfo.ID})))},a.deleteCurrRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.je)))},a.joinRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.Ze,{roomId:r.roomInfo.ID})))},a.leaveRoom=function(){c.send(StarRtc.AUtils.packageProtocol(APP_PRODUCT_ID.R,ACTION_GROUP_ID.V,StarRtc.AUtils.constructChatProtocol(AG_CHATROOMMOONSERVER.tt)))},a.getState=function(){return null!=c?c.readyState():-1},a.activeDisconnect=function(){return i},a},module.exports=exports=StarRtc;